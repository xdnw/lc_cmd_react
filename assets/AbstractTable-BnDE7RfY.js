import{c as ye,r as n,j as r,L as ve,u as je,a as Re}from"./index-nW9DkA3u.js";import{z as Ne,T as ue,v as Ee}from"./queries-B0bYDAFD.js";import{B as G}from"./button-ujMD_D3S.js";import{u as ae,a as ke}from"./DialogContext-BfwqmJEN.js";import{g as de,t as me,i as he}from"./table_util-BhRzU9Kk.js";import{u as Te}from"./useSuspenseQuery--1Q7REA5.js";import{G as Ie,D as Le}from"./DataTable-CrC93K72.js";import{a as se}from"./StateUtil-BU5RTinU.js";function Qe(B){const e=ye.c(87),{getTableProps:t,load:s}=B,D=n.useRef(null),{showDialog:h}=ae();let F;e[0]!==t||e[1]!==s?(F=s?t().type:null,e[0]=t,e[1]=s,e[2]=F):F=e[2];const[u,M]=se(F);let b;e[3]!==t||e[4]!==s?(b=s?t().selection:{},e[3]=t,e[4]=s,e[5]=b):b=e[5];const[i,E]=se(b);let j;e[6]!==t||e[7]!==s?(j=s?t().columns:new Map,e[6]=t,e[7]=s,e[8]=j):j=e[8];const[c,k]=se(j);let x;e[9]!==t||e[10]!==s?(x=s?t().sort:void 0,e[9]=t,e[10]=s,e[11]=x):x=e[11];const[d,a]=se(x);let R;e[12]!==t||e[13]!==s?(R=s?t().clientColumns??[]:[],e[12]=t,e[13]=s,e[14]=R):R=e[14];const[g,A]=n.useState(R);let m;e[15]!==t||e[16]!==s?(m=()=>s?t().columnRenderers:void 0,e[15]=t,e[16]=s,e[17]=m):m=e[17];const[W,O]=n.useState(m);let f;e[18]!==t||e[19]!==s?(f=()=>s?t().rowClassName:void 0,e[18]=t,e[19]=s,e[20]=f):f=e[20];const[w,S]=n.useState(f);let y;e[21]!==t||e[22]!==s?(y=()=>s?t().indexCellRenderer:void 0,e[21]=t,e[22]=s,e[23]=y):y=e[23];const[p,_]=n.useState(y);let T;e[24]!==t||e[25]!==s?(T=()=>s?t().indexColumnWidth:void 0,e[24]=t,e[25]=s,e[26]=T):T=e[26];const[I,l]=n.useState(T);let N;e[27]!==t||e[28]!==s?(N=()=>s?t().onRowsRendered:void 0,e[27]=t,e[28]=s,e[29]=N):N=e[29];const[v,$]=n.useState(N);let U;e[30]!==t||e[31]!==s?(U=()=>s?t().onColumnsLoaded:void 0,e[30]=t,e[31]=s,e[32]=U):U=e[32];const[z,ie]=n.useState(U);let J,K;e[33]!==t||e[34]!==s||e[35]!==k||e[36]!==E||e[37]!==a||e[38]!==M?(J=()=>{if(!s)return;const o=t();M(o.type),E(o.selection),k(o.columns),a(o.sort),A(o.clientColumns??[]),O(o.columnRenderers),S(()=>o.rowClassName),_(()=>o.indexCellRenderer),l(o.indexColumnWidth),$(()=>o.onRowsRendered),ie(()=>o.onColumnsLoaded)},K=[s,t,M,E,k,a,A,O,S,_,l,$,ie],e[33]=t,e[34]=s,e[35]=k,e[36]=E,e[37]=a,e[38]=M,e[39]=J,e[40]=K):(J=e[39],K=e[40]),n.useEffect(J,K);let X;e[41]===Symbol.for("react.memo_cache_sentinel")?(X=(o,Q)=>{const C=D.current?.element?.querySelectorAll(".bg-red-500")||[];for(const H of C)H.classList.remove("bg-red-500")},e[41]=X):X=e[41];const fe=X;let Y;e[42]!==c||e[43]!==t||e[44]!==s||e[45]!==i||e[46]!==h||e[47]!==d||e[48]!==u?(Y=()=>{const o=s?{type:u,selection:i,columns:c,sort:d}:t();if(!o.type){h("Failed to copy URL","Table type is missing.",!0);return}const L=`${window.location.protocol+"//"+window.location.host}/#/view_table?${encodeURIComponent(de({type:o.type,selAndModifiers:o.selection,columns:o.columns,sort:o.sort}))}`;navigator.clipboard.writeText(L).then(()=>{h("URL copied to clipboard",L,!0)}).catch(C=>{h("Failed to copy URL to clipboard",C+"",!0)})},e[42]=c,e[43]=t,e[44]=s,e[45]=i,e[46]=h,e[47]=d,e[48]=u,e[49]=Y):Y=e[49];const oe=Y;let ne;e:{if(!u||!i||!c){ne=null;break e}let o;e[50]!==c||e[51]!==i||e[52]!==u?(o=r.jsx(Ie,{type:u,selection:i,columns:c}),e[50]=c,e[51]=i,e[52]=u,e[53]=o):o=e[53],ne=o}const re=ne;let ce,Z;e[54]!==oe?(Z=r.jsx(G,{variant:"outline",size:"sm",className:"me-1",onClick:oe,children:"Share"}),e[54]=oe,e[55]=Z):Z=e[55],ce=Z;const le=ce;let P;e[56]===Symbol.for("react.memo_cache_sentinel")?(P=o=>{const Q=parseInt(o.currentTarget.dataset.col??"0")-1,L=parseInt(o.currentTarget.dataset.row??"0")-1;fe(Q,L)},e[56]=P):P=e[56];const pe=P;let ee;e[57]!==h?(ee=o=>{const Q=o.length>0?"Errors updating table":"No errors",L=o.length>0?r.jsxs(r.Fragment,{children:["Errors updating the table may prevent some data from being displayed. Click the buttons below to highlight the errors in the table.",o.map((C,H)=>r.jsxs(G,{"data-col":C.col,"data-row":C.row,variant:"destructive",className:"my-1 h-auto wrap-break-word w-full justify-start size-sm whitespace-normal",onClick:pe,children:["[col:",(C.col??0)+1,C.row?`row:${C.row+1}`:"","] ",C.msg]},H))]}):"No errors";h(Q,L)},e[57]=h,e[58]=ee):ee=e[58];const q=ee;let te;e[59]!==re||e[60]!==a||e[61]!==le||e[62]!==d?(te=(o,Q,L,C,H,Ce,be,xe,ge,we,Se)=>r.jsxs(r.Fragment,{children:[re,le,o,r.jsx(Le,{table:D,data:Q,columnsInfo:L,sort:d,searchSet:C,rowClassName:xe,indexCellRenderer:ge,indexColumnWidth:we,onRowsRendered:Se,visibleColumns:H,showExports:!0,setColumns:Ce,setData:be,setSort:a})]}),e[59]=re,e[60]=a,e[61]=le,e[62]=d,e[63]=te):te=e[63];const V=te;if(s){let o;return e[64]!==g||e[65]!==W||e[66]!==c||e[67]!==p||e[68]!==I||e[69]!==z||e[70]!==v||e[71]!==V||e[72]!==w||e[73]!==i||e[74]!==q||e[75]!==d||e[76]!==u?(o=r.jsx(De,{type:u,selection:i,columns:c,sort:d,clientColumns:g,columnRenderers:W,rowClassName:w,indexCellRenderer:p,indexColumnWidth:I,onRowsRendered:v,onColumnsLoaded:z,showErrorsProvided:q,children:V}),e[64]=g,e[65]=W,e[66]=c,e[67]=p,e[68]=I,e[69]=z,e[70]=v,e[71]=V,e[72]=w,e[73]=i,e[74]=q,e[75]=d,e[76]=u,e[77]=o):o=e[77],o}else{let o;return e[78]!==t||e[79]!==p||e[80]!==I||e[81]!==v||e[82]!==V||e[83]!==w||e[84]!==a||e[85]!==q?(o=r.jsx(Fe,{table:D,getTableProps:t,setSortState:a,showErrorsProvided:q,rowClassName:w,indexCellRenderer:p,indexColumnWidth:I,onRowsRendered:v,children:V}),e[78]=t,e[79]=p,e[80]=I,e[81]=v,e[82]=V,e[83]=w,e[84]=a,e[85]=q,e[86]=o):o=e[86],o}}function De({type:B,selection:e,columns:t,sort:s,clientColumns:D,columnRenderers:h,rowClassName:F,indexCellRenderer:u,indexColumnWidth:M,onRowsRendered:b,onColumnsLoaded:i,showErrorsProvided:E,children:j}){const{showDialog:c}=ae(),k=n.useMemo(()=>({...Ne(ue.endpoint,{type:B,selection_str:me(e),columns:Array.from(t.keys())},void 0,10),enabled:!0}),[B,e,t]),{data:x}=Te(k),[d,a]=n.useState([]),[R,g]=n.useState(new Set),A=x.data,m=n.useMemo(()=>{try{return he(A,s,t,D??[],h)}catch{return}},[s,t,A,D,h]),[W,O]=n.useState(m?.data),[f,w]=n.useState(m?.columnsInfo||[]),[S,y]=n.useState(m?.errors||[]);if(n.useEffect(()=>{f&&f.length>0&&i?.(f)},[f,i]),x.error)return r.jsxs("div",{className:"text-red-500",children:["Error: ",x.error]});if(!x.data)return r.jsx("div",{className:"text-red-500",children:"No data"});if(!m)return r.jsx("div",{className:"text-red-500",children:"Error: No data"});const p=n.useCallback(()=>{S.length>0?E(S):c("No errors","No errors to display",!0)},[S,E,c]),_=n.useMemo(()=>`/custom_table?${de({type:B,selAndModifiers:e,columns:t,sort:s})}`,[B,e,t,s]),T=n.useMemo(()=>r.jsxs(G,{variant:"outline",size:"sm",className:`me-1 ${S.length==0?"hidden":""}`,onClick:p,children:["View ",S.length," Errors"]}),[S.length,p]);return r.jsxs(r.Fragment,{children:[r.jsx(G,{variant:"outline",size:"sm",className:"me-1",asChild:!0,children:r.jsx(ve,{to:_,children:"Edit Table"})}),j(T,W,f,R,d,w,O,F,u,M,b)]})}function Fe({table:B,getTableProps:e,setSortState:t,showErrorsProvided:s,rowClassName:D,indexCellRenderer:h,indexColumnWidth:F,onRowsRendered:u,children:M}){const{showDialog:b}=ae(),i=je(),[E,j]=n.useState([]),[c,k]=n.useState([]),[x,d]=n.useState(new Set),[a,R]=n.useState([]),[g,A]=n.useState([]),[m,W]=n.useState(!1),O=e?.()?.onColumnsLoaded;n.useEffect(()=>{a&&a.length>0&&O?.(a)},[a,O]);const f=n.useCallback(()=>{g.length>0?s(g):b("No errors","No errors to display",!0)},[g,s,b]),w=n.useCallback(l=>{j(l.data),R(l.columnsInfo),k(l.visibleColumns),d(l.searchSet),A(l.errors),t(l.sort)},[j,R,k,d,A,t]),S=n.useMemo(()=>r.jsxs(G,{variant:"outline",size:"sm",className:`me-1 ${g.length==0?"hidden":""}`,onClick:f,children:["View ",g.length," Errors"]}),[g.length,f]),y=n.useCallback(l=>{const N=l instanceof Error?r.jsxs(r.Fragment,{children:[l.message,r.jsx(ke,{text:l.stack+""})]}):l+"";b("Failed to update table",N,!0)},[b]),p=n.useCallback((l,N,v)=>{try{const $=he(l,N,v,e().clientColumns??[],e().columnRenderers);w($)}catch($){y($)}},[w,y,e]),_=n.useCallback(()=>{const{type:l,selection:N,columns:v,sort:$}=e(),U={type:l,selection_str:me(N),columns:Array.from(v.keys())};W(!0),i.fetchQuery(Ee(ue.endpoint,U,0)).then(({data:z})=>{z?p(z,$,v):y("No data returned from server")}).catch(z=>{y(z)}).finally(()=>{W(!1)})},[e,p,i,y]),T="Generate Table",I=n.useMemo(()=>r.jsx(G,{variant:"destructive",size:"sm",className:"me-1 relative",onClick:_,disabled:m,children:r.jsxs("span",{className:"flex items-center justify-center w-full",children:[r.jsx("span",{className:m?"invisible":"visible",children:T}),m&&r.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx(Re,{size:3,variant:"ripple"})})]})}),[m,_,T]);return r.jsxs(r.Fragment,{children:[I,M(S,E,a,x,c,R,j,D,h,F,u)]})}export{Qe as A};
