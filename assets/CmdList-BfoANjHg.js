import{r as e,j as s,R as t}from"./index-CB60MK8B.js";import{a,q as l}from"./index.module-DJtxm5MH.js";import{B as r}from"./button-Dc6LF0a5.js";import{T as n,M as o,L as i}from"./CommandComponent-LRDIJNlC.js";import{I as c}from"./input-B_GU0jtO.js";import d from"./x-BkTRxgAy.js";import{C as m}from"./DialogContext-Ddeg3-RV.js";import{D as u,E as x}from"./loading-Cq9Kwdp4.js";import{c as f}from"./createLucideIcon-D4Rg0JTF.js";import p from"./chevron-up-Bvgl6Bzv.js";import h from"./chevron-down-COyK7xao.js";
/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=f("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);function g({annotation:t,set:a}){const l=e.useCallback(((e,s)=>{a((e=>{const a={...e};if("1"===s||"-1"===s){const e="1"===s;a[t]=s=>{var a;if("viewable"===t)return!0===s.command.viewable===e;const l=null==(a=s.command.annotations)?void 0:a[t];return"boolean"==typeof l?l===e:!!l===e}}else delete a[t];return a}))}),[t,a]);return s.jsx(n,{argName:t,initialValue:"0",setOutputValue:l})}const j=t.forwardRef((({value:e,onChange:a,onClear:l,onKeyDown:n,placeholder:o,className:i},m)=>{const u=t.useCallback((e=>{"Escape"===e.key&&l(),null==n||n(e)}),[l,n]);return s.jsxs("div",{className:"relative w-full",children:[s.jsx(c,{ref:m,className:["w-full pr-10 h-10",i??""].join(" "),type:"search",placeholder:o,value:e,onChange:a,onKeyDown:u,autoComplete:"off",spellCheck:!1}),e.trim().length>0&&s.jsx(r,{type:"button",variant:"ghost",size:"icon",onClick:l,className:"absolute right-1 top-1/2 h-7 w-7 -translate-y-1/2","aria-label":"Clear search",title:"Clear search (Esc)",children:s.jsx(d,{className:"h-4 w-4"})})]})}));j.displayName="SearchBar";const y=[{label:"Viewable",annotation:"viewable"},{label:"Whitelisted",annotation:"whitelist"},{label:"Whitelisted Coalition",annotation:"coalition"},{label:"Requires Alliance",annotation:"isalliance"},{label:"Requires API",annotation:"hasapi"},{label:"Requires Offshore",annotation:"hasoffshore"},{label:"Restricted Guild",annotation:"isguild"},{label:"Role annotation exists",annotation:"role"}];function v({label:e,children:t}){return s.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-md border border-border/60 bg-background px-2 py-1.5",children:[s.jsx("span",{className:"min-w-0 truncate text-sm",children:e}),s.jsx("div",{className:"shrink-0",children:t})]})}const N={Scroller:t.forwardRef((({style:e,className:t,...a},l)=>s.jsx("div",{ref:l,...a,style:e,className:["overflow-auto rounded-md border bg-card","[scrollbar-gutter:stable]","focus:outline-none",t??""].join(" ")}))),Table:({style:e,className:t,children:a,...l})=>s.jsxs("table",{...l,style:e,className:["w-full table-fixed border-separate border-spacing-0 text-sm",t??""].join(" "),children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"clamp(14rem, 32%, 22rem)"}}),s.jsx("col",{})]}),a]}),TableHead:t.forwardRef((({className:e,...t},a)=>s.jsx("thead",{...t,ref:a,className:["sticky top-0 z-10","bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",e??""].join(" ")}))),TableRow:({className:e,...t})=>s.jsx("tr",{...t,className:["align-top border-b border-border/60","hover:bg-muted/40",e??""].join(" ")}),TableBody:t.forwardRef((({className:e,...t},a)=>s.jsx("tbody",{...t,ref:a,className:["[&_tr:last-child]:border-b-0",e??""].join(" ")})))};function w({commands:t,prefix:c}){const[d,f]=e.useState(""),[w,k]=e.useState({}),[C,S]=e.useState(!1),[R,M]=e.useState(!1),[A,V]=e.useState(0),q=e.useRef(null);e.useEffect((()=>{const e=q.current;if(!e)return;const s=document.activeElement;(!s||s===document.body||s===document.documentElement)&&(e.focus(),e.select())}),[]);const[B]=a(d,120),T=d!==B,D=Object.keys(w).length,$=D>0||B.trim().length>0,O=e.useMemo((()=>new Set),[]),E=e.useMemo((()=>{if(!R)return null;const e=new WeakMap;for(const s of t){const t=new Set(s.getArguments().flatMap((e=>e.getTypeBreakdown().getAllChildren())));e.set(s,t)}return e}),[t,R]),F=e.useCallback((e=>(null==E?void 0:E.get(e))??O),[E,O]),z=e.useMemo((()=>{var e;if(!R)return[];const s=new Map;for(const a of t){const t=null==(e=a.command.annotations)?void 0:e.role;if(null==t?void 0:t.value)for(const e of t.value)s.set(e,(s.get(e)||0)+1)}return Array.from(s.entries()).sort((([e],[s])=>e.localeCompare(s))).map((([e,s])=>({label:`${e} (${s})`,value:e})))}),[t,R]),H=e.useMemo((()=>{if(!R)return[];const e=new Map;for(const s of t){const t=F(s);for(const s of t)e.set(s,(e.get(s)||0)+1)}return Array.from(e.entries()).sort((([e],[s])=>e.localeCompare(s))).map((([e,s])=>({label:`${e} (${s})`,value:e})))}),[t,R,F]),I=e.useMemo((()=>Object.values(w)),[w]),L=e.useMemo((()=>0===I.length?t:t.filter((e=>I.every((s=>s(e)))))),[t,I]),P=e.useMemo((()=>{const e=B.trim().toLowerCase();if(!e)return L;const s=u(e),t=new Set(e.split(/\s+/).filter(Boolean));return L.map((a=>({cmd:a,similarityScore:x(e,s,t,a)}))).filter((({similarityScore:e})=>e>0)).sort(((e,s)=>s.similarityScore-e.similarityScore)).map((({cmd:e})=>e))}),[L,B]),K=e.useMemo((()=>["Command\tDescription",...P.map((e=>`${`${c}${e.getPathString()}`}\t${(e.getDescShort()??"").replace(/\s+/g," ").trim()}`))].join("\n")),[P,c]),W=e.useCallback((()=>{S((e=>(e||M(!0),!e)))}),[]),G=e.useCallback((()=>{f(""),k({}),V((e=>e+1)),requestAnimationFrame((()=>{var e,s;null==(e=q.current)||e.focus(),null==(s=q.current)||s.select()}))}),[]),Q=e.useCallback((()=>{k({}),V((e=>e+1))}),[]),_=e.useCallback((e=>{f(e.target.value)}),[]),J=e.useCallback((e=>{"Escape"===e.key&&(f(""),requestAnimationFrame((()=>{var e,s;null==(e=q.current)||e.focus(),null==(s=q.current)||s.select()})))}),[]),U=e.useCallback((()=>{f(""),requestAnimationFrame((()=>{var e,s;null==(e=q.current)||e.focus(),null==(s=q.current)||s.select()}))}),[]),X=e.useCallback(((e,s)=>{k((e=>{const t={...e};if(s){const e=new Set(s.split(",").map((e=>e.trim())).filter(Boolean));t.hasrole=s=>{var t;const a=null==(t=s.command.annotations)?void 0:t.role;if(!(null==a?void 0:a.value))return!1;if(a.root)return!1;for(const l of a.value)if(e.has(l))return!0;return!1}}else delete t.hasrole;return t}))}),[]),Y=e.useCallback(((e,s)=>{k((e=>{const t={...e};if("1"===s||"-1"===s){const e="1"===s;t.hasarg=s=>!!(s.command.arguments&&Object.values(s.command.arguments).length>0)===e}else delete t.hasarg;return t}))}),[]),Z=e.useCallback(((e,s)=>{k((e=>{const t={...e};if(s){const e=new Set(s.split(",").map((e=>e.trim())).filter(Boolean));t.hasargs=s=>{if(!s.command.arguments)return!1;const t=F(s);for(const a of e)if(!t.has(a))return!1;return!0}}else delete t.hasargs;return t}))}),[F]),ee=e.useCallback((()=>s.jsxs("tr",{className:"border-b border-border/60 bg-muted/40",children:[s.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-xs font-medium text-muted-foreground",children:"Command"}),s.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-xs font-medium text-muted-foreground",children:"Description"})]})),[]),se=e.useCallback(((e,t)=>{const a=t.getPathString(),l=t.getDescShort();return s.jsxs(s.Fragment,{children:[s.jsx("td",{className:"px-3 py-2 align-top",children:s.jsxs("a",{href:`#command/${a}`,className:"block break-words font-mono text-sm font-semibold text-primary no-underline hover:underline",children:[s.jsx("span",{className:"text-muted-foreground",children:c}),a]})}),s.jsx("td",{className:"px-3 py-2 align-top",children:s.jsx("div",{className:"min-w-0 break-words text-sm text-foreground",children:s.jsx(o,{content:l})})})]})}),[c]),te=e.useCallback(((e,s)=>s.getPathString()),[]);return s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex w-full flex-col gap-2",children:[s.jsx(j,{ref:q,value:d,onChange:_,onClear:U,onKeyDown:J,placeholder:"Search commands (name, description, args)…",className:"w-full"}),s.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(r,{type:"button",size:"sm",variant:C||D>0?"secondary":"outline",onClick:W,"aria-expanded":C,"aria-controls":"cmd-filter-panel",className:"shrink-0 gap-2",title:"Filters",children:[s.jsx(b,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Filters"}),D>0&&s.jsx("span",{className:"inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-primary px-1 text-[11px] font-medium text-primary-foreground",children:D}),C?s.jsx(p,{className:"h-4 w-4 opacity-80"}):s.jsx(h,{className:"h-4 w-4 opacity-80"})]})}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsxs("div",{children:["Showing ",s.jsx("span",{className:"font-medium text-foreground",children:P.length.toLocaleString()})," of ",s.jsx("span",{className:"font-medium text-foreground",children:t.length.toLocaleString()})," commands",T?" (typing…)":""]}),P.length>0&&s.jsx(m,{text:"Copy table",copy:K,className:"h-6 px-2 text-xs"}),$&&s.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:G,className:"h-6 px-2 text-xs",title:"Clear search + filters",children:"Reset"})]})]})]}),R&&s.jsxs("div",{id:"cmd-filter-panel",className:["rounded-md border bg-muted/20 p-3",C?"block":"hidden"].join(" "),children:[s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsx("div",{className:"space-y-1",children:s.jsx("div",{className:"text-sm font-semibold",children:"Filters"})}),s.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:Q,disabled:0===D,className:"h-7 px-2",title:"Clear active filters",children:"Clear filters"})]}),s.jsxs("div",{className:"mt-3 grid gap-4",children:[s.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2 xl:grid-cols-3",children:[y.map((e=>s.jsx(v,{label:e.label,children:s.jsx(g,{annotation:e.annotation,set:k})},e.annotation))),s.jsx(v,{label:"Has Arguments",children:s.jsx(n,{argName:"hasarg",initialValue:"0",setOutputValue:Y})})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:[z.length>0&&s.jsxs("div",{className:"rounded-md border border-border/60 bg-background p-2",children:[s.jsx("div",{className:"mb-2 text-sm font-medium",children:"Require Roles (Any)"}),s.jsx(i,{argName:"hasrole",options:z,isMulti:!0,initialValue:"",setOutputValue:X})]}),H.length>0&&s.jsxs("div",{className:"rounded-md border border-border/60 bg-background p-2",children:[s.jsx("div",{className:"mb-2 text-sm font-medium",children:"Require Arguments (All)"}),s.jsx(i,{argName:"reqarg",options:H,isMulti:!0,initialValue:"",setOutputValue:Z})]})]})]},A)]}),P.length>0?s.jsx(l,{style:{height:"70vh"},data:P,computeItemKey:te,components:N,fixedHeaderContent:ee,itemContent:se,increaseViewportBy:800}):s.jsx("div",{className:"rounded-md border bg-card p-4 text-sm text-muted-foreground",children:"No commands match."})]})}N.Scroller.displayName="VirtuosoScroller",N.TableHead.displayName="VirtuosoTableHead",N.TableBody.displayName="VirtuosoTableBody";export{w as C};
