import{c as S,j as t,R as q,r as m}from"./index-Ci-lVsFi.js";import{T as z,M as se,L as I,X as ne}from"./CommandComponent-CIm2wK6D.js";import{l as re}from"./index.module-Cm1UP7MU.js";import{B as A}from"./button-CWqPuK0O.js";import{I as ae}from"./input-QGQmWr9A.js";import le from"./x-BXcCGRVm.js";import{C as oe}from"./DialogContext-ByDpcWnk.js";import{g as ie,s as ce}from"./command-utils-BU29VnaS.js";import{c as de}from"./createLucideIcon-BbdX0qUR.js";import ue from"./chevron-up-MD7nKQDD.js";import me from"./chevron-down-Bf66fNBy.js";const pe=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],he=de("sliders-horizontal",pe);function fe(i){const s=S.c(6),{annotation:e,set:o}=i;let a;s[0]!==e||s[1]!==o?(a=(h,p)=>{o(x=>{const C={...x};if(p==="1"||p==="-1"){const y=p==="1";C[e]=f=>{if(e==="viewable")return f.command.viewable===!0===y;const g=f.command.annotations?.[e];return typeof g=="boolean"?g===y:!!g===y}}else delete C[e];return C})},s[0]=e,s[1]=o,s[2]=a):a=s[2];const l=a;let c;return s[3]!==e||s[4]!==l?(c=t.jsx(z,{argName:e,initialValue:"0",setOutputValue:l}),s[3]=e,s[4]=l,s[5]=c):c=s[5],c}const H=q.forwardRef((i,s)=>{const e=S.c(18),{value:o,onChange:a,onClear:l,onKeyDown:c,placeholder:h,className:p}=i;let x;e[0]!==l||e[1]!==c?(x=F=>{F.key==="Escape"&&l(),c?.(F)},e[0]=l,e[1]=c,e[2]=x):x=e[2];const C=x,y=p??"";let f;e[3]!==y?(f=["w-full pr-10 h-10",y],e[3]=y,e[4]=f):f=e[4];const g=f.join(" ");let w;e[5]!==C||e[6]!==a||e[7]!==h||e[8]!==s||e[9]!==g||e[10]!==o?(w=t.jsx(ae,{ref:s,className:g,type:"search",placeholder:h,value:o,onChange:a,onKeyDown:C,autoComplete:"off",spellCheck:!1}),e[5]=C,e[6]=a,e[7]=h,e[8]=s,e[9]=g,e[10]=o,e[11]=w):w=e[11];let b;e[12]!==l||e[13]!==o?(b=o.trim().length>0&&t.jsx(A,{type:"button",variant:"ghost",size:"icon",onClick:l,className:"absolute right-1 top-1/2 h-7 w-7 -translate-y-1/2","aria-label":"Clear search",title:"Clear search (Esc)",children:t.jsx(le,{className:"h-4 w-4"})}),e[12]=l,e[13]=o,e[14]=b):b=e[14];let v;return e[15]!==w||e[16]!==b?(v=t.jsxs("div",{className:"relative w-full",children:[w,b]}),e[15]=w,e[16]=b,e[17]=v):v=e[17],v});H.displayName="SearchBar";const xe=[{label:"Viewable",annotation:"viewable"},{label:"Whitelisted",annotation:"whitelist"},{label:"Whitelisted Coalition",annotation:"coalition"},{label:"Requires Alliance",annotation:"isalliance"},{label:"Requires API",annotation:"hasapi"},{label:"Requires Offshore",annotation:"hasoffshore"},{label:"Restricted Guild",annotation:"isguild"},{label:"Role annotation exists",annotation:"role"}];function O(i){const s=S.c(7),{label:e,children:o}=i;let a;s[0]!==e?(a=t.jsx("span",{className:"min-w-0 truncate text-sm",children:e}),s[0]=e,s[1]=a):a=s[1];let l;s[2]!==o?(l=t.jsx("div",{className:"shrink-0",children:o}),s[2]=o,s[3]=l):l=s[3];let c;return s[4]!==a||s[5]!==l?(c=t.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-md border border-border/60 bg-background px-2 py-1.5",children:[a,l]}),s[4]=a,s[5]=l,s[6]=c):c=s[6],c}const T={Scroller:q.forwardRef((i,s)=>{const e=S.c(11);let o,a,l;e[0]!==i?({style:l,className:o,...a}=i,e[0]=i,e[1]=o,e[2]=a,e[3]=l):(o=e[1],a=e[2],l=e[3]);const c=o??"";let h;e[4]!==c?(h=["overflow-auto rounded-md border bg-card","[scrollbar-gutter:stable]","focus:outline-none",c],e[4]=c,e[5]=h):h=e[5];const p=h.join(" ");let x;return e[6]!==a||e[7]!==s||e[8]!==l||e[9]!==p?(x=t.jsx("div",{ref:s,...a,style:l,className:p}),e[6]=a,e[7]=s,e[8]=l,e[9]=p,e[10]=x):x=e[10],x}),Table:({style:i,className:s,children:e,...o})=>t.jsx("table",{...o,style:i,className:["w-full table-auto border-separate border-spacing-0 text-sm",s??""].join(" "),children:e}),TableHead:q.forwardRef((i,s)=>{const e=S.c(9);let o,a;e[0]!==i?({className:o,...a}=i,e[0]=i,e[1]=o,e[2]=a):(o=e[1],a=e[2]);const l=o??"";let c;e[3]!==l?(c=["sticky top-0 z-10","bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60",l],e[3]=l,e[4]=c):c=e[4];const h=c.join(" ");let p;return e[5]!==a||e[6]!==s||e[7]!==h?(p=t.jsx("thead",{...a,ref:s,className:h}),e[5]=a,e[6]=s,e[7]=h,e[8]=p):p=e[8],p}),TableRow:({className:i,...s})=>t.jsx("tr",{...s,className:["align-top border-b border-border/60","hover:bg-muted/40",i??""].join(" ")}),TableBody:q.forwardRef((i,s)=>{const e=S.c(9);let o,a;e[0]!==i?({className:o,...a}=i,e[0]=i,e[1]=o,e[2]=a):(o=e[1],a=e[2]);const l=o??"";let c;e[3]!==l?(c=["[&_tr:last-child]:border-b-0",l],e[3]=l,e[4]=c):c=e[4];const h=c.join(" ");let p;return e[5]!==a||e[6]!==s||e[7]!==h?(p=t.jsx("tbody",{...a,ref:s,className:h}),e[5]=a,e[6]=s,e[7]=h,e[8]=p):p=e[8],p})};T.Scroller.displayName="VirtuosoScroller";T.TableHead.displayName="VirtuosoTableHead";T.TableBody.displayName="VirtuosoTableBody";function Me({commands:i,prefix:s}){const[e,o]=m.useState(""),[a,l]=m.useState({}),[c,h]=m.useState(!1),[p,x]=m.useState(!1),[C,y]=m.useState(0),f=m.useRef(null);m.useEffect(()=>{const n=f.current;if(!n)return;const r=document.activeElement;(!r||r===document.body||r===document.documentElement)&&(n.focus(),n.select())},[]);const[g]=re(e,120),w=e!==g,b=Object.keys(a).length,v=b>0||g.trim().length>0,F=m.useMemo(()=>new Set,[]),_=m.useMemo(()=>{if(!p)return null;const n=new WeakMap;for(const r of i){const u=new Set(r.getArguments().flatMap(d=>d.getTypeBreakdown().getAllChildren()));n.set(r,u)}return n},[i,p]),R=m.useCallback(n=>_?.get(n)??F,[_,F]),E=m.useMemo(()=>{if(!p)return[];const n=new Map;for(const r of i){const u=r.command.annotations?.role;if(u?.value)for(const d of u.value)n.set(d,(n.get(d)||0)+1)}return Array.from(n.entries()).sort(([r],[u])=>r.localeCompare(u)).map(([r,u])=>({label:`${r} (${u})`,value:r}))},[i,p]),D=m.useMemo(()=>{if(!p)return[];const n=new Map;for(const r of i){const u=R(r);for(const d of u)n.set(d,(n.get(d)||0)+1)}return Array.from(n.entries()).sort(([r],[u])=>r.localeCompare(u)).map(([r,u])=>({label:`${r} (${u})`,value:r}))},[i,p,R]),$=m.useMemo(()=>Object.values(a),[a]),B=m.useMemo(()=>$.length===0?i:i.filter(n=>$.every(r=>r(n))),[i,$]),k=m.useMemo(()=>{const n=g.trim().toLowerCase();if(!n)return B;const r=ie(n),u=new Set(n.split(/\s+/).filter(Boolean));return B.map(d=>({cmd:d,similarityScore:ce(n,r,u,d)})).filter(({similarityScore:d})=>d>0).sort((d,N)=>N.similarityScore-d.similarityScore).map(({cmd:d})=>d)},[B,g]),K=m.useMemo(()=>{const n="Command	Description",r=k.map(u=>{const d=`${s}${u.getPathString()}`,N=(u.getDescShort()??"").replace(/\s+/g," ").trim();return`${d}	${N}`});return[n,...r].join(`
`)},[k,s]),L=m.useCallback(()=>{h(n=>(n||x(!0),!n))},[]),P=m.useCallback(()=>{o(""),l({}),y(n=>n+1),requestAnimationFrame(()=>{f.current?.focus(),f.current?.select()})},[]),W=m.useCallback(()=>{l({}),y(n=>n+1)},[]),U=m.useCallback(n=>{o(n.target.value)},[]),X=m.useCallback(n=>{n.key==="Escape"&&(o(""),requestAnimationFrame(()=>{f.current?.focus(),f.current?.select()}))},[]),G=m.useCallback(()=>{o(""),requestAnimationFrame(()=>{f.current?.focus(),f.current?.select()})},[]),Y=m.useCallback((n,r)=>{l(u=>{const d={...u};if(r){const N=new Set(r.split(",").map(j=>j.trim()).filter(Boolean));d.hasrole=j=>{const M=j.command.annotations?.role;if(!M?.value||M.root)return!1;for(const V of M.value)if(N.has(V))return!0;return!1}}else delete d.hasrole;return d})},[]),J=m.useCallback((n,r)=>{l(u=>{const d={...u};if(r==="1"||r==="-1"){const N=r==="1";d.hasarg=j=>!!(j.command.arguments&&Object.values(j.command.arguments).length>0)===N}else delete d.hasarg;return d})},[]),Q=m.useCallback((n,r)=>{l(u=>{const d={...u};if(r){const N=new Set(r.split(",").map(j=>j.trim()).filter(Boolean));d.hasargs=j=>{if(!j.command.arguments)return!1;const M=R(j);for(const V of N)if(!M.has(V))return!1;return!0}}else delete d.hasargs;return d})},[R]),Z=m.useCallback(()=>t.jsxs("tr",{className:"border-b border-border/60 bg-muted/40",children:[t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-xs font-medium text-muted-foreground",children:"Command"}),t.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-xs font-medium text-muted-foreground",children:"Description"})]}),[]),ee=m.useCallback((n,r)=>{const u=r.getPathString(),d=r.getDescShort();return t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"px-3 py-2 align-top w-[24rem] max-w-lg",children:t.jsxs("a",{href:`#command/${u}`,className:"block break-all font-mono text-sm font-semibold text-primary no-underline hover:underline",children:[t.jsx("span",{className:"text-muted-foreground",children:s}),u]})}),t.jsx("td",{className:"px-3 py-2 align-top",children:t.jsx("div",{className:"min-w-0 wrap-break-word whitespace-normal text-sm text-foreground",children:t.jsx(se,{content:d})})})]})},[s]),te=m.useCallback((n,r)=>r.getPathString(),[]);return t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex w-full flex-col gap-2",children:[t.jsx(H,{ref:f,value:e,onChange:U,onClear:G,onKeyDown:X,placeholder:"Search commands (name, description, args)…",className:"w-full"}),t.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(A,{type:"button",size:"sm",variant:c||b>0?"secondary":"outline",onClick:L,"aria-expanded":c,"aria-controls":"cmd-filter-panel",className:"shrink-0 gap-2",title:"Filters",children:[t.jsx(he,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Filters"}),b>0&&t.jsx("span",{className:"inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-primary px-1 text-[11px] font-medium text-primary-foreground",children:b}),c?t.jsx(ue,{className:"h-4 w-4 opacity-80"}):t.jsx(me,{className:"h-4 w-4 opacity-80"})]})}),t.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 text-xs text-muted-foreground",children:[t.jsxs("div",{children:["Showing ",t.jsx("span",{className:"font-medium text-foreground",children:k.length.toLocaleString()})," of ",t.jsx("span",{className:"font-medium text-foreground",children:i.length.toLocaleString()})," commands",w?" (typing…)":""]}),k.length>0&&t.jsx(oe,{text:"Copy table",copy:K,className:"h-6 px-2 text-xs"}),v&&t.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:P,className:"h-6 px-2 text-xs",title:"Clear search + filters",children:"Reset"})]})]})]}),p&&t.jsxs("div",{id:"cmd-filter-panel",className:["rounded-md border bg-muted/20 p-3",c?"block":"hidden"].join(" "),children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsx("div",{className:"space-y-1",children:t.jsx("div",{className:"text-sm font-semibold",children:"Filters"})}),t.jsx(A,{type:"button",variant:"outline",size:"sm",onClick:W,disabled:b===0,className:"h-7 px-2",title:"Clear active filters",children:"Clear filters"})]}),t.jsxs("div",{className:"mt-3 grid gap-4",children:[t.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2 xl:grid-cols-3",children:[xe.map(n=>t.jsx(O,{label:n.label,children:t.jsx(fe,{annotation:n.annotation,set:l})},n.annotation)),t.jsx(O,{label:"Has Arguments",children:t.jsx(z,{argName:"hasarg",initialValue:"0",setOutputValue:J})})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:[E.length>0&&t.jsxs("div",{className:"rounded-md border border-border/60 bg-background p-2",children:[t.jsx("div",{className:"mb-2 text-sm font-medium",children:"Require Roles (Any)"}),t.jsx(I,{argName:"hasrole",options:E,isMulti:!0,initialValue:"",setOutputValue:Y})]}),D.length>0&&t.jsxs("div",{className:"rounded-md border border-border/60 bg-background p-2",children:[t.jsx("div",{className:"mb-2 text-sm font-medium",children:"Require Arguments (All)"}),t.jsx(I,{argName:"reqarg",options:D,isMulti:!0,initialValue:"",setOutputValue:Q})]})]})]},C)]}),k.length>0?t.jsx(ne,{style:{height:"70vh"},data:k,computeItemKey:te,components:T,fixedHeaderContent:Z,itemContent:ee,increaseViewportBy:800}):t.jsx("div",{className:"rounded-md border bg-card p-4 text-sm text-muted-foreground",children:"No commands match."})]})}export{Me as C};
