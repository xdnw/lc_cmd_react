import{r as A,c as me,j as s,R as je}from"./index-SOjtd1du.js";import{d as we,B as re,g as Se}from"./button-C6_F57E5.js";import{g as ke,D as ce,r as Ne,a as Te,b as Ae,c as De,d as $e,e as Oe,f as Ve}from"./table_util-BV1C7Yj5.js";import{c as Ee,l as Fe}from"./index.module-DOAdZp43.js";import{Y as ye,C as Le,A as Me}from"./CommandComponent-Bi1lNJuB.js";import{C as he,t as be,g as Re}from"./command-utils-BF18nFEX.js";import{u as _e,b as ze,c as Be,d as Pe,T as Ce,B as ve}from"./DialogContext-DiRAa5qs.js";import{I as ge}from"./input-DGDhAddh.js";import{a as ue}from"./StateUtil-D0CNNC7k.js";import{L as de}from"./queries-BzWnpVnq.js";import{A as Ue}from"./AbstractTable-D8eF6Ygf.js";import"./command-meta-Dt1HocaT.js";import"./SimpleChart-V9M2bt1B.js";import"./dropdown-menu-B_MP3PX6.js";import"./theme-provider-BQwJ-LrG.js";import"./bulkwrapper-CSppeL3K.js";import"./useSuspenseQuery-7uza5ut4.js";import"./DataTable-CoJvVKo_.js";const He=A.forwardRef(function(e,l){const t=me.c(46),{defType:n,defSelection:o,defColumns:u,defSort:i}=e,{showDialog:d,hideDialog:b}=_e(),[r,y]=ue(n),[C,v]=ue(o),[h,F]=A.useState(u),[j,O]=ue(i);let E,_;t[0]!==h||t[1]!==C||t[2]!==j||t[3]!==r?(E=()=>({getType:()=>r,getSelection:()=>C,getColumns:()=>h,getSort:()=>j}),_=[r,C,h,j],t[0]=h,t[1]=C,t[2]=j,t[3]=r,t[4]=E,t[5]=_):(E=t[4],_=t[5]),A.useImperativeHandle(l,E,_);let m,g;t[6]===Symbol.for("react.memo_cache_sentinel")?(g=he.getPlaceholderTypes(!1),t[6]=g):g=t[6],m=g;const S=m;let N;t[7]!==h||t[8]!==C||t[9]!==j||t[10]!==r?(N=()=>{const W=ke({type:r,selAndModifiers:C,columns:h,sort:j}),G=window.location.hash,[Y]=G.split("?"),M=`${Y}?${W}`;window.history.replaceState(null,"",`${window.location.pathname}${M}`)},t[7]=h,t[8]=C,t[9]=j,t[10]=r,t[11]=N):N=t[11];const $=N;let c;t[12]!==$?(c=()=>{$()},t[12]=$,t[13]=c):c=t[13];let p;t[14]!==h||t[15]!==C||t[16]!==$||t[17]!==j||t[18]!==r?(p=[r,C,h,j,$],t[14]=h,t[15]=C,t[16]=$,t[17]=j,t[18]=r,t[19]=p):p=t[19],A.useEffect(c,p);let D;t[20]!==v||t[21]!==O||t[22]!==y?(D=W=>{const G=W;y(G);const Y=ce[G]?.selections,M=ce[G]?.columns;if(Y&&Object.keys(Y).length>0&&v({"":Y[Object.keys(Y)[0]]}),M&&Object.keys(M).length>0){const X=M[Object.keys(M)[0]];F(new Map(X.value.map(it))),O(oe=>we(oe,X.sort)?oe:X.sort)}},t[20]=v,t[21]=O,t[22]=y,t[23]=D):D=t[23];const L=D;let V;t[24]===Symbol.for("react.memo_cache_sentinel")?(V=W=>s.jsx(Be,{value:S[W],className:"w-auto px-3",children:be(S[W])},S[W]),t[24]=V):V=t[24];const I=V;let P,z;t[25]===Symbol.for("react.memo_cache_sentinel")?(z={overflow:"hidden"},t[25]=z):z=t[25];let B;t[26]===Symbol.for("react.memo_cache_sentinel")?(B=s.jsx(ze,{className:"min-w-full min-h-0 h-8.5 rounded-lg border border-border bg-card p-0",style:z,children:s.jsx(ye,{totalCount:S.length,style:{height:"100%",width:"100%"},horizontalDirection:!0,itemContent:I})}),t[26]=B):B=t[26],P=B;const U=P;let H,K;t[27]===Symbol.for("react.memo_cache_sentinel")?(K=s.jsx("div",{className:"w-full overflow-x-auto",children:U}),t[27]=K):K=t[27];let Q;t[28]!==n||t[29]!==L?(Q=s.jsx(Pe,{defaultValue:n,className:"w-full",onValueChange:L,children:K}),t[28]=n,t[29]=L,t[30]=Q):Q=t[30],H=Q;const q=H;let se,Z;t[31]!==C||t[32]!==v||t[33]!==r?(Z=s.jsx(Je,{type:r,selection:C,setSelection:v,selectedTab:r}),t[31]=C,t[32]=v,t[33]=r,t[34]=Z):Z=t[34],se=Z;const ie=se;let J,ae;t[35]!==h||t[36]!==b||t[37]!==O||t[38]!==d||t[39]!==j||t[40]!==r?(ae=s.jsx(Ke,{type:r,columns:h,setColumns:F,sort:j,setSort:O,showDialog:d,hideDialog:b}),t[35]=h,t[36]=b,t[37]=O,t[38]=d,t[39]=j,t[40]=r,t[41]=ae):ae=t[41],J=ae;const ne=J;let le;return t[42]!==ne||t[43]!==ie||t[44]!==q?(le=s.jsxs(s.Fragment,{children:[q,ie,ne]}),t[42]=ne,t[43]=ie,t[44]=q,t[45]=le):le=t[45],le});function Ke(f){const e=me.c(85),{type:l,columns:t,setColumns:n,sort:o,setSort:u,showDialog:i,hideDialog:d}=f,[b,r]=A.useState(!1);let y;e[0]!==l?(y=Object.keys(ce[l]?.columns??{}),e[0]=l,e[1]=y):y=e[1];const[C,v]=ue(y);let h,F;e[2]!==v||e[3]!==l?(h=()=>{v(Object.keys(ce[l]?.columns??{}))},F=[l,v],e[2]=v,e[3]=l,e[4]=h,e[5]=F):(h=e[4],F=e[5]),A.useEffect(h,F);const j=A.useRef(null),O=A.useRef(null);let E;e[6]!==t||e[7]!==n||e[8]!==u||e[9]!==o?(E=(a,x)=>{const T=Array.from(t);if(x<0||x>=T.length)return;const[R]=T.splice(a,1);T.splice(x,0,R);const k=new Map(T);let ee;if(Array.isArray(o))ee=o.map(w=>w.idx===a?{...w,idx:x}:w.idx===x?{...w,idx:a}:w.idx>a&&w.idx<=x?{...w,idx:w.idx-1}:w.idx<a&&w.idx>=x?{...w,idx:w.idx+1}:w);else if(o){const w={...o};w.idx===a?w.idx=x:w.idx===x?w.idx=a:w.idx>a&&w.idx<=x?w.idx=w.idx-1:w.idx<a&&w.idx>=x&&(w.idx=w.idx+1),ee=w}else ee=void 0;n(k),u(ee)},e[6]=t,e[7]=n,e[8]=u,e[9]=o,e[10]=E):E=e[10];const _=E;let m;e[11]===Symbol.for("react.memo_cache_sentinel")?(m=a=>{a.preventDefault();const T=a.clipboardData.getData("text").replace(/\r?\n|\r/g,"	");if(O.current){const{selectionStart:R,selectionEnd:k,value:ee}=O.current,w=ee.slice(0,R)+T+ee.slice(k);O.current.value=w}},e[11]=m):m=e[11];const g=m;let S;e[12]!==t||e[13]!==n?(S=a=>{if(a.key.length===1||a.key==="Backspace"){const x=document.activeElement,T=x.id.startsWith("btn-")?x.id.split("-")[1]:"";if(!T)return;const R=x.querySelector("span"),k=a.key,ee=t.get(T)||"",w=new Map(t);if(k==="Backspace"){const te=ee.slice(0,-1);w.set(T,te||null),R.firstChild.textContent=te.trim()?` as ${te}`:"​"}else{a.key===" "&&a.preventDefault();const te=ee.trim()+k;w.set(T,te),R.firstChild.textContent=` as ${te}`}n(w)}},e[12]=t,e[13]=n,e[14]=S):S=e[14];const N=S;let $,c;e[15]!==N?($=()=>(document.addEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}),c=[N],e[15]=N,e[16]=$,e[17]=c):($=e[16],c=e[17]),A.useEffect($,c);let p;e[18]!==t||e[19]!==n||e[20]!==i?(p=()=>{const a=O.current;if(!a)return;const x=a.value;if(x===""){i("Column name cannot be empty","Please enter a column name before adding");return}const T=x.split("	"),R=[],k=new Map(t);for(const ee of T){if(ee==="")continue;const w=ee.split(";");if(!w[0])continue;let te=w[0];if(!te.includes("{")&&!te.includes("}")&&(te="{"+te+"}"),k.has(te)&&k.get(te)===(w[1]??null)){R.push("Column `"+ee+"` is already added");continue}k.set(te,w[1]||null)}a.value="",R.length>0&&i("Errors adding columns",R.join(`
`)),n(k)},e[18]=t,e[19]=n,e[20]=i,e[21]=p):p=e[21];const D=p;let L;e[22]!==n||e[23]!==u||e[24]!==i||e[25]!==l?(L=(a,x)=>{const T=Ne(l,a,x)??ce[l]?.columns[a];if(!T){i("Template not found",`Could not find column template "${a}" for ${l}.`);return}const R=new Map((T?.value||["{id}"]).map(Ie)),k=T?.sort||{idx:0,dir:"asc"};n(R),u(k)},e[22]=n,e[23]=u,e[24]=i,e[25]=l,e[26]=L):L=e[26];const V=L;let I;e[27]!==V||e[28]!==d||e[29]!==i?(I=(a,x)=>{try{V(a,x),d()}catch(T){const R=T,k=R instanceof Error?R.message:String(R);i("Layout configuration error",k)}},e[27]=V,e[28]=d,e[29]=i,e[30]=I):I=e[30];const P=I;let z;e[31]!==V||e[32]!==P||e[33]!==d||e[34]!==i||e[35]!==l?(z=a=>{const x=Te(l,a);if(!x){V(a);return}i(`Configure ${a}`,s.jsx(lt,{templateName:a,config:x,onCancel:d,onApplyTemplate:P}))},e[31]=V,e[32]=P,e[33]=d,e[34]=i,e[35]=l,e[36]=z):z=e[36];const B=z;let U;e[37]!==t||e[38]!==n||e[39]!==u||e[40]!==o?(U=(a,x)=>{const T=new Map(t);T.delete(a[0]);let R;if(Array.isArray(o))R=o.filter(k=>k.idx!==x).map(k=>({...k,idx:k.idx>x?k.idx-1:k.idx}));else if(o){const k={...o};k.idx===x?k.idx=0:k.idx>x&&(k.idx=k.idx-1),R=k}else R=void 0;n(T),u(R)},e[37]=t,e[38]=n,e[39]=u,e[40]=o,e[41]=U):U=e[41];const H=U;let K;e[42]!==u||e[43]!==o?(K=(a,x)=>{let T;if(Array.isArray(o)){const R=o.findIndex(k=>k.idx===a);if(R!==-1){const k=[...o];k[R].dir==="asc"?k[R].dir="desc":k.splice(R,1),T=k}else x&&o.length>0?T=[...o,{idx:a,dir:"asc"}]:T={idx:a,dir:"asc"}}else o?o.idx!==a?x&&o.idx!==0?T=[{idx:o.idx,dir:o.dir},{idx:a,dir:"asc"}]:T={idx:a,dir:"asc"}:o.dir==="asc"?T={idx:a,dir:"desc"}:T=void 0:T={idx:a,dir:"asc"};u(T)},e[42]=u,e[43]=o,e[44]=K):K=e[44];const Q=K;let q;e[45]!==n||e[46]!==u?(q=()=>{n(new Map),u({idx:0,dir:"asc"})},e[45]=n,e[46]=u,e[47]=q):q=e[47];const se=q;let Z;e[48]!==t||e[49]!==n?(Z=a=>{const x="{"+a[0]+"}",T=new Map(t);T.set(x,null),n(T)},e[48]=t,e[49]=n,e[50]=Z):Z=e[50];const ie=Z;let J;e[51]===Symbol.for("react.memo_cache_sentinel")?(J=()=>{r(We)},e[51]=J):J=e[51];const ae=J;let ne;e[52]!==B?(ne=a=>{const x=a.currentTarget.dataset.key;x&&B(x)},e[52]=B,e[53]=ne):ne=e[53];const le=ne;let W;e[54]!==b?(W=s.jsxs(re,{variant:"ghost",size:"sm",className:"text-xs font-semibold w-full border-b border-border px-2 bg-muted/40 rounded-none justify-start",onClick:ae,children:["Columns ",b?s.jsx(de,{name:"ChevronDown"}):s.jsx(de,{name:"ChevronUp"})]}),e[54]=b,e[55]=W):W=e[55];const G=`transition-all duration-200 ease-in-out ${b?"max-h-0 opacity-0 overflow-hidden":"px-2 py-1.5 opacity-100 space-y-1.5"}`;let Y;e[56]===Symbol.for("react.memo_cache_sentinel")?(Y=s.jsx("h2",{className:"text-sm font-semibold mb-0.5",children:"Templates"}),e[56]=Y):Y=e[56];let M;if(e[57]!==le||e[58]!==C){let a;e[60]!==le?(a=x=>s.jsx(re,{variant:"outline",size:"sm",className:"me-1","data-key":x,onClick:le,children:x},x),e[60]=le,e[61]=a):a=e[61],M=C.map(a),e[57]=le,e[58]=C,e[59]=M}else M=e[59];let X;e[62]!==se||e[63]!==t||e[64]!==Q||e[65]!==_||e[66]!==H||e[67]!==o?(X=s.jsx(Qe,{columns:t,sort:o,moveColumn:_,removeColumn:H,handleColumnSort:Q,clearAllColumns:se}),e[62]=se,e[63]=t,e[64]=Q,e[65]=_,e[66]=H,e[67]=o,e[68]=X):X=e[68];let oe;e[69]!==D||e[70]!==l?(oe=s.jsx(Ye,{colInputRef:O,addButton:j,handlePaste:g,handleAddColumn:D,type:l}),e[69]=D,e[70]=l,e[71]=oe):oe=e[71];let fe;e[72]!==ie||e[73]!==t||e[74]!==l?(fe=s.jsx(Ze,{type:l,columns:t,addSimpleColumn:ie}),e[72]=ie,e[73]=t,e[74]=l,e[75]=fe):fe=e[75];let pe;e[76]!==G||e[77]!==M||e[78]!==X||e[79]!==oe||e[80]!==fe?(pe=s.jsxs("div",{className:G,children:[Y,M,X,oe,fe]}),e[76]=G,e[77]=M,e[78]=X,e[79]=oe,e[80]=fe,e[81]=pe):pe=e[81];let xe;return e[82]!==W||e[83]!==pe?(xe=s.jsxs("div",{className:"themeDiv mt-1.5 overflow-hidden",children:[W,pe]}),e[82]=W,e[83]=pe,e[84]=xe):xe=e[84],xe}function We(f){return!f}function Ie(f){return Array.isArray(f)?[f[0],f[1]]:[f,null]}function Qe(f){const e=me.c(28),{columns:l,sort:t,moveColumn:n,removeColumn:o,handleColumnSort:u,clearAllColumns:i}=f,d=Ge;let b;e[0]!==u?(b=c=>{if(c.button===1){const p=parseInt(c.currentTarget.dataset.key||"0",10);return c.preventDefault(),u(p,c.shiftKey),!1}},e[0]=u,e[1]=b):b=e[1];const r=b;let y;e[2]!==l?(y=()=>Array.from(l).map(qe).join(`
`),e[2]=l,e[3]=y):y=e[3];const C=y;let v;e[4]!==n?(v=c=>{const p=parseInt(c.currentTarget.dataset.from??"0",10),D=parseInt(c.currentTarget.dataset.to??"0",10);c.preventDefault(),p!==D&&n(p,D)},e[4]=n,e[5]=v):v=e[5];const h=v;let F;e[6]!==l||e[7]!==o?(F=c=>{const p=parseInt(c.currentTarget.dataset.key??"0",10),D=c.currentTarget.dataset.column,L=[D,l.get(D)??null];c.preventDefault(),o(L,p)},e[6]=l,e[7]=o,e[8]=F):F=e[8];const j=F;let O,E,_;e[9]===Symbol.for("react.memo_cache_sentinel")?(O=s.jsx("h2",{className:"text-sm font-semibold mt-0.5 pb-0 mb-0",children:"Current Columns"}),E=s.jsx("span",{className:"text-[10px] opacity-50 leading-tight",children:"left-click to remove | middle-click to sort | shift+middle to sort by multiple | right click and type/backspace to edit alias | clipboard button to copy"}),_=s.jsx("br",{}),e[9]=O,e[10]=E,e[11]=_):(O=e[9],E=e[10],_=e[11]);let m;e[12]!==l?(m=Array.from(l),e[12]=l,e[13]=m):m=e[13];let g;e[14]!==h||e[15]!==j||e[16]!==t||e[17]!==m||e[18]!==r?(g=m.map((c,p)=>s.jsxs("span",{className:"inline-flex items-center bg-background rounded me-1 mb-1",children:[s.jsx(de,{name:"ChevronLeft",className:"cursor-pointer w-4 h-6 rounded-s hover:bg-accent","data-from":p,"data-to":p-1,onClick:h}),s.jsxs(re,{"data-key":p,id:"btn-"+c[0],variant:"outline",size:"sm",className:"rounded-none border-r-input/50 border-l-input/50 inline-block",onContextMenu:d,"data-column":c[0],"data-index":p,onClick:j,onMouseDown:r,children:[c[0],s.jsx("span",{className:"text-xs opacity-50",children:c[1]&&c[1]!==c[0]?` as ${c[1]}`:"​"},`colspan-${p}`),t&&(Array.isArray(t)?t.map((D,L)=>D.idx===p&&s.jsxs("span",{className:"bg-red-400 dark:bg-red-900 text-xs ml-1",children:[D.dir," (",L+1,")"]},`sort-${p}-${L}`)):t.idx===p&&s.jsx("span",{className:"bg-red-400 dark:bg-red-900 text-xs ml-1",children:t.dir},`sort-${p}`))]},c[0]),s.jsx(de,{name:"ChevronRight",className:"cursor-pointer inline-block w-4 rounded-e hover:bg-accent align-middle","data-from":p,"data-to":p+1,onClick:h})]},`spw-${p}`)),e[14]=h,e[15]=j,e[16]=t,e[17]=m,e[18]=r,e[19]=g):g=e[19];let S;e[20]!==C?(S=s.jsx(Ce,{children:s.jsx(ve,{getText:C,className:"rounded [&_svg]:size-3.5 me-1",size:"sm"})}),e[20]=C,e[21]=S):S=e[21];let N;e[22]!==i?(N=s.jsx(re,{variant:"destructive",size:"sm",className:"rounded",onClick:i,children:"X"}),e[22]=i,e[23]=N):N=e[23];let $;return e[24]!==S||e[25]!==N||e[26]!==g?($=s.jsxs(s.Fragment,{children:[O,E,_,s.jsxs("div",{className:"inline-flex flex-wrap items-center gap-1",children:[g,S,N]})]}),e[24]=S,e[25]=N,e[26]=g,e[27]=$):$=e[27],$}function qe(f){const[e,l]=f;return l?`${e};${l}`:e}function Ge(f){f.preventDefault(),f.currentTarget.focus()}function Ye(f){const e=me.c(28),{colInputRef:l,addButton:t,handleAddColumn:n,handlePaste:o,type:u}=f,[i,d]=A.useState(""),b=A.useRef(i);let r,y;e[0]!==i?(r=()=>{b.current=i},y=[i],e[0]=i,e[1]=r,e[2]=y):(r=e[1],y=e[2]),A.useEffect(r,y);let C;e[3]!==l||e[4]!==n?(C=H=>{if(H.key==="Enter")H.preventDefault(),b.current&&(n(),d(""));else if(H.key==="Tab"){H.preventDefault();const K=l.current;if(K){const Q=K.selectionStart,q=K.selectionEnd;if(Q!==null&&q!==null){const se=b.current,Z=se.slice(0,Q)+"	"+se.slice(q);d(Z),setTimeout(()=>{K.setSelectionRange(Q+1,Q+1)},0)}}}},e[3]=l,e[4]=n,e[5]=C):C=e[5];const v=C;let h;e[6]===Symbol.for("react.memo_cache_sentinel")?(h=H=>{d(H.target.value)},e[6]=h):h=e[6];const F=h;let j,O;e[7]===Symbol.for("react.memo_cache_sentinel")?(O=s.jsxs(s.Fragment,{children:[s.jsx("h2",{className:"text-sm font-semibold mt-0.5 mb-0 p-0",children:"Add Custom"}),s.jsx("span",{className:"text-[10px] opacity-50 leading-tight",children:"type or paste in the placeholder, then press Enter | Use tab for multiple | Use semicolon ;BLAH for column alias"})]}),e[7]=O):O=e[7],j=O;const E=j;let _,m;e[8]!==l||e[9]!==o||e[10]!==i||e[11]!==v?(m=s.jsx(ge,{type:"text",className:"relative px-1 grow",placeholder:"Custom column placeholders...",ref:l,onPaste:o,onKeyDown:v,onChange:F,value:i}),e[8]=l,e[9]=o,e[10]=i,e[11]=v,e[12]=m):m=e[12],_=m;const g=_;let S;e[13]!==n||e[14]!==i?(S=()=>{i&&(n(),d(""))},e[13]=n,e[14]=i,e[15]=S):S=e[15];const N=S;let $,c;e[16]!==t||e[17]!==N?(c=s.jsx(re,{variant:"destructive",ref:t,size:"sm",className:"ml-2",onClick:N,children:"Add"}),e[16]=t,e[17]=N,e[18]=c):c=e[18],$=c;const p=$;let D,L;e[19]!==p||e[20]!==g?(L=s.jsxs("div",{className:"flex w-full",children:[g,p]}),e[19]=p,e[20]=g,e[21]=L):L=e[21],D=L;const V=D;let I;const P=`https://github.com/xdnw/locutus/wiki/${u}_placeholders`;let z;e[22]!==P||e[23]!==u?(z=s.jsxs("a",{href:P,className:"text-xs text-blue-800 dark:text-blue-400 underline hover:no-underline active:underline",target:"_blank",rel:"noreferrer",children:["View All ",u," Placeholders"]}),e[22]=P,e[23]=u,e[24]=z):z=e[24],I=z;const B=I;let U;return e[25]!==B||e[26]!==V?(U=s.jsxs(s.Fragment,{children:[E,V,B]}),e[25]=B,e[26]=V,e[27]=U):U=e[27],U}const Xe=je.memo(f=>{const e=me.c(9),{option:l,isHidden:t,onClick:n}=f;if(t)return null;let o;e[0]!==n||e[1]!==l?(o=()=>{n(l)},e[0]=n,e[1]=l,e[2]=o):o=e[2];const u=o;let i;e[3]!==l[1]?(i=s.jsx("span",{className:"text-xs opacity-50",children:l[1]}),e[3]=l[1],e[4]=i):i=e[4];let d;return e[5]!==u||e[6]!==l[0]||e[7]!==i?(d=s.jsxs(re,{variant:"outline",size:"sm",className:"me-1 mb-1",onClick:u,children:[l[0],": ",i]}),e[5]=u,e[6]=l[0],e[7]=i,e[8]=d):d=e[8],d});function Ze({type:f,columns:e,addSimpleColumn:l}){const[t,n]=A.useState(!0),o=A.useRef(null),[u,i]=A.useState(""),[d]=Fe(u,150),b=A.useRef(null),r=A.useMemo(()=>t?[]:Ae(f),[f,t]),y=A.useMemo(()=>r.filter(([m,g])=>!d||m.toLowerCase().includes(d.toLowerCase())||g.toLowerCase().includes(d.toLowerCase())),[r,d]),[C,v]=A.useState(0);A.useEffect(()=>{if(!t&&b.current){const m=new ResizeObserver(g=>{const{width:S}=g[0].contentRect;v(S)});return m.observe(b.current),()=>m.disconnect()}},[t]);const h=A.useCallback(m=>l(m),[l]),F=15,j=A.useMemo(()=>{const m=[];for(let g=0;g<y.length;g+=F)m.push(y.slice(g,g+F));return m},[y]),O=A.useCallback(m=>{i(m.target.value.toLowerCase())},[]),E=A.useCallback(()=>{n(m=>!m)},[n]),_=A.useCallback(m=>{const g=j[m];return s.jsx("div",{className:"flex flex-wrap",children:g.map((S,N)=>{if(e.has("{"+S[0]+"}"))return null;const c=`${m}-${N}`;return s.jsx(Xe,{option:S,isHidden:!1,onClick:h},c)})})},[j,e,h]);return s.jsxs("div",{className:"mt-1.5 rounded-md border border-border bg-card/60",children:[s.jsxs(re,{variant:"ghost",size:"sm",className:"text-xs font-semibold w-full border-b border-border px-2 bg-muted/40 rounded-none justify-start",onClick:E,children:["Add Simple ",t?s.jsx(de,{name:"ChevronDown"}):s.jsx(de,{name:"ChevronUp"})]}),s.jsxs("div",{className:`transition-all duration-200 ease-in-out ${t?"max-h-0 opacity-0 overflow-hidden":"px-2 py-1.5 opacity-100"}`,children:[s.jsx(ge,{ref:o,type:"text",className:"w-full mb-1.5",placeholder:"Filter options",value:u,onChange:O}),s.jsxs("div",{ref:b,className:"w-full",children:[!t&&j.length>0&&s.jsx(ye,{style:{height:Math.min(400,j.length*40)},totalCount:j.length,itemContent:_}),!t&&y.length===0&&s.jsx("div",{className:"py-2 text-center text-muted-foreground",children:"No matching options found"})]}),y.length>100&&s.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:["Showing all ",y.length," options"]})]})]})}function Je(f){const e=me.c(50),{type:l,selection:t,setSelection:n}=f,[o,u]=A.useState(!1),[i,d]=A.useState(t[""]);let b,r;e[0]!==l?(r=Object.keys(ce[l]?.selections??{}),e[0]=l,e[1]=r):r=e[1],b=r;const y=b;let C,v;e[2]!==t?(C=()=>{d(M=>M!==t[""]?t[""]:M)},v=[t,d],e[2]=t,e[3]=C,e[4]=v):(C=e[3],v=e[4]),A.useEffect(C,v);let h;e[5]!==t||e[6]!==n?(h=M=>{n({...t,"":M})},e[5]=t,e[6]=n,e[7]=h):h=e[7];const F=Ee(h,150);let j;e[8]!==F?(j=M=>{const X=M.target.value;d(X),F(X)},e[8]=F,e[9]=j):j=e[9];const O=j;let E;e[10]===Symbol.for("react.memo_cache_sentinel")?(E=()=>{u(et)},e[10]=E):E=e[10];const _=E;let m,g;e[11]!==o?(g=s.jsxs(re,{variant:"ghost",size:"sm",className:"text-xs font-semibold w-full border-b border-border px-2 bg-muted/40 rounded-none justify-start",onClick:_,children:["Selection ",o?s.jsx(de,{name:"ChevronDown"}):s.jsx(de,{name:"ChevronUp"})]}),e[11]=o,e[12]=g):g=e[12],m=g;const S=m;let N;e[13]!==t||e[14]!==n||e[15]!==l?(N=M=>{const X=M.currentTarget.dataset.key;if(!X)return;const oe=ce[l]?.selections[X]||"*";d(oe),n({...t,"":oe})},e[13]=t,e[14]=n,e[15]=l,e[16]=N):N=e[16];const $=N;let c,p;e[17]===Symbol.for("react.memo_cache_sentinel")?(p=s.jsx("h2",{className:"text-sm font-semibold mb-0.5",children:"Templates"}),e[17]=p):p=e[17];let D;e[18]!==y||e[19]!==$?(D=s.jsxs(s.Fragment,{children:[p,y.map(M=>s.jsx(re,{variant:"outline",size:"sm",className:"me-1","data-key":M,onClick:$,children:M},M))]}),e[18]=y,e[19]=$,e[20]=D):D=e[20],c=D;const L=c;let V;e[21]!==i?(V=()=>i,e[21]=i,e[22]=V):V=e[22];const I=V;let P,z;e[23]===Symbol.for("react.memo_cache_sentinel")?(z=s.jsx("h2",{className:"text-sm font-semibold mt-0.5",children:"Current Selection"}),e[23]=z):z=e[23];let B;e[24]!==O||e[25]!==i?(B=s.jsx(ge,{className:"relative px-1 w-full",type:"text",value:i,onChange:O}),e[24]=O,e[25]=i,e[26]=B):B=e[26];let U;e[27]!==I?(U=s.jsx(Ce,{children:s.jsx(ve,{getText:I,className:"rounded [&_svg]:size-3 static",size:"sm"})}),e[27]=I,e[28]=U):U=e[28];let H;e[29]!==B||e[30]!==U?(H=s.jsxs(s.Fragment,{children:[z,s.jsxs("div",{className:"flex items-center gap-1",children:[B,U]})]}),e[29]=B,e[30]=U,e[31]=H):H=e[31],P=H;const K=P;let Q,q;e[32]!==t||e[33]!==n||e[34]!==l?(q=he.placeholders(l).getCreate()&&s.jsx(tt,{modifier:he.placeholders(l).getCreate(),selection:t,setSelection:n}),e[32]=t,e[33]=n,e[34]=l,e[35]=q):q=e[35],Q=q;const se=Q;let Z;const ie=`https://github.com/xdnw/locutus/wiki/${be(l)}_placeholders`;let J;e[36]!==l?(J=be(l),e[36]=l,e[37]=J):J=e[37];let ae;e[38]!==ie||e[39]!==J?(ae=s.jsxs("a",{href:ie,className:"text-xs text-blue-800 dark:text-blue-400 underline hover:no-underline active:underline",target:"_blank",rel:"noreferrer",children:["View All ",J," Filters"]}),e[38]=ie,e[39]=J,e[40]=ae):ae=e[40],Z=ae;const ne=Z;let le;le=`transition-all duration-200 ease-in-out ${o?"max-h-0 opacity-0 overflow-hidden":"px-2 py-1.5 opacity-100 space-y-1.5"}`;const W=le;let G;e[41]!==W||e[42]!==ne||e[43]!==K||e[44]!==se||e[45]!==L?(G=s.jsxs("div",{className:W,children:[L,K,se,ne]}),e[41]=W,e[42]=ne,e[43]=K,e[44]=se,e[45]=L,e[46]=G):G=e[46];let Y;return e[47]!==S||e[48]!==G?(Y=s.jsxs("div",{className:"themeDiv mt-1.5 overflow-hidden",children:[S,G]}),e[47]=S,e[48]=G,e[49]=Y):Y=e[49],Y}function et(f){return!f}function tt(f){const e=me.c(7),{modifier:l,selection:t,setSelection:n}=f;let o;e[0]!==t||e[1]!==n?(o=(b,r)=>{if(r){if(t[b]===r)return;n({...t,[b]:r})}else{if(t[b]===void 0)return;const y={...t};delete y[b],n(y)}},e[0]=t,e[1]=n,e[2]=o):o=e[2];const u=o,i=st;let d;return e[3]!==l||e[4]!==t||e[5]!==u?(d=s.jsx(Le,{overrideName:"Modifier",command:l,filterArguments:i,initialValues:t,setOutput:u}),e[3]=l,e[4]=t,e[5]=u,e[6]=d):d=e[6],d}function st(){return!0}function lt(f){const e=me.c(36),{templateName:l,config:t,onApplyTemplate:n,onCancel:o}=f;let u,i;e[0]!==t.variables?(i=Object.fromEntries(Object.entries(t.variables).map(ot)),e[0]=t.variables,e[1]=i):i=e[1],u=i;const d=u,[b,r]=A.useState(d);let y,C;e[2]!==t.variableInputs?(C=Object.fromEntries(Object.entries(t.variableInputs).map(nt)),e[2]=t.variableInputs,e[3]=C):C=e[3],y=C;const v=y;let h,F;e[4]!==d?(h=()=>{r(d)},F=[d],e[4]=d,e[5]=h,e[6]=F):(h=e[5],F=e[6]),A.useEffect(h,F);let j;e[7]===Symbol.for("react.memo_cache_sentinel")?(j=(D,L)=>{r(V=>({...V,[D]:L}))},e[7]=j):j=e[7];const O=j;let E;e[8]!==n||e[9]!==l||e[10]!==b?(E=()=>{n(l,b)},e[8]=n,e[9]=l,e[10]=b,e[11]=E):E=e[11];const _=E;let m;e[12]!==l?(m=s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Configure arguments for ",s.jsx("span",{className:"font-semibold",children:l}),"."]}),e[12]=l,e[13]=m):m=e[13];let g;if(e[14]!==v||e[15]!==t.variableInputs||e[16]!==t.variables||e[17]!==b){let D;e[19]!==v||e[20]!==t.variableInputs||e[21]!==b?(D=L=>{const[V,I]=L,P=t.variableInputs[V],z=v[V];return s.jsxs("div",{className:"rounded border border-border p-2 space-y-1",children:[s.jsx("div",{className:"text-xs font-semibold",children:I.label??V}),s.jsx("div",{className:"text-xs text-muted-foreground",children:I.desc??P?.desc??P?.argType}),z&&s.jsx(Me,{argName:V,breakdown:z,min:P?.min,max:P?.max,initialValue:b[V]??I.defaultValue,setOutputValue:O})]},V)},e[19]=v,e[20]=t.variableInputs,e[21]=b,e[22]=D):D=e[22],g=Object.entries(t.variables).map(D),e[14]=v,e[15]=t.variableInputs,e[16]=t.variables,e[17]=b,e[18]=g}else g=e[18];let S;e[23]!==g?(S=s.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-auto pr-1",children:g}),e[23]=g,e[24]=S):S=e[24];let N;e[25]!==o?(N=s.jsx(re,{variant:"outline",size:"sm",onClick:o,children:"Cancel"}),e[25]=o,e[26]=N):N=e[26];let $;e[27]!==_?($=s.jsx(re,{size:"sm",onClick:_,children:"Apply"}),e[27]=_,e[28]=$):$=e[28];let c;e[29]!==N||e[30]!==$?(c=s.jsxs("div",{className:"flex gap-2 justify-end",children:[N,$]}),e[29]=N,e[30]=$,e[31]=c):c=e[31];let p;return e[32]!==S||e[33]!==c||e[34]!==m?(p=s.jsxs("div",{className:"space-y-3",children:[m,S,c]}),e[32]=S,e[33]=c,e[34]=m,e[35]=p):p=e[35],p}function nt(f){const[e,l]=f;return[e,Re(he,l.argType)]}function ot(f){const[e,l]=f;return[e,l.defaultValue]}function it(f){return Array.isArray(f)?[f[0],f[1]]:[f,null]}function kt(){const f=A.useMemo(()=>Se(),[]),[e]=ue(De(f)??"DBNation"),[l]=ue($e(f,e)),[t]=ue((function(){const r=ce[e],y=Object.keys(r?.columns??{})[0],C=y?r?.columns[y]?.value:void 0;return Oe(f)??new Map((C??["{id}"]).map(v=>Array.isArray(v)?[v[0],v[1]]:[v,null]))})()),n=ce[e],o=Object.keys(n?.columns??{})[0],[u]=ue(Ve(f)??(o?n?.columns[o]?.sort:void 0)),i=A.useRef(null),d=A.useCallback(()=>{const r=i.current;return{type:r?.getType()??e,selection:r?.getSelection()??l,columns:r?.getColumns()??t,sort:r?.getSort()??u}},[i,e,l,t,u]),b=A.useMemo(()=>s.jsx("div",{className:"themeDiv p-2 mt-2",children:s.jsx(Ue,{getTableProps:d,load:!1})}),[d]);return s.jsxs(s.Fragment,{children:[s.jsx(He,{ref:i,defType:e,defSelection:l,defColumns:t,defSort:u}),b]})}export{kt as default};
