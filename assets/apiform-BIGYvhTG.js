import{S as Q,s as U,k as P,l as H,n as B,u as K,r as C,j as r,R as z,c as I,h as W,L as G,a as J}from"./index-CkdKFI98.js";import{c as X,b as Y}from"./StateUtil-BKtOCwcq.js";import{B as T,d as Z,a as ee}from"./button-C_VcwxQ2.js";import{u as te}from"./DialogContext-D_bUabOf.js";import{u as se}from"./bulkwrapper-BIfe5AfD.js";import{a as re,A as ie,b as ne}from"./CommandComponent-KxhOFLhp.js";import{t as ae,u as oe,v as le}from"./queries-ByOb2jVj.js";import{u as ue}from"./traditional-BerdgZli.js";var ce=class extends Q{#s;#r=void 0;#e;#t;constructor(t,e){super(),this.#s=t,this.setOptions(e),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.#s.defaultMutationOptions(t),U(this.options,e)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),e?.mutationKey&&this.options.mutationKey&&P(e.mutationKey)!==P(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#r}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#n()}mutate(t,e){return this.#t=e,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(t)}#i(){const t=this.#e?.state??H();this.#r={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){B.batch(()=>{if(this.#t&&this.hasListeners()){const e=this.#r.variables,s=this.#r.context;t?.type==="success"?(this.#t.onSuccess?.(t.data,e,s),this.#t.onSettled?.(t.data,null,e,s)):t?.type==="error"&&(this.#t.onError?.(t.error,e,s),this.#t.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach(e=>{e(this.#r)})})}};function he(t,e){const s=K(),[i]=C.useState(()=>new ce(s,t));C.useEffect(()=>{i.setOptions(t)},[i,t]);const l=C.useSyncExternalStore(C.useCallback(o=>i.subscribe(B.batchCalls(o)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),m=C.useCallback((o,u)=>{i.mutate(o,u).catch(ae)},[i]);if(l.error&&oe(i.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:m,mutateAsync:l.mutate}}const me=z.memo(t=>{const e=I.c(14),{arg:s,setOutputValue:i,initialValue:l}=t;let m;e[0]!==s?(m=r.jsx(ne,{arg:s}),e[0]=s,e[1]=m):m=e[1];const o=s.name;let u;e[2]!==s?(u=s.getTypeBreakdown(),e[2]=s,e[3]=u):u=e[3];let d;e[4]!==s.arg.max||e[5]!==s.arg.min||e[6]!==s.name||e[7]!==l||e[8]!==i||e[9]!==u?(d=r.jsx(re,{className:"rounded-t-none",children:r.jsx(ie,{argName:o,breakdown:u,min:s.arg.min,max:s.arg.max,initialValue:l,setOutputValue:i})}),e[4]=s.arg.max,e[5]=s.arg.min,e[6]=s.name,e[7]=l,e[8]=i,e[9]=u,e[10]=d):d=e[10];let g;return e[11]!==m||e[12]!==d?(g=r.jsxs("div",{className:"relative",children:[m,d]}),e[11]=m,e[12]=d,e[13]=g):g=e[13],g},(t,e)=>t.arg===e.arg&&t.setOutputValue===e.setOutputValue&&t.initialValue===e.initialValue);function Se({endpoint:t,message:e,default_values:s,showArguments:i,includeDefaultArguments:l,label:m,handle_error:o,classes:u,handle_response:d,children:g}){const{showDialog:S}=te(),y=se(s?Object.fromEntries(Object.entries(s).filter(([n,a])=>a!==void 0)):{}),v=C.useMemo(()=>{const n=[];for(const[a,O]of Object.entries(t.endpoint.args))!O.arg.optional&&!Object.prototype.hasOwnProperty.call(y,a)&&n.push(a);return n},[t.endpoint.args,y]),_=C.useCallback(n=>{o?o(n):S("Error",n.message)},[o,S]),x=C.useMemo(()=>{const n=new Set;return v.forEach(a=>n.add(a)),(i??[]).forEach(a=>n.add(String(a))),Array.from(n)},[v,i]),b=C.useMemo(()=>x.length===0?[]:x.map(n=>t.endpoint.args[n]).filter(Boolean).filter(n=>l||!Object.prototype.hasOwnProperty.call(y,n.name)),[x,t.endpoint.args,y,l]),f=C.useCallback(n=>b.length===0?null:r.jsxs(r.Fragment,{children:[b.map(a=>(()=>{const O=y[a.name],h=typeof O=="string"?O:Array.isArray(O)?O.join(","):"";return r.jsx(me,{arg:a,initialValue:h,setOutputValue:n.setOutputValue},a.name)})()),r.jsx("hr",{className:"my-2"})]}),[b,y]);return r.jsx($,{requireLogin:!1,required:v,message:e,endpoint:t,label:m,default_values:y,form_inputs:f,handle_error:_,handle_response:d,classes:u,children:g})}function $(t){const e=I.c(30),{requireLogin:s,message:i,endpoint:l,label:m,required:o,default_values:u,form_inputs:d,handle_error:g,classes:S,handle_response:y,children:v}=t,_=s===void 0?!1:s,x=m===void 0?"submit":m;let b;e[0]!==o?(b=o===void 0?[]:o,e[0]=o,e[1]=b):b=e[1];const f=b;let n;e[2]!==u?(n=()=>u&&Object.keys(u).length?X(u):Y(),e[2]=u,e[3]=n):n=e[3];const[a]=C.useState(n);let O,h;e[4]!==i||e[5]!==f?(h=i&&f&&f.length>0&&r.jsx("hr",{className:"my-2"}),e[4]=i,e[5]=f,e[6]=h):h=e[6];let F;e[7]!==i||e[8]!==h?(F=r.jsxs(r.Fragment,{children:[i,h]}),e[7]=i,e[8]=h,e[9]=F):F=e[9],O=F;const V=O;let L,k;e[10]!==v||e[11]!==S||e[12]!==a||e[13]!==l||e[14]!==g||e[15]!==y||e[16]!==x||e[17]!==f?(k=r.jsx(fe,{endpoint:l,store:a,label:x,required:f,handle_error:g,handle_response:y,classes:S,children:v}),e[10]=v,e[11]=S,e[12]=a,e[13]=l,e[14]=g,e[15]=y,e[16]=x,e[17]=f,e[18]=k):k=e[18],L=k;const R=L;if(_&&!W()){let w;e[19]===Symbol.for("react.memo_cache_sentinel")?(w=r.jsx("br",{}),e[19]=w):w=e[19];let N;return e[20]===Symbol.for("react.memo_cache_sentinel")?(N=r.jsxs(r.Fragment,{children:["Please login first",w,r.jsx(T,{variant:"outline",size:"sm",className:"border-red-800/70",asChild:!0,children:r.jsx(G,{to:"/home",children:"Login"})})]}),e[20]=N):N=e[20],N}const q=de;let A;e[21]!==a?(A=a(q),e[21]=a,e[22]=A):A=e[22];const M=A;let j;e[23]!==d||e[24]!==M?(j=d?r.jsx(d,{setOutputValue:M}):null,e[23]=d,e[24]=M,e[25]=j):j=e[25];let E;return e[26]!==R||e[27]!==V||e[28]!==j?(E=r.jsxs(r.Fragment,{children:[V,j,R]}),e[26]=R,e[27]=V,e[28]=j,e[29]=E):E=e[29],E}function de(t){return t.setOutput}z.memo($);function fe(t){const e=I.c(43),{store:s,endpoint:i,label:l,required:m,handle_error:o,classes:u,handle_response:d,children:g}=t;let S;e[0]!==m?(S=c=>(m??[]).filter(p=>!c.output[p]),e[0]=m,e[1]=S):S=e[1];const v=ue(s,S,Z),_=K();let x;e[2]!==i||e[3]!==_?(x=c=>_.fetchQuery(le(i.endpoint,c,void 0,10)),e[2]=i,e[3]=_,e[4]=x):x=e[4];let b;e[5]!==o||e[6]!==d?(b=c=>{const p=c;if(p.error){o?.(new Error(p.error));return}if(!p.data){o?.(new Error("No data returned"));return}d?.(p)},e[5]=o,e[6]=d,e[7]=b):b=e[7];let f;e[8]!==o?(f=c=>{o?.(c)},e[8]=o,e[9]=f):f=e[9];let n;e[10]!==x||e[11]!==b||e[12]!==f?(n={mutationFn:x,onSuccess:b,onError:f},e[10]=x,e[11]=b,e[12]=f,e[13]=n):n=e[13];const a=he(n),O=a.data,h=a.isPending;let F;e[14]!==a||e[15]!==s?(F=()=>{const c=s.getState().output;a.mutate(c)},e[14]=a,e[15]=s,e[16]=F):F=e[16];const V=F;let L;e:{if(!g||!O?.data){L=null;break e}const c=O;let p;e[17]!==g||e[18]!==c?(p=g(c),e[17]=g,e[18]=c,e[19]=p):p=e[19],L=p}const k=L;let R,q;e[20]!==u||e[21]!==h?(q=ee("border-red-800/70 relative","me-1",{"disabled cursor-wait":h},u),e[20]=u,e[21]=h,e[22]=q):q=e[22];const A=h?"invisible":"visible";let M;e[23]!==l||e[24]!==A?(M=r.jsx("span",{className:A,children:l}),e[23]=l,e[24]=A,e[25]=M):M=e[25];let j;e[26]!==h?(j=h&&r.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx(J,{size:3,variant:"ripple"})}),e[26]=h,e[27]=j):j=e[27];let E;e[28]!==M||e[29]!==j?(E=r.jsxs("span",{className:"flex items-center justify-center w-full",children:[M,j]}),e[28]=M,e[29]=j,e[30]=E):E=e[30];let w;e[31]!==h||e[32]!==V||e[33]!==E||e[34]!==q?(w=r.jsx(T,{variant:"destructive",size:"sm",className:q,onClick:V,disabled:h,children:E}),e[31]=h,e[32]=V,e[33]=E,e[34]=q,e[35]=w):w=e[35],R=w;const N=R;if(v.length){let c;e[36]!==v?(c=v.join(", "),e[36]=v,e[37]=c):c=e[37];let p;return e[38]!==c?(p=r.jsxs("p",{children:["Please provide a value for ",r.jsx("kbd",{children:c})]}),e[38]=c,e[39]=p):p=e[39],p}let D;return e[40]!==k||e[41]!==N?(D=r.jsxs(r.Fragment,{children:[k,N]}),e[40]=k,e[41]=N,e[42]=D):D=e[42],D}export{Se as A};
