var e,t,s,r,n,a,i,o,u=e=>{throw TypeError(e)},l=(e,t,s)=>t.has(e)||u("Cannot "+s),c=(e,t,s)=>(l(e,t,"read from private field"),s?s.call(e):t.get(e)),h=(e,t,s)=>t.has(e)?u("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),d=(e,t,s,r)=>(l(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),m=(e,t,s)=>(l(e,t,"access private method"),s);import{S as p,s as f,f as v,i as b,n as g,u as x,r as j,k as y,m as S,R as O,j as w,h as E,L as k}from"./index-CB60MK8B.js";import{c as C,b as M}from"./StateUtil-BfNeAsTQ.js";import{B as _,a as V,d as N}from"./button-Dc6LF0a5.js";import{u as W}from"./DialogContext-Ddeg3-RV.js";import{u as L}from"./bulkwrapper-CbKbfW3U.js";import{A as q,a as A}from"./CommandComponent-LRDIJNlC.js";import{H as F,I as P,a as D,J as R}from"./loading-Cq9Kwdp4.js";var B=(o=class extends p{constructor(i,o){super(),h(this,n),h(this,e),h(this,t),h(this,s),h(this,r),d(this,e,i),this.setOptions(o),this.bindMethods(),m(this,n,a).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const n=this.options;this.options=c(this,e).defaultMutationOptions(t),f(this.options,n)||c(this,e).getMutationCache().notify({type:"observerOptionsUpdated",mutation:c(this,s),observer:this}),(null==n?void 0:n.mutationKey)&&this.options.mutationKey&&v(n.mutationKey)!==v(this.options.mutationKey)?this.reset():"pending"===(null==(r=c(this,s))?void 0:r.state.status)&&c(this,s).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||null==(e=c(this,s))||e.removeObserver(this)}onMutationUpdate(e){m(this,n,a).call(this),m(this,n,i).call(this,e)}getCurrentResult(){return c(this,t)}reset(){var e;null==(e=c(this,s))||e.removeObserver(this),d(this,s,void 0),m(this,n,a).call(this),m(this,n,i).call(this)}mutate(t,n){var a;return d(this,r,n),null==(a=c(this,s))||a.removeObserver(this),d(this,s,c(this,e).getMutationCache().build(c(this,e),this.options)),c(this,s).addObserver(this),c(this,s).execute(t)}},e=new WeakMap,t=new WeakMap,s=new WeakMap,r=new WeakMap,n=new WeakSet,a=function(){var e;const r=(null==(e=c(this,s))?void 0:e.state)??b();d(this,t,{...r,isPending:"pending"===r.status,isSuccess:"success"===r.status,isError:"error"===r.status,isIdle:"idle"===r.status,mutate:this.mutate,reset:this.reset})},i=function(e){g.batch((()=>{var s,n,a,i,o,u,l,h;if(c(this,r)&&this.hasListeners()){const d=c(this,t).variables,m=c(this,t).context;"success"===(null==e?void 0:e.type)?(null==(n=(s=c(this,r)).onSuccess)||n.call(s,e.data,d,m),null==(i=(a=c(this,r)).onSettled)||i.call(a,e.data,null,d,m)):"error"===(null==e?void 0:e.type)&&(null==(u=(o=c(this,r)).onError)||u.call(o,e.error,d,m),null==(h=(l=c(this,r)).onSettled)||h.call(l,void 0,e.error,d,m))}this.listeners.forEach((e=>{e(c(this,t))}))}))},o);var K,U,z,I,H={exports:{}},T={},J={exports:{}},Q={};function G(){return U||(U=1,J.exports=function(){if(K)return Q;K=1;var e=y(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=e.useState,r=e.useEffect,n=e.useLayoutEffect,a=e.useDebugValue;function i(e){var s=e.getSnapshot;e=e.value;try{var r=s();return!t(e,r)}catch(n){return!0}}var o="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var o=t(),u=s({inst:{value:o,getSnapshot:t}}),l=u[0].inst,c=u[1];return n((function(){l.value=o,l.getSnapshot=t,i(l)&&c({inst:l})}),[e,o,t]),r((function(){return i(l)&&c({inst:l}),e((function(){i(l)&&c({inst:l})}))}),[e]),a(o),o};return Q.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:o,Q}()),J.exports}
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */const X=S((I||(I=1,H.exports=function(){if(z)return T;z=1;var e=y(),t=G(),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=t.useSyncExternalStore,n=e.useRef,a=e.useEffect,i=e.useMemo,o=e.useDebugValue;return T.useSyncExternalStoreWithSelector=function(e,t,u,l,c){var h=n(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=i((function(){function e(e){if(!a){if(a=!0,r=e,e=l(e),void 0!==c&&d.hasValue){var t=d.value;if(c(t,e))return n=t}return n=e}if(t=n,s(r,e))return t;var i=l(e);return void 0!==c&&c(t,i)?(r=e,t):(r=e,n=i)}var r,n,a=!1,i=void 0===u?null:u;return[function(){return e(t())},null===i?void 0:function(){return e(i())}]}),[t,u,l,c]);var m=r(e,h[0],h[1]);return a((function(){d.hasValue=!0,d.value=m}),[m]),o(m),m},T}()),H.exports)),{useSyncExternalStoreWithSelector:Y}=X,Z=e=>e;const $=O.memo((({arg:e,setOutputValue:t})=>w.jsxs("div",{className:"relative",children:[w.jsx(q,{arg:e}),w.jsx("div",{className:"mb-1 bg-accent border border-slate-500 border-opacity-50 rounded-b-sm rounded-tr-sm",children:w.jsx(A,{argName:e.name,breakdown:e.getTypeBreakdown(),min:e.arg.min,max:e.arg.max,initialValue:"",setOutputValue:t})})]})),((e,t)=>e.arg===t.arg&&e.setOutputValue===t.setOutputValue));function ee({endpoint:e,message:t,default_values:s,showArguments:r,label:n,handle_error:a,classes:i,handle_response:o,children:u}){const{showDialog:l}=W(),c=L(s?Object.fromEntries(Object.entries(s).filter((([e,t])=>void 0!==t))):{}),h=j.useMemo((()=>{const t=[];for(const[s,r]of Object.entries(e.endpoint.args))r.arg.optional||Object.prototype.hasOwnProperty.call(c,s)||t.push(s);return t}),[e.endpoint.args,c]),d=j.useCallback((e=>{a?a(e):l("Error",e.message)}),[a,l]),m=j.useMemo((()=>{const e=new Set;return h.forEach((t=>e.add(t))),(r??[]).forEach((t=>e.add(String(t)))),Array.from(e)}),[h,r]),p=j.useMemo((()=>0===m.length?[]:m.map((t=>e.endpoint.args[t])).filter(Boolean).filter((e=>!Object.prototype.hasOwnProperty.call(c,e.name)))),[m,e.endpoint.args,c]),f=j.useCallback((e=>0===p.length?null:w.jsxs(w.Fragment,{children:[p.map((t=>w.jsx($,{arg:t,setOutputValue:e.setOutputValue},t.name))),w.jsx("hr",{className:"my-2"})]})),[p]);return w.jsx(te,{requireLogin:!1,required:h,message:t,endpoint:e,label:n,default_values:c,form_inputs:f,handle_error:d,handle_response:o,classes:i,children:u})}function te({requireLogin:e=!1,message:t,endpoint:s,label:r="submit",required:n=[],default_values:a,form_inputs:i,handle_error:o,classes:u,handle_response:l,children:c}){const[h]=j.useState((()=>a&&Object.keys(a).length?C(a):M())),d=j.useMemo((()=>w.jsxs(w.Fragment,{children:[t,t&&n&&n.length>0&&w.jsx("hr",{className:"my-2"})]})),[t,n]),m=j.useMemo((()=>w.jsx(se,{endpoint:s,store:h,label:r,required:n,handle_error:o,handle_response:l,classes:u,children:c})),[s,h,r,n,o,l,u,c]);if(e&&!E())return w.jsxs(w.Fragment,{children:["Please login first",w.jsx("br",{}),w.jsx(_,{variant:"outline",size:"sm",className:"border-red-800/70",asChild:!0,children:w.jsx(k,{to:"/home",children:"Login"})})]});const p=j.useCallback((e=>e.setOutput),[]),f=h(p);return w.jsxs(w.Fragment,{children:[d,i?w.jsx(i,{setOutputValue:f}):null,m]})}function se({store:e,endpoint:t,label:s,required:r,handle_error:n,classes:a,handle_response:i,children:o}){const u=j.useCallback((e=>(r??[]).filter((t=>!e.output[t]))),[r]),l=function(e,t=Z,s){const r=Y(e.subscribe,e.getState,e.getInitialState,t,s);return O.useDebugValue(r),r}(e,u,N),c=x(),h=function(e){const t=x(),[s]=j.useState((()=>new B(t,e)));j.useEffect((()=>{s.setOptions(e)}),[s,e]);const r=j.useSyncExternalStore(j.useCallback((e=>s.subscribe(g.batchCalls(e))),[s]),(()=>s.getCurrentResult()),(()=>s.getCurrentResult())),n=j.useCallback(((e,t)=>{s.mutate(e,t).catch(F)}),[s]);if(r.error&&P(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:n,mutateAsync:r.mutate}}({mutationFn:e=>c.fetchQuery(R(t.endpoint,e,void 0,10)),onSuccess:e=>{const t=e;t.error?null==n||n(new Error(t.error)):t.data?null==i||i(t):null==n||n(new Error("No data returned"))},onError:e=>{null==n||n(e)}}),d=h.data,m=h.isPending,p=j.useCallback((()=>{const t=e.getState().output;h.mutate(t)}),[e,h]),f=j.useMemo((()=>o&&(null==d?void 0:d.data)?o(d):null),[d,o]),v=j.useMemo((()=>w.jsx(_,{variant:"destructive",size:"sm",className:V("border-red-800/70 relative","me-1",{"disabled cursor-wait":m},a),onClick:p,disabled:m,children:w.jsxs("span",{className:"flex items-center justify-center w-full",children:[w.jsx("span",{className:m?"invisible":"visible",children:s}),m&&w.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:w.jsx(D,{size:3,variant:"ripple"})})]})})),[m,p,s,a]);return l.length?w.jsxs("p",{children:["Please provide a value for ",w.jsx("kbd",{children:l.join(", ")})]}):w.jsxs(w.Fragment,{children:[f,v]})}O.memo(te);export{ee as A};
