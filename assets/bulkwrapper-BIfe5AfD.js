import{r as b,c as B,j as f,a as v,u as O}from"./index-CkdKFI98.js";import{u as R}from"./useSuspenseQuery-AkitrqQh.js";import{B as $}from"./button-C_VcwxQ2.js";import{z as q,J as Q}from"./queries-ByOb2jVj.js";const F=b.createContext(null),k={didCatch:!1,error:null};class K extends b.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=k}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(...e){const{error:r}=this.state;r!==null&&(this.props.onReset?.({args:e,reason:"imperative-api"}),this.setState(k))}componentDidCatch(e,r){this.props.onError?.(e,r)}componentDidUpdate(e,r){const{didCatch:t}=this.state,{resetKeys:i}=this.props;t&&r.error!==null&&N(e.resetKeys,i)&&(this.props.onReset?.({next:i,prev:e.resetKeys,reason:"keys"}),this.setState(k))}render(){const{children:e,fallbackRender:r,FallbackComponent:t,fallback:i}=this.props,{didCatch:l,error:d}=this.state;let s=e;if(l){const a={error:d,resetErrorBoundary:this.resetErrorBoundary};if(typeof r=="function")s=r(a);else if(t)s=b.createElement(t,a);else if(i!==void 0)s=i;else throw d}return b.createElement(F.Provider,{value:{didCatch:l,error:d,resetErrorBoundary:this.resetErrorBoundary}},s)}}function N(n=[],e=[]){return n.length!==e.length||n.some((r,t)=>!Object.is(r,e[t]))}function C(n){if(n===void 0||n===null)return"null";if(typeof n!="object")return JSON.stringify(n);if(Array.isArray(n))return`[${n.map(C).join(",")}]`;const e=n;return`{${Object.keys(e).filter(t=>e[t]!==void 0).sort().map(t=>`${JSON.stringify(t)}:${C(e[t])}`).join(",")}}`}function D(n){const e=C(n);return b.useMemo(()=>JSON.parse(e),[e])}function J({error:n,resetErrorBoundary:e,endpoint:r,query:t}){return f.jsx(P,{endpoint:r,query:t,error:n,resetErrorBoundary:e})}function U(n){const e=B.c(18),{endpoint:r,args:t,handle_error:i,batch_wait_ms:l,isPostOverride:d,children:s}=n;let a;e[0]!==t?(a=t?Object.fromEntries(Object.entries(t).filter(z)):{},e[0]=t,e[1]=a):a=e[1];const o=D(a);let c;e[2]!==r.endpoint.name||e[3]!==o?(c=g=>J({...g,endpoint:r.endpoint.name,query:o}),e[2]=r.endpoint.name,e[3]=o,e[4]=c):c=e[4];const u=c;let p;e[5]!==s?(p=g=>{const{result:_,reload:w,isRefetching:S}=g;return s({..._,data:_.data,reload:w,isRefetching:S})},e[5]=s,e[6]=p):p=e[6];const m=p,h=i??console.error;let E;e[7]===Symbol.for("react.memo_cache_sentinel")?(E=f.jsx(v,{variant:"ripple"}),e[7]=E):E=e[7];const j=d??r.endpoint.isPost;let y;e[8]!==l||e[9]!==r.endpoint||e[10]!==m||e[11]!==o||e[12]!==j?(y=f.jsx(b.Suspense,{fallback:E,children:f.jsx(A,{endpoint:r.endpoint,query:o,is_post:j,cache_duration:r.endpoint.cache_duration,batch_wait_ms:l,children:m})}),e[8]=l,e[9]=r.endpoint,e[10]=m,e[11]=o,e[12]=j,e[13]=y):y=e[13];let x;return e[14]!==u||e[15]!==h||e[16]!==y?(x=f.jsx(K,{fallbackRender:u,onError:h,children:y}),e[14]=u,e[15]=h,e[16]=y,e[17]=x):x=e[17],x}function z(n){const[,e]=n;return e!==void 0}function P(n){const e=B.c(12),{endpoint:r,query:t,error:i,resetErrorBoundary:l}=n,d=O();let s;e[0]!==r||e[1]!==t||e[2]!==d||e[3]!==l?(s=async()=>{await d.resetQueries({queryKey:[r,t],exact:!0}),await d.refetchQueries({queryKey:[r,t],exact:!0}),l()},e[0]=r,e[1]=t,e[2]=d,e[3]=l,e[4]=s):s=e[4];const a=s,o=i instanceof Error?`${i.name}: ${i.message}`:String(i);let c;e[5]!==o?(c=f.jsx("div",{role:"alert",className:"whitespace-pre-wrap bg-accent relative px-2 border-2 border-destructive",children:f.jsx("pre",{className:"whitespace-pre-wrap break-all",children:o})}),e[5]=o,e[6]=c):c=e[6];let u;e[7]!==a?(u=f.jsx($,{size:"sm",variant:"outline",onClick:a,children:"Try again"}),e[7]=a,e[8]=u):u=e[8];let p;return e[9]!==c||e[10]!==u?(p=f.jsxs(f.Fragment,{children:[c,u]}),e[9]=c,e[10]=u,e[11]=p):p=e[11],p}function A(n){const e=B.c(13),{endpoint:r,query:t,is_post:i,cache_duration:l,batch_wait_ms:d,children:s}=n;let a;e[0]!==d||e[1]!==l||e[2]!==r||e[3]!==i||e[4]!==t?(a=q(r,t,i,l,d),e[0]=d,e[1]=l,e[2]=r,e[3]=i,e[4]=t,e[5]=a):a=e[5];const{data:o,refetch:c,isRefetching:u}=R(a);if(o&&o.error)throw new Q(o.error);let p;e[6]!==c?(p=()=>c(),e[6]=c,e[7]=p):p=e[7];const m=p;let h;return e[8]!==s||e[9]!==o||e[10]!==u||e[11]!==m?(h=s({result:o,reload:m,isRefetching:u}),e[8]=s,e[9]=o,e[10]=u,e[11]=m,e[12]=h):h=e[12],h}export{U as E,D as u};
