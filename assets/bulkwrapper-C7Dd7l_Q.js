import{r,j as e,u as t}from"./index-uWr0STWh.js";import{d as n,B as o}from"./button-DTAShytH.js";import{u as s}from"./useSuspenseQuery-20P0wUd1.js";import{L as i}from"./loading-Bn1uMh6d.js";import{N as a}from"./endpoints-BPDCTD20.js";const d=r.createContext(null),c={didCatch:!1,error:null};class l extends r.Component{constructor(r){super(r),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=c}static getDerivedStateFromError(r){return{didCatch:!0,error:r}}resetErrorBoundary(){const{error:r}=this.state;if(null!==r){for(var e,t,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];null===(e=(t=this.props).onReset)||void 0===e||e.call(t,{args:o,reason:"imperative-api"}),this.setState(c)}}componentDidCatch(r,e){var t,n;null===(t=(n=this.props).onError)||void 0===t||t.call(n,r,e)}componentDidUpdate(r,e){const{didCatch:t}=this.state,{resetKeys:n}=this.props;var o,s;t&&null!==e.error&&function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r.length!==e.length||r.some(((r,t)=>!Object.is(r,e[t])))}(r.resetKeys,n)&&(null===(o=(s=this.props).onReset)||void 0===o||o.call(s,{next:n,prev:r.resetKeys,reason:"keys"}),this.setState(c))}render(){const{children:e,fallbackRender:t,FallbackComponent:n,fallback:o}=this.props,{didCatch:s,error:i}=this.state;let a=e;if(s){const e={error:i,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)a=t(e);else if(n)a=r.createElement(n,e);else{if(void 0===o)throw i;a=o}}return r.createElement(d.Provider,{value:{didCatch:s,error:i,resetErrorBoundary:this.resetErrorBoundary}},a)}}function u(e){const[t,o]=r.useState(e);return r.useEffect((()=>{n(e,t)||o(e)}),[e,t]),t}function p({endpoint:t,args:n,handle_error:o,batch_wait_ms:s,isPostOverride:a,children:d}){const c=u(n?Object.fromEntries(Object.entries(n).filter((([r,e])=>void 0!==e))):{}),p=r.useCallback((r=>function({error:r,resetErrorBoundary:t,endpoint:n,query:o}){return e.jsx(h,{endpoint:n,query:o,error:r,resetErrorBoundary:t})}({...r,endpoint:t.endpoint.name,query:c})),[t.endpoint.name,c]);return e.jsx(l,{fallbackRender:p,onError:o??console.error,children:e.jsx(r.Suspense,{fallback:e.jsx(i,{variant:"ripple"}),children:e.jsx(m,{endpoint:t.endpoint,query:c,is_post:a??t.endpoint.isPost,cache_duration:t.endpoint.cache_duration,batch_wait_ms:s,children:r=>d(r)})})})}function h({endpoint:n,query:s,error:i,resetErrorBoundary:a}){const d=t(),c=r.useCallback((()=>{d.removeQueries({queryKey:[n,s]}),a()}),[d,n,s,a]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{role:"alert",className:"whitespace-pre-wrap bg-accent relative px-2 border-2 border-destructive",children:e.jsxs("pre",{children:[i.name,": ",i.message]})}),e.jsx(o,{size:"sm",variant:"outline",onClick:c,children:"Try again"})]})}function m({endpoint:r,query:e,is_post:t,cache_duration:n,batch_wait_ms:o,children:i}){const{data:d}=s(a(r,e,t,n,o));return i(d)}export{p as E,u};
