import{r as e,j as r,u as t}from"./index-CB60MK8B.js";import{u as n}from"./useSuspenseQuery-BSBlP-_p.js";import{a as s,Y as o,aa as a}from"./loading-Cq9Kwdp4.js";import{B as i}from"./button-Dc6LF0a5.js";const c=e.createContext(null),l={didCatch:!1,error:null};class d extends e.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=l}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var r,t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];null===(r=(t=this.props).onReset)||void 0===r||r.call(t,{args:s,reason:"imperative-api"}),this.setState(l)}}componentDidCatch(e,r){var t,n;null===(t=(n=this.props).onError)||void 0===t||t.call(n,e,r)}componentDidUpdate(e,r){const{didCatch:t}=this.state,{resetKeys:n}=this.props;var s,o;t&&null!==r.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==r.length||e.some(((e,t)=>!Object.is(e,r[t])))}(e.resetKeys,n)&&(null===(s=(o=this.props).onReset)||void 0===s||s.call(o,{next:n,prev:e.resetKeys,reason:"keys"}),this.setState(l))}render(){const{children:r,fallbackRender:t,FallbackComponent:n,fallback:s}=this.props,{didCatch:o,error:a}=this.state;let i=r;if(o){const r={error:a,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)i=t(r);else if(n)i=e.createElement(n,r);else{if(void 0===s)throw a;i=s}}return e.createElement(c.Provider,{value:{didCatch:o,error:a,resetErrorBoundary:this.resetErrorBoundary}},i)}}function u(e){if(void 0===e)return"null";if(null===e)return"null";if("object"!=typeof e)return JSON.stringify(e);if(Array.isArray(e))return`[${e.map(u).join(",")}]`;const r=e;return`{${Object.keys(r).filter((e=>void 0!==r[e])).sort().map((e=>`${JSON.stringify(e)}:${u(r[e])}`)).join(",")}}`}function p(r){const t=u(r);return e.useMemo((()=>JSON.parse(t)),[t])}function h({endpoint:t,args:n,handle_error:o,batch_wait_ms:a,isPostOverride:i,children:c}){const l=p(n?Object.fromEntries(Object.entries(n).filter((([e,r])=>void 0!==r))):{}),u=e.useCallback((e=>function({error:e,resetErrorBoundary:t,endpoint:n,query:s}){return r.jsx(f,{endpoint:n,query:s,error:e,resetErrorBoundary:t})}({...e,endpoint:t.endpoint.name,query:l})),[t.endpoint.name,l]),h=e.useCallback((({result:e,reload:r,isRefetching:t})=>c({...e,data:e.data,reload:r,isRefetching:t})),[c]);return r.jsx(d,{fallbackRender:u,onError:o??console.error,children:r.jsx(e.Suspense,{fallback:r.jsx(s,{variant:"ripple"}),children:r.jsx(y,{endpoint:t.endpoint,query:l,is_post:i??t.endpoint.isPost,cache_duration:t.endpoint.cache_duration,batch_wait_ms:a,children:h})})})}function f({endpoint:n,query:s,error:o,resetErrorBoundary:a}){const c=t(),l=e.useCallback((async()=>{await c.resetQueries({queryKey:[n,s],exact:!0}),await c.refetchQueries({queryKey:[n,s],exact:!0}),a()}),[c,n,s,a]);return r.jsxs(r.Fragment,{children:[r.jsx("div",{role:"alert",className:"whitespace-pre-wrap bg-accent relative px-2 border-2 border-destructive",children:r.jsxs("pre",{className:"whitespace-pre-wrap break-all",children:[o.name,": ",o.message]})}),r.jsx(i,{size:"sm",variant:"outline",onClick:l,children:"Try again"})]})}function y({endpoint:r,query:t,is_post:s,cache_duration:i,batch_wait_ms:c,children:l}){const{data:d,refetch:u,isRefetching:p}=n(o(r,t,s,i,c));if(d&&d.error)throw new a(d.error);return l({result:d,reload:e.useCallback((()=>u()),[u]),isRefetching:p})}export{h as E,p as u};
