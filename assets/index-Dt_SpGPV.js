import{a as e,c as t,r as s,j as r,L as a}from"./index-CB60MK8B.js";import{u as n}from"./DialogContext-Ddeg3-RV.js";import{a as i,B as o}from"./button-Dc6LF0a5.js";import{o as l,p as d,a as c,i as u,C as m,h as p,m as h}from"./loading-Cq9Kwdp4.js";import{Q as b}from"./CommandComponent-LRDIJNlC.js";import{u as x}from"./StateUtil-BfNeAsTQ.js";import{C as j}from"./table_util-YFgifY52.js";import{u as g}from"./SessionContext-etMYqaej.js";import{A as f}from"./apiform-BJMXET2y.js";import"./input-B_GU0jtO.js";import"./SimpleChart-Bw3_oVsT.js";import"./theme-provider-bTdlrjsQ.js";import"./bulkwrapper-CbKbfW3U.js";import"./useSuspenseQuery-BSBlP-_p.js";import"./useQuery-zqD4DT95.js";function N(){const{nation:a}=e(),{session:n,error:i,setSession:o,refetchSession:c}=g(),[u,m]=x(a??(null==n?void 0:n.nation_name)),p=t();s.useEffect((()=>{a&&m((e=>e!==a?a:e))}),[a,m]),s.useEffect((()=>{(null==n?void 0:n.nation_name)&&!a&&m((e=>e!==n.nation_name?n.nation_name:e))}),[n,a,m]);const h=s.useCallback((e=>{m(e),p(`/raid/${e}`)}),[p,m]),[b,j]=s.useState(null),[f,N]=s.useState(null),y=s.useMemo((()=>({app_7d:{endpoint:d,default_values:{nations:"*,#position<=1",num_results:"25"},description:"Attackable applicants and nones inactive for 7d"},members:{endpoint:d,default_values:{nations:"*",num_results:"25"},description:"All attackable nations inactive for 7d"},beige:{endpoint:d,default_values:{nations:"*",num_results:"25",beige_turns:"24"},description:"All nations inactive for 7d, including on beige"},ground:{endpoint:d,default_values:{nations:"#tankpct<0.2,#soldierpct<0.4,*",num_results:"25",time_inactive:"0d",weak_ground:"true"},description:"Nations with weak ground, including active nations"},ground_2d:{endpoint:d,default_values:{nations:"#tankpct<0.2,#soldierpct<0.4,*",num_results:"25",time_inactive:"2d",weak_ground:"true"},description:"Nations with weak ground, inactive for 2d"},losing:{endpoint:d,default_values:{nations:"#def>0,#RelativeStrength<1,*",num_results:"25",time_inactive:"0d",weak_ground:"true"},description:"Nations losing wars"},unprotected:{endpoint:l,default_values:{nations:"*",num_results:"25",ignoreODP:"true",includeAllies:"true",maxRelativeCounterStrength:"90"},description:"Nations least likely to defend or have counters"}})),[]),k=s.useMemo((()=>r.jsx(_,{pickedNation:u,updateNation:h})),[u,h]),C=s.useMemo((()=>Object.keys(y).map(((e,t)=>r.jsx("span",{children:r.jsx(v,{label:e,option:y[e],endpoint:y[e].endpoint,setDesc:N,setRaidOutput:j,nation:u??"",loading:!1})},t)))),[u,y]),S=s.useMemo((()=>f&&r.jsx("div",{className:"p-1 bg-primary/10",children:f})),[f]),M=s.useCallback((()=>{j(null),N("")}),[j,N]),D=s.useMemo((()=>r.jsx(w,{output:b,dismiss:M})),[b,M]);return r.jsxs("div",{className:"bg-light/10 border border-light/10 p-2 rounded mt-2",children:[r.jsx("h1",{className:"text-2xl mt-2 font-bold",children:"War / Raiding"}),(!n||!n.nation)&&!u&&k,r.jsxs("div",{className:"p-2 my-1 relative",children:["Raiding: ",u&&C,r.jsx("br",{}),S,D]})]})}function _({pickedNation:e,updateNation:t}){const a=s.useCallback(((e,s)=>{t(s)}),[t]);return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:(e?"text-primary/80 border-secondary":"text-red-500 border-red-500/25")+" border w-full mb-1 p-1 relative bg-accent rounded",children:e?r.jsxs(r.Fragment,{children:["Currently selected: ",e]}):r.jsx(r.Fragment,{children:"You MUST Select a Nation to use this tool or add it to the url or login."})}),r.jsx(b,{element:"DBNation",multi:!1,argName:"nation",initialValue:e??"",setOutputValue:a})]})}function v({option:e,label:t,endpoint:a,setRaidOutput:o,loading:l,setDesc:d,nation:c}){const{showDialog:u}=n(),m=s.useMemo((()=>({...e.default_values,nation:c})),[e,c]),p=s.useCallback((({data:t})=>{d(e.description),o(!0),o(t)}),[e,d,o]),h=s.useCallback((e=>{o(null),u("Error",e.message,!0)}),[o,u]),b=s.useMemo((()=>i("mb-1 border-primary/20",{"cursor-wait disabled text-muted":l})),[l]);return r.jsx(f,{endpoint:a,default_values:m,label:t,handle_response:p,handle_error:h,classes:b})}function y({options:e,setRaidOutput:t,loading:a,desc:o,setDesc:d}){const{showDialog:c}=n(),u=s.useCallback((({data:e})=>{d("Unprotected Nations"),t(!0),t(e)}),[d,t]),m=s.useCallback((e=>{t(null),c("Error",e.message,!0)}),[t,c]),p=s.useMemo((()=>i("mb-1 border-primary/20",{"cursor-wait disabled text-muted":a})),[a]);return r.jsx(f,{endpoint:l,default_values:e,label:"unprotected",handle_response:u,handle_error:m,classes:p})}const k=m.options.Rank.options.map((e=>"REMOVE"===e?"":e));function w({output:e,dismiss:t}){if(!e)return r.jsx(r.Fragment,{});if(!0===e)return r.jsx(c,{variant:"ripple"});const a=e,n=s.useMemo((()=>r.jsxs("tr",{children:[r.jsx("th",{children:"Name"}),r.jsx("th",{children:"Alliance"}),r.jsx("th",{}),a.include_strength&&r.jsx("th",{children:"Strength"}),r.jsx("th",{children:"Loot"}),r.jsx("th",{children:"Rank"}),r.jsx("th",{children:"Active"}),r.jsx("th",{children:"ðŸ’‚"}),r.jsx("th",{children:"âš™"}),r.jsx("th",{children:"âœˆ"}),r.jsx("th",{children:"ðŸš¢"}),r.jsx("th",{children:"ðŸ”Ž"}),r.jsx("th",{children:"ðŸš€"}),r.jsx("th",{children:"â˜¢"}),r.jsx("th",{children:"Score"}),r.jsx("th",{children:"Infra"})]})),[a.include_strength]),i=s.useMemo((()=>[a.self,...a.targets].map(((e,t)=>r.jsx(C,{includeStrength:a.include_strength,now:Date.now(),self:a.self,target:e,classes:"even:bg-black/10 dark:even:bg-white/5 "+(e.id===a.self.id?"border border-2 border-blue-500/50 bg-blue-500/20":"")},t)))),[a]);return r.jsxs("div",{className:"w-full",children:[r.jsxs("table",{className:"w-full text-sm table-auto",children:[r.jsx("thead",{className:"text-left",children:n}),r.jsx("tbody",{children:i})]}),r.jsx(o,{onClick:t,variant:"outline",size:"sm",className:"w-full",children:"Dismiss"})]})}function C({includeStrength:e,self:t,target:s,classes:n,now:i}){return r.jsxs("tr",{className:n,children:[r.jsx("td",{className:"border border-gray-500/25 p-1",children:s.id==t.id?"Your Nation":r.jsx(a,{className:"text-blue-600 hover:text-blue-800 underline",to:`https://politicsandwar.com/nation/id=${s.id}`,children:s.nation})}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:s.id==t.id?"":0===s.alliance_id?"None":r.jsx(a,{className:"text-blue-600 hover:text-blue-800 underline",to:`https://politicsandwar.com/alliance/id=${s.alliance_id}`,children:s.alliance})}),r.jsx("td",{className:"border border-gray-500/25",children:r.jsx("div",{className:"flex justify-center items-center text-center",children:r.jsx(j,{colorId:s.color_id,beigeTurns:s.beige_turns})})}),e&&r.jsx("td",{className:"border-0.5border border-gray-500/25 p-1",children:s.id!=t.id?`${u(s.strength)}%`:""}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:s.id==t.id?"":`$${0!=s.expected&&s.expected!=s.actual?u(s.expected)+"-":""}${u(s.actual)}`}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:k[s.position]}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(Math.round((i-s.active_ms)/1e3),2)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.soldier)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.tank)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.aircraft)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.ship)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.spies)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.missile)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.nuke)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(s.score)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:h(Math.round(s.avg_infra))})]})}export{_ as PickNation,v as RaidButton,w as RaidOutput,y as UnprotectedButton,C as WebTargetRow,N as default};
