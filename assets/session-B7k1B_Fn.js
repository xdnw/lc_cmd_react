import{j as e,L as s,r as i,g as a}from"./index-C3E2-SUH.js";import{C as l}from"./card-CumT0SDG.js";import{u as n,C as r}from"./DialogContext-BJx4vabV.js";import{B as t}from"./button-DCZsNPnk.js";import{b as o,L as d,S as c}from"./queries-BuM6HYrb.js";import{u as m}from"./useQuery-Zg5Nvbp7.js";import{T as x}from"./timestamp-ZCQVUB6Q.js";function h(){const{showDialog:o}=n(),c=i.useMemo((()=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Login (OAuth)"}),": Clicking ",e.jsx("em",{children:"Login with Discord"})," opens the OAuth flow in your browser to link your account immediately."]}),e.jsxs("p",{className:"text-sm text-foreground",children:[e.jsx("strong",{children:"Request a web link"}),": Use ",e.jsx(r,{text:"/web"})," in a channel with the Locutus bot to request a web login link (the bot will DM you a link)."]}),e.jsx("div",{className:"mt-2",children:e.jsx(t,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("a",{href:"https://discord.com/download",target:"_blank",rel:"noreferrer",children:"Download Discord"})})})]})),[]),m=i.useMemo((()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"How to authenticate"}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-foreground",children:[e.jsx("li",{children:"Select your nation"}),e.jsx("li",{children:"Open your in-game mail"}),e.jsx("li",{children:"Click the authentication link"})]})]})),[]),x=i.useCallback((()=>o("Discord: Login vs `/web`",c)),[o,c]),h=i.useCallback((()=>o("In-Game Mail Authentication",m)),[o,m]);return e.jsxs("div",{className:"bg-light/10 border border-light/10 rounded p-2 mt-4",children:[e.jsxs("div",{className:"pb-3 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Sign in to access web features"}),e.jsx("div",{className:"text-sm text-foreground",children:"Link your Discord or in-game nation."})]}),e.jsx(d,{name:"KeyRound",size:28})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(l,{className:"rounded border p-4",children:[e.jsxs("div",{className:"mb-2 font-semibold text-lg flex items-center gap-2 text-foreground",children:[e.jsx(d,{name:"KeyRound",size:18})," Login with Discord"]}),e.jsxs("div",{className:"text-sm mb-4 text-foreground",children:["Click ",e.jsx("strong",{children:"Login with Discord"})," to open the OAuth flow and link your account."]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:a(),"aria-label":"Login via Discord",children:[e.jsx(d,{name:"KeyRound",size:14})," Login with Discord"]})}),e.jsx(t,{variant:"secondary",size:"sm",onClick:x,children:"What is Discord?"})]})]}),e.jsxs(l,{className:"rounded border p-4",children:[e.jsxs("div",{className:"mb-2 font-semibold text-lg flex items-center gap-2 text-foreground",children:[e.jsx(d,{name:"Mail",size:18})," Authenticate via In-Game Mail"]}),e.jsx("div",{className:"text-sm text-foreground mb-4 leading-relaxed",children:"You will receive a login link via in-game mail."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(s,{to:"/nation_picker",children:"Choose Nation"})}),e.jsx(t,{variant:"secondary",size:"sm",onClick:h,children:"Help"})]})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-foreground flex items-center gap-3",children:[e.jsx("span",{children:"You can use a login link on Discord by using the command:"}),e.jsx(r,{text:"/web"})," ",e.jsx("span",{className:"text-foreground",children:"(the bot will DM you a link)"})]})]})}function u(){var i;const{data:a,error:l}=m(o(c.endpoint,{},!0)),n=null==a?void 0:a.data;return n&&null==(null==(i=null==n?void 0:n.data)?void 0:i.errorr)?e.jsxs("div",{className:"bg-light/10 border border-light/10 p-2 rounded relative",children:[e.jsx("table",{className:"table-auto w-full border-separate border-spacing-y-1",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"bg-secondary",children:[e.jsx("td",{className:"px-1 py-1 bg-secondary",children:"User"}),e.jsxs("td",{className:"px-1 py-1 bg-secondary",children:[n.user_icon&&e.jsx("img",{src:n.user_icon,alt:n.user_name,className:"w-4 h-4 inline-block mr-1"}),n.user_name?n.user_name+" | ":"",n.user?n.user:"N/A"]})]}),e.jsxs("tr",{className:"bg-secondary",children:[e.jsx("td",{className:"p-1",children:"Nation"}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:"relative",children:[n.nation?e.jsx(s,{className:"text-blue-600 hover:text-blue-800 underline",to:`https://politicsandwar.com/nation/id=${n.nation}`,children:n.nation_name?n.nation_name:n.nation}):"N/A",n.alliance&&" | ",n.alliance?e.jsx(s,{className:"text-blue-600 hover:text-blue-800 underline",to:`https://politicsandwar.com/alliance/id=${n.alliance}`,children:n.alliance_name?n.alliance_name:n.alliance}):"",n.nation&&n.user&&e.jsx(t,{variant:"outline",size:"sm",className:"border-slate-600 absolute top-0 right-0",asChild:!0,children:e.jsx(s,{to:"/unregister",children:n.registered?n.registered_nation==n.nation?"Unlink":"!! Fix Invalid Registration !!":"Link to Discord"})})]})})]}),e.jsxs("tr",{className:"bg-secondary",children:[e.jsx("td",{className:"p-1",children:"Expires"}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:"relative",children:[n.expires?e.jsx(x,{millis:n.expires}):"N/A",e.jsx(t,{variant:"outline",size:"sm",className:"border-slate-600 absolute top-0 right-0",asChild:!0,children:e.jsx(s,{to:"/logout",children:"Logout"})})]})})]}),e.jsxs("tr",{className:"bg-secondary",children:[e.jsx("td",{className:"p-1",children:"Guild"}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:"relative",children:[n.guild_icon&&e.jsx("img",{src:n.guild_icon,alt:n.guild_name,className:"w-4 h-4 inline-block mr-1"}),n.guild_name?n.guild_name+" | ":"",n.guild?n.guild:"N/A",e.jsx(t,{variant:"outline",size:"sm",className:"border-slate-600 absolute top-0 right-0",asChild:!0,children:e.jsx(s,{to:"/guild_select",children:n.guild?"Switch":"Select"})})]})})]})]})}),n.guild&&e.jsx(t,{variant:"link",className:"hover:text-blue-500 underline text-lg",asChild:!0,children:e.jsxs(s,{to:"/guild_member",children:["View Guild Member Homepage",e.jsx(d,{name:"ChevronRight"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error2: "}),e.jsxs("span",{className:"block sm:inline",children:["Could not fetch login data. ",(null==l?void 0:l.message)??(null==a?void 0:a.error)??"Unknown Error"]})]}),e.jsx(h,{})]})}export{h as L,u as S};
