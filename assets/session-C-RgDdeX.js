import{c as Ae,j as s,L as ne,a as Re,g as $e}from"./index-nW9DkA3u.js";import{B as Ce,a as we,b as Se,d as ze,C as ce,c as Le}from"./badge-CvWKVvcB.js";import{u as Ue,C as De}from"./DialogContext-BfwqmJEN.js";import{B as g}from"./button-ujMD_D3S.js";import{b as Me,S as Oe,L as h}from"./queries-B0bYDAFD.js";import{u as Ie}from"./useQuery-fCXS6SR7.js";import{T as Ee}from"./timestamp-CoHBuXii.js";function Be(){const e=Ae.c(31),{showDialog:r}=Ue();let ie,A;e[0]===Symbol.for("react.memo_cache_sentinel")?(A=s.jsx("strong",{children:"Login (OAuth)"}),e[0]=A):A=e[0];let R;e[1]===Symbol.for("react.memo_cache_sentinel")?(R=s.jsxs("p",{className:"text-sm text-foreground",children:[A,": Clicking ",s.jsx("em",{children:"Login with Discord"})," opens the OAuth flow in your browser to link your account immediately."]}),e[1]=R):R=e[1];let b;e[2]===Symbol.for("react.memo_cache_sentinel")?(b=s.jsx("strong",{children:"Request a web link"}),e[2]=b):b=e[2];let S;e[3]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsxs("p",{className:"text-sm text-foreground",children:[b,": Use ",s.jsx(De,{text:"/web"})," in a channel with the Locutus bot to request a web login link (the bot will DM you a link)."]}),e[3]=S):S=e[3];let t;e[4]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsxs("div",{className:"space-y-3",children:[R,S,s.jsx("div",{className:"mt-2",children:s.jsx(g,{variant:"outline",size:"sm",asChild:!0,children:s.jsx("a",{href:"https://discord.com/download",target:"_blank",rel:"noreferrer",children:"Download Discord"})})})]}),e[4]=t):t=e[4],ie=t;const ke=ie;let re,j;e[5]===Symbol.for("react.memo_cache_sentinel")?(j=s.jsx("h3",{className:"font-semibold text-foreground",children:"How to authenticate"}),e[5]=j):j=e[5];let p;e[6]===Symbol.for("react.memo_cache_sentinel")?(p=s.jsxs("div",{className:"space-y-2",children:[j,s.jsxs("ol",{className:"list-decimal list-inside text-sm text-foreground",children:[s.jsx("li",{children:"Select your nation"}),s.jsx("li",{children:"Open your in-game mail"}),s.jsx("li",{children:"Click the authentication link"})]})]}),e[6]=p):p=e[6],re=p;const ae=re;let N;e[7]!==r?(N=()=>r("Discord: Login vs `/web`",ke),e[7]=r,e[8]=N):N=e[8];const k=N;let a;e[9]!==r?(a=()=>r("In-Game Mail Authentication",ae),e[9]=r,e[10]=a):a=e[10];const C=a;let n;e[11]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsxs("div",{className:"pb-3 flex items-center justify-between gap-3 border-b border-border mb-3",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Sign in to access web features"}),s.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Link your Discord or in-game nation."})]}),s.jsx(h,{name:"KeyRound",size:32,className:"text-muted-foreground"})]}),e[11]=n):n=e[11];let _;e[12]===Symbol.for("react.memo_cache_sentinel")?(_=s.jsxs("div",{className:"mb-3 font-semibold text-lg flex items-center gap-2 text-foreground",children:[s.jsx(h,{name:"KeyRound",size:20,className:"text-primary"})," Login with Discord"]}),e[12]=_):_=e[12];let f;e[13]===Symbol.for("react.memo_cache_sentinel")?(f=s.jsxs("div",{className:"text-sm mb-3 text-muted-foreground",children:["Click ",s.jsx("strong",{children:"Login with Discord"})," to open the OAuth flow and link your account."]}),e[13]=f):f=e[13];let v;e[14]===Symbol.for("react.memo_cache_sentinel")?(v=$e(),e[14]=v):v=e[14];let z;e[15]===Symbol.for("react.memo_cache_sentinel")?(z=s.jsx(g,{variant:"outline",size:"sm",className:"border-primary/45 bg-card text-foreground hover:bg-primary/12 hover:text-foreground",asChild:!0,children:s.jsxs("a",{href:v,"aria-label":"Login via Discord",children:[s.jsx(h,{name:"KeyRound",size:16,className:"mr-2"})," Login with Discord"]})}),e[15]=z):z=e[15];let l;e[16]!==k?(l=s.jsxs(ce,{className:"rounded-lg border border-border p-3 hover:shadow-md transition-shadow",children:[_,f,s.jsxs("div",{className:"flex items-center gap-3",children:[z,s.jsx(g,{variant:"outline",size:"sm",onClick:k,children:"What is Discord?"})]})]}),e[16]=k,e[17]=l):l=e[17];let c,y;e[18]===Symbol.for("react.memo_cache_sentinel")?(c=s.jsxs("div",{className:"mb-3 font-semibold text-lg flex items-center gap-2 text-foreground",children:[s.jsx(h,{name:"Mail",size:20,className:"text-primary"})," Authenticate via In-Game Mail"]}),y=s.jsx("div",{className:"text-sm text-muted-foreground mb-3 leading-relaxed",children:"You will receive a login link via in-game mail."}),e[18]=c,e[19]=y):(c=e[18],y=e[19]);let o;e[20]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(g,{variant:"outline",size:"sm",className:"border-primary/45 bg-card text-foreground hover:bg-primary/12 hover:text-foreground",asChild:!0,children:s.jsx(ne,{to:"/nation_picker",children:"Choose Nation"})}),e[20]=o):o=e[20];let u;e[21]!==C?(u=s.jsxs(ce,{className:"rounded-lg border border-border p-3 hover:shadow-md transition-shadow",children:[c,y,s.jsxs("div",{className:"flex items-center gap-3",children:[o,s.jsx(g,{variant:"outline",size:"sm",onClick:C,children:"Help"})]})]}),e[21]=C,e[22]=u):u=e[22];let i;e[23]!==l||e[24]!==u?(i=s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[l,u]}),e[23]=l,e[24]=u,e[25]=i):i=e[25];let L,d;e[26]===Symbol.for("react.memo_cache_sentinel")?(L=s.jsx("span",{children:"You can use a login link on Discord by using the command:"}),d=s.jsx(De,{text:"/web"}),e[26]=L,e[27]=d):(L=e[26],d=e[27]);let m;e[28]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsxs("div",{className:"mt-3 pt-2 border-t border-border text-sm text-muted-foreground flex flex-wrap items-center gap-2",children:[L,d," ",s.jsx("span",{children:"(the bot will DM you a link)"})]}),e[28]=m):m=e[28];let x;return e[29]!==i?(x=s.jsxs("div",{className:"bg-card border border-border rounded-lg p-3 mt-3 shadow-sm",children:[n,i,m]}),e[29]=i,e[30]=x):x=e[30],x}function Qe(){const e=Ae.c(117);let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=Me(Oe.endpoint,{},!0),e[0]=r):r=e[0];const{data:ie,error:A,isLoading:R,isFetching:b,refetch:S}=Ie(r),t=ie?.data??null,re=t?.error??ie?.error??(A instanceof Error?A.message:null),j="/";let p;e[1]!==S?(p=()=>S(),e[1]=S,e[2]=p):p=e[2];const ae=p;if(R){let w;e[3]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsxs(we,{className:"p-3 pb-2 border-b border-border",children:[s.jsxs(Se,{className:"flex items-center gap-2 text-lg",children:[s.jsx(h,{name:"User",size:20,className:"text-primary"}),"Session"]}),s.jsx(ze,{children:"Loading…"})]}),e[3]=w):w=e[3];let D;return e[4]===Symbol.for("react.memo_cache_sentinel")?(D=s.jsxs(ce,{className:"bg-card border border-border shadow-sm mt-3",children:[w,s.jsx(Le,{className:"p-3",children:s.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[s.jsx(Re,{variant:"ripple"}),"Fetching session…"]})})]}),e[4]=D):D=e[4],D}if(!t||re){let w;e[5]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsxs(Se,{className:"flex items-center gap-2 text-base",children:[s.jsx(h,{name:"TriangleAlert",size:18}),"Could not load session"]}),e[5]=w):w=e[5];const D=String(re??"Unknown error");let le;e[6]!==D?(le=s.jsx(ce,{className:"border border-destructive/40 bg-destructive/5",children:s.jsxs(we,{className:"p-3",children:[w,s.jsx(ze,{className:"wrap-break-word",children:D})]})}),e[6]=D,e[7]=le):le=e[7];let be;e[8]===Symbol.for("react.memo_cache_sentinel")?(be=s.jsx(Be,{}),e[8]=be):be=e[8];let je;return e[9]!==le?(je=s.jsxs(s.Fragment,{children:[le,be]}),e[9]=le,e[10]=je):je=e[10],je}const N=t.nation?`https://politicsandwar.com/nation/id=${t.nation}`:null,k=t.alliance?`https://politicsandwar.com/alliance/id=${t.alliance}`:null,a=!!t.registered&&!!t.registered_nation&&t.registered_nation!==t.nation;let C;e[11]!==a||e[12]!==t.registered?(C=t.registered?a?{label:"Needs repair",variant:"destructive"}:{label:"Linked",variant:"secondary"}:{label:"Not linked",variant:"secondary"},e[11]=a,e[12]=t.registered,e[13]=C):C=e[13];const n=C;let _;e[14]!==a||e[15]!==t.nation||e[16]!==t.registered||e[17]!==t.user?(_=t.nation&&t.user?t.registered?a?{label:"Repair Discord link",danger:!0}:{label:"Unlink account",danger:!0}:{label:"Link Discord",danger:!1}:null,e[14]=a,e[15]=t.nation,e[16]=t.registered,e[17]=t.user,e[18]=_):_=e[18];const f=_;let v;e[19]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx("div",{className:"min-w-0",children:s.jsxs(Se,{className:"flex items-center gap-2 text-xl",children:[s.jsx(h,{name:"User",size:22,className:"text-primary"}),"Session"]})}),e[19]=v):v=e[19];const z=b?"animate-spin":"";let l;e[20]!==z?(l=s.jsx(h,{name:"RotateCcw",size:16,className:z}),e[20]=z,e[21]=l):l=e[21];let c;e[22]!==b||e[23]!==ae||e[24]!==l?(c=s.jsx(g,{variant:"outline",size:"sm",onClick:ae,disabled:b,"aria-label":"Refresh session",className:"h-8 w-8 p-0",children:l}),e[22]=b,e[23]=ae,e[24]=l,e[25]=c):c=e[25];let y;e[26]===Symbol.for("react.memo_cache_sentinel")?(y=s.jsx(g,{variant:"destructive",size:"sm",className:"h-8 px-3",asChild:!0,children:s.jsxs(ne,{to:`${j}logout`,className:"flex items-center gap-2",children:[s.jsx(h,{name:"LogOut",size:16}),s.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})}),e[26]=y):y=e[26];let o;e[27]!==c?(o=s.jsx(we,{className:"p-3 pb-2 border-b border-border mb-2",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[v,s.jsxs("div",{className:"flex items-center gap-2",children:[c,y]})]})}),e[27]=c,e[28]=o):o=e[28];const u=`rounded-md border p-2 ${t.guild?"bg-card":"border-primary/40 bg-red-400/20"}`;let i;e[29]!==t.guild_icon||e[30]!==t.guild_name?(i=t.guild_icon?s.jsx("img",{src:t.guild_icon,alt:t.guild_name||"Guild",className:"h-9 w-9 rounded-md"}):s.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-md bg-muted",children:s.jsx(h,{name:"Users",size:18})}),e[29]=t.guild_icon,e[30]=t.guild_name,e[31]=i):i=e[31];const L=t.guild?t.guild_name||"Guild":"No guild selected";let d;e[32]!==L?(d=s.jsx("div",{className:"truncate font-medium",children:L}),e[32]=L,e[33]=d):d=e[33];let m;e[34]!==t.guild?(m=t.guild?s.jsx("span",{className:"truncate text-xs text-muted-foreground",children:t.guild}):s.jsx(Ce,{className:"h-5 px-2",children:"Required"}),e[34]=t.guild,e[35]=m):m=e[35];let x;e[36]!==d||e[37]!==m?(x=s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[d,m]}),e[36]=d,e[37]=m,e[38]=x):x=e[38];const pe=t.guild?"Guild context is selected.":"Select a guild to unlock member pages and tools.";let $;e[39]!==pe?($=s.jsx("div",{className:"text-xs text-muted-foreground truncate",children:pe}),e[39]=pe,e[40]=$):$=e[40];let U;e[41]!==x||e[42]!==$?(U=s.jsxs("div",{className:"min-w-0",children:[x,$]}),e[41]=x,e[42]=$,e[43]=U):U=e[43];let M;e[44]!==i||e[45]!==U?(M=s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[i,U]}),e[44]=i,e[45]=U,e[46]=M):M=e[46];const Ne=t.guild?"Switch guild":"Select guild";let O;e[47]!==Ne?(O=s.jsx(g,{variant:"outline",size:"sm",asChild:!0,children:s.jsx(ne,{to:`${j}guild_select`,children:Ne})}),e[47]=Ne,e[48]=O):O=e[48];let I;e[49]!==t.guild?(I=t.guild?s.jsx(g,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs(ne,{to:`${j}guild_member`,children:["Member home",s.jsx(h,{name:"ChevronRight",className:"ml-1",size:16})]})}):null,e[49]=t.guild,e[50]=I):I=e[50];let E;e[51]!==O||e[52]!==I?(E=s.jsxs("div",{className:"flex flex-wrap gap-2",children:[O,I]}),e[51]=O,e[52]=I,e[53]=E):E=e[53];let B;e[54]!==M||e[55]!==E?(B=s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[M,E]}),e[54]=M,e[55]=E,e[56]=B):B=e[56];let G;e[57]!==u||e[58]!==B?(G=s.jsx("div",{className:u,children:B}),e[57]=u,e[58]=B,e[59]=G):G=e[59];let oe;e[60]===Symbol.for("react.memo_cache_sentinel")?(oe=s.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-muted-foreground",children:"Identity"}),e[60]=oe):oe=e[60];let de;e[61]===Symbol.for("react.memo_cache_sentinel")?(de=s.jsx("div",{className:"text-muted-foreground w-20",children:"User"}),e[61]=de):de=e[61];let T;e[62]!==t.user_icon||e[63]!==t.user_name?(T=t.user_icon?s.jsx("img",{src:t.user_icon,alt:t.user_name||"User",className:"h-6 w-6 rounded-sm"}):null,e[62]=t.user_icon,e[63]=t.user_name,e[64]=T):T=e[64];const _e=t.user_name||t.user||"",ve=t.user_name?`${t.user_name} | `:"",ye=t.user||"N/A";let q;e[65]!==_e||e[66]!==ve||e[67]!==ye?(q=s.jsxs("span",{className:"truncate",title:_e,children:[ve,ye]}),e[65]=_e,e[66]=ve,e[67]=ye,e[68]=q):q=e[68];let F;e[69]!==T||e[70]!==q?(F=s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[de,s.jsxs("div",{className:"min-w-0 flex items-center justify-end gap-2",children:[T,q]})]}),e[69]=T,e[70]=q,e[71]=F):F=e[71];let me;e[72]===Symbol.for("react.memo_cache_sentinel")?(me=s.jsx("div",{className:"text-muted-foreground w-20",children:"Nation"}),e[72]=me):me=e[72];let H;e[73]!==N||e[74]!==t.nation||e[75]!==t.nation_name?(H=N?s.jsx("a",{href:N,target:"_blank",rel:"noreferrer",className:"hover:underline underline-offset-4",children:t.nation_name||t.nation}):"N/A",e[73]=N,e[74]=t.nation,e[75]=t.nation_name,e[76]=H):H=e[76];let K;e[77]!==H?(K=s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[me,s.jsx("div",{className:"min-w-0 text-right",children:H})]}),e[77]=H,e[78]=K):K=e[78];let xe;e[79]===Symbol.for("react.memo_cache_sentinel")?(xe=s.jsx("div",{className:"text-muted-foreground w-20",children:"Alliance"}),e[79]=xe):xe=e[79];let P;e[80]!==k||e[81]!==t.alliance||e[82]!==t.alliance_name?(P=k?s.jsx("a",{href:k,target:"_blank",rel:"noreferrer",className:"hover:underline underline-offset-4",children:t.alliance_name||t.alliance}):"N/A",e[80]=k,e[81]=t.alliance,e[82]=t.alliance_name,e[83]=P):P=e[83];let Q;e[84]!==P?(Q=s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[xe,s.jsx("div",{className:"min-w-0 text-right",children:P})]}),e[84]=P,e[85]=Q):Q=e[85];let Y;e[86]!==F||e[87]!==K||e[88]!==Q?(Y=s.jsxs("div",{className:"rounded-md border bg-card p-2",children:[oe,s.jsxs("div",{className:"space-y-1 text-sm",children:[F,K,Q]})]}),e[86]=F,e[87]=K,e[88]=Q,e[89]=Y):Y=e[89];let he;e[90]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx("div",{className:"text-xs font-medium uppercase tracking-wide text-muted-foreground",children:"Session"}),e[90]=he):he=e[90];let W;e[91]!==n.label||e[92]!==n.variant?(W=s.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[he,s.jsx(Ce,{variant:n.variant,children:n.label})]}),e[91]=n.label,e[92]=n.variant,e[93]=W):W=e[93];let fe;e[94]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx("div",{className:"text-muted-foreground w-20",children:"Expires"}),e[94]=fe):fe=e[94];let J;e[95]!==t.expires?(J=t.expires?s.jsx(Ee,{millis:t.expires}):"N/A",e[95]=t.expires,e[96]=J):J=e[96];let V;e[97]!==J?(V=s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[fe,s.jsx("div",{className:"min-w-0 text-right",children:J})]}),e[97]=J,e[98]=V):V=e[98];let ue;e[99]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx("div",{className:"text-muted-foreground w-20",children:"Discord"}),e[99]=ue):ue=e[99];let X;e[100]!==f?(X=s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[ue,s.jsx("div",{className:"min-w-0 flex items-center justify-end gap-2",children:f?s.jsx(g,{variant:"secondary",size:"sm",className:`h-7 px-2 ${f.danger?"text-destructive hover:text-destructive":""}`,asChild:!0,children:s.jsx(ne,{to:`${j}unregister`,children:f.label})}):s.jsx("span",{className:"text-muted-foreground",children:"—"})})]}),e[100]=f,e[101]=X):X=e[101];let Z;e[102]!==V||e[103]!==X?(Z=s.jsxs("div",{className:"space-y-1 text-sm",children:[V,X]}),e[102]=V,e[103]=X,e[104]=Z):Z=e[104];let ee;e[105]!==W||e[106]!==Z?(ee=s.jsxs("div",{className:"rounded-md border bg-card p-2",children:[W,Z]}),e[105]=W,e[106]=Z,e[107]=ee):ee=e[107];let se;e[108]!==Y||e[109]!==ee?(se=s.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[Y,ee]}),e[108]=Y,e[109]=ee,e[110]=se):se=e[110];let te;e[111]!==G||e[112]!==se?(te=s.jsxs(Le,{className:"p-3 pt-0 space-y-2",children:[G,se]}),e[111]=G,e[112]=se,e[113]=te):te=e[113];let ge;return e[114]!==te||e[115]!==o?(ge=s.jsxs(ce,{className:"bg-card border border-border shadow-sm mt-3",children:[o,te]}),e[114]=te,e[115]=o,e[116]=ge):ge=e[116],ge}export{Be as L,Qe as S};
