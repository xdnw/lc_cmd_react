import{r as e,j as s,L as i,g as a}from"./index-CB60MK8B.js";import{C as n,a as r,b as l,d as t,c as d,B as c}from"./badge-DRDbh3fW.js";import{u as o,C as m}from"./DialogContext-Ddeg3-RV.js";import{B as x}from"./button-Dc6LF0a5.js";import{b as u,L as h,a as g,S as j}from"./loading-Cq9Kwdp4.js";import{u as f}from"./useQuery-zqD4DT95.js";import{T as p}from"./timestamp-BEgDPioM.js";function N(){const{showDialog:r}=o(),l=e.useMemo((()=>s.jsxs("div",{className:"space-y-3",children:[s.jsxs("p",{className:"text-sm text-foreground",children:[s.jsx("strong",{children:"Login (OAuth)"}),": Clicking ",s.jsx("em",{children:"Login with Discord"})," opens the OAuth flow in your browser to link your account immediately."]}),s.jsxs("p",{className:"text-sm text-foreground",children:[s.jsx("strong",{children:"Request a web link"}),": Use ",s.jsx(m,{text:"/web"})," in a channel with the Locutus bot to request a web login link (the bot will DM you a link)."]}),s.jsx("div",{className:"mt-2",children:s.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:s.jsx("a",{href:"https://discord.com/download",target:"_blank",rel:"noreferrer",children:"Download Discord"})})})]})),[]),t=e.useMemo((()=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"font-semibold text-foreground",children:"How to authenticate"}),s.jsxs("ol",{className:"list-decimal list-inside text-sm text-foreground",children:[s.jsx("li",{children:"Select your nation"}),s.jsx("li",{children:"Open your in-game mail"}),s.jsx("li",{children:"Click the authentication link"})]})]})),[]),d=e.useCallback((()=>r("Discord: Login vs `/web`",l)),[r,l]),c=e.useCallback((()=>r("In-Game Mail Authentication",t)),[r,t]);return s.jsxs("div",{className:"bg-light/10 border border-light/10 rounded p-2 mt-4",children:[s.jsxs("div",{className:"pb-3 flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Sign in to access web features"}),s.jsx("div",{className:"text-sm text-foreground",children:"Link your Discord or in-game nation."})]}),s.jsx(h,{name:"KeyRound",size:28})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(n,{className:"rounded border p-3",children:[s.jsxs("div",{className:"mb-2 font-semibold text-lg flex items-center gap-2 text-foreground",children:[s.jsx(h,{name:"KeyRound",size:18})," Login with Discord"]}),s.jsxs("div",{className:"text-sm mb-4 text-foreground",children:["Click ",s.jsx("strong",{children:"Login with Discord"})," to open the OAuth flow and link your account."]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs("a",{href:a(),"aria-label":"Login via Discord",children:[s.jsx(h,{name:"KeyRound",size:14})," Login with Discord"]})}),s.jsx(x,{variant:"secondary",size:"sm",onClick:d,children:"What is Discord?"})]})]}),s.jsxs(n,{className:"rounded border p-3",children:[s.jsxs("div",{className:"mb-2 font-semibold text-lg flex items-center gap-2 text-foreground",children:[s.jsx(h,{name:"Mail",size:18})," Authenticate via In-Game Mail"]}),s.jsx("div",{className:"text-sm text-foreground mb-4 leading-relaxed",children:"You will receive a login link via in-game mail."}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:s.jsx(i,{to:"/nation_picker",children:"Choose Nation"})}),s.jsx(x,{variant:"secondary",size:"sm",onClick:c,children:"Help"})]})]})]}),s.jsxs("div",{className:"mt-3 text-sm text-foreground flex items-center gap-3",children:[s.jsx("span",{children:"You can use a login link on Discord by using the command:"}),s.jsx(m,{text:"/web"})," ",s.jsx("span",{className:"text-foreground",children:"(the bot will DM you a link)"})]})]})}function b(){const{data:a,error:o,isLoading:m,isFetching:b,refetch:v}=f(u(j.endpoint,{},!0)),w=(null==a?void 0:a.data)??null,y=(null==w?void 0:w.error)??(null==a?void 0:a.error)??(o instanceof Error?o.message:null),k="/",C=e.useCallback((()=>v()),[v]);if(m)return s.jsxs(n,{className:"bg-light/10 border border-light/10",children:[s.jsxs(r,{className:"p-3 pb-1",children:[s.jsxs(l,{className:"flex items-center gap-2 text-base",children:[s.jsx(h,{name:"User",size:18}),"Session"]}),s.jsx(t,{children:"Loading…"})]}),s.jsx(d,{className:"p-3 pt-0",children:s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(g,{variant:"ripple"}),"Fetching session…"]})})]});if(!w||y)return s.jsxs(s.Fragment,{children:[s.jsx(n,{className:"border border-destructive/40 bg-destructive/5",children:s.jsxs(r,{className:"p-3",children:[s.jsxs(l,{className:"flex items-center gap-2 text-base",children:[s.jsx(h,{name:"TriangleAlert",size:18}),"Could not load session"]}),s.jsx(t,{className:"break-words",children:String(y??"Unknown error")})]})}),s.jsx(N,{})]});const z=w.nation?`https://politicsandwar.com/nation/id=${w.nation}`:null,_=w.alliance?`https://politicsandwar.com/alliance/id=${w.alliance}`:null,D=!!w.registered&&!!w.registered_nation&&w.registered_nation!==w.nation,L=w.registered?D?{label:"Needs repair",variant:"destructive"}:{label:"Linked",variant:"secondary"}:{label:"Not linked",variant:"secondary"},A=w.nation&&w.user?w.registered?D?{label:"Repair Discord link",danger:!0}:{label:"Unlink account",danger:!0}:{label:"Link Discord",danger:!1}:null;return s.jsxs(n,{className:"bg-light/10 border border-light/10",children:[s.jsx(r,{className:"p-3 pb-1",children:s.jsxs("div",{className:"flex items-start justify-between gap-3",children:[s.jsx("div",{className:"min-w-0",children:s.jsxs(l,{className:"flex items-center gap-2 text-lg",children:[s.jsx(h,{name:"User",size:18}),"Session"]})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{variant:"outline",size:"sm",onClick:C,disabled:b,"aria-label":"Refresh session",children:s.jsx(h,{name:"RotateCcw",size:18,className:b?"animate-spin":""})}),s.jsx(x,{variant:"outline",size:"sm",className:"px-2",asChild:!0,children:s.jsxs(i,{to:`${k}logout`,className:"flex items-center",children:[s.jsx(h,{name:"X",size:18}),s.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})})]})]})}),s.jsxs(d,{className:"p-3 pt-0 space-y-2",children:[s.jsx("div",{className:"rounded-md border p-2 "+(w.guild?"bg-background/20":"border-primary/40 bg-primary/5"),children:s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[w.guild_icon?s.jsx("img",{src:w.guild_icon,alt:w.guild_name||"Guild",className:"h-9 w-9 rounded-md"}):s.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-md bg-muted",children:s.jsx(h,{name:"Users",size:18})}),s.jsxs("div",{className:"min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.jsx("div",{className:"truncate font-medium",children:w.guild?w.guild_name||"Guild":"No guild selected"}),w.guild?s.jsx("span",{className:"truncate text-xs text-muted-foreground",children:w.guild}):s.jsx(c,{className:"h-5 px-2",children:"Required"})]}),s.jsx("div",{className:"text-xs text-muted-foreground truncate",children:w.guild?"Guild context is selected.":"Select a guild to unlock member pages and tools."})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:s.jsx(i,{to:`${k}guild_select`,children:w.guild?"Switch guild":"Select guild"})}),w.guild?s.jsx(x,{variant:"secondary",size:"sm",asChild:!0,children:s.jsxs(i,{to:`${k}guild_member`,children:["Member home",s.jsx(h,{name:"ChevronRight",className:"ml-1",size:16})]})}):null]})]})}),s.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[s.jsxs("div",{className:"rounded-md border bg-background/20 p-2",children:[s.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-muted-foreground",children:"Identity"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("div",{className:"text-muted-foreground w-20",children:"User"}),s.jsxs("div",{className:"min-w-0 flex items-center justify-end gap-2",children:[w.user_icon?s.jsx("img",{src:w.user_icon,alt:w.user_name||"User",className:"h-6 w-6 rounded-sm"}):null,s.jsxs("span",{className:"truncate",title:w.user_name||w.user||"",children:[w.user_name?`${w.user_name} | `:"",w.user||"N/A"]})]})]}),s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("div",{className:"text-muted-foreground w-20",children:"Nation"}),s.jsx("div",{className:"min-w-0 text-right",children:z?s.jsx("a",{href:z,target:"_blank",rel:"noreferrer",className:"hover:underline underline-offset-4",children:w.nation_name||w.nation}):"N/A"})]}),s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("div",{className:"text-muted-foreground w-20",children:"Alliance"}),s.jsx("div",{className:"min-w-0 text-right",children:_?s.jsx("a",{href:_,target:"_blank",rel:"noreferrer",className:"hover:underline underline-offset-4",children:w.alliance_name||w.alliance}):"N/A"})]})]})]}),s.jsxs("div",{className:"rounded-md border bg-background/20 p-2",children:[s.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[s.jsx("div",{className:"text-xs font-medium uppercase tracking-wide text-muted-foreground",children:"Session"}),s.jsx(c,{variant:L.variant,children:L.label})]}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("div",{className:"text-muted-foreground w-20",children:"Expires"}),s.jsx("div",{className:"min-w-0 text-right",children:w.expires?s.jsx(p,{millis:w.expires}):"N/A"})]}),s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("div",{className:"text-muted-foreground w-20",children:"Discord"}),s.jsx("div",{className:"min-w-0 flex items-center justify-end gap-2",children:A?s.jsx(x,{variant:"secondary",size:"sm",className:"h-7 px-2 "+(A.danger?"text-destructive hover:text-destructive":""),asChild:!0,children:s.jsx(i,{to:`${k}unregister`,children:A.label})}):s.jsx("span",{className:"text-muted-foreground",children:"—"})})]})]})]})]})]})]})}export{N as L,b as S};
