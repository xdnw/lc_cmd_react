import{r as u,j as t,c as z,f as de}from"./index-CkdKFI98.js";import{a as O,B as I}from"./button-C_VcwxQ2.js";import{E as oe}from"./bulkwrapper-BIfe5AfD.js";import{L as _,F as ue,H as me}from"./queries-ByOb2jVj.js";import{C as ee,a as te,b as se,d as ae,c as ne,B as J}from"./badge-4LqtZPwg.js";import"./useSuspenseQuery-AkitrqQh.js";import"./command-utils-CkY5cVJv.js";import"./command-meta-r_ruCnhz.js";function xe(){const r="locutus".trim();return r||void 0}function he(n){const r=String(n||"").toUpperCase();return r==="UP"?"Operational":r==="HASISSUES"?"Degraded performance":r==="UNDERMAINTENANCE"?"Maintenance":r==="PARTIALOUTAGE"?"Partial outage":r==="MAJOROUTAGE"?"Major outage":r||"Unknown"}function fe(n){const r=String(n||"").toUpperCase();return r==="UP"?"bg-emerald-500":r==="HASISSUES"?"bg-yellow-500":r==="UNDERMAINTENANCE"?"bg-blue-500":r==="PARTIALOUTAGE"?"bg-orange-500":r==="MAJOROUTAGE"?"bg-red-500":"bg-muted-foreground"}function ge(n){const r=String(n||"").toUpperCase();return r==="UP"?"secondary":r==="UNDERMAINTENANCE"||r==="HASISSUES"||r==="PARTIALOUTAGE"?"default":r==="MAJOROUTAGE"?"destructive":"outline"}function pe(n){const r=String(n||"").toUpperCase();return r.includes("MAJOR")||r.includes("OUTAGE")||r.includes("CRITICAL")?"destructive":r.includes("PARTIAL")?"default":r.includes("MINOR")?"secondary":"outline"}function ie(n){if(!n)return;const r=new Date(n);return Number.isFinite(r.getTime())?r:void 0}function le(n){return n?n.toLocaleString():"—"}function ve(n,r){if(!r)return"—";const e=Math.max(0,n-r);return e<1e3?"just now":e<6e4?`${Math.floor(e/1e3)}s ago`:e<36e5?`${Math.floor(e/6e4)}m ago`:`${Math.floor(e/36e5)}h ago`}function W(n){const r=z.c(4),{className:e}=n;let s;r[0]!==e?(s=O("h-4 w-full animate-pulse rounded bg-muted",e),r[0]=e,r[1]=s):s=r[1];let i;return r[2]!==s?(i=t.jsx("div",{className:s}),r[2]=s,r[3]=i):i=r[3],i}function je({className:n,title:r="Service status",refreshMs:e=6e4}){const s=xe(),i=u.useMemo(()=>{if(s)return`https://${s}.instatus.com/summary.json`},[s]),[a,c]=u.useState(()=>({kind:"idle"})),[m,g]=u.useState(()=>Date.now());u.useEffect(()=>{const l=setInterval(()=>g(Date.now()),1e3);return()=>clearInterval(l)},[]);const N=u.useCallback(async()=>{if(!i)return;c(x=>({kind:"loading"}));const l=new AbortController,b=setTimeout(()=>l.abort(),12e3);try{const x=await fetch(i,{method:"GET",headers:{Accept:"application/json"},signal:l.signal,cache:"no-store"});if(!x.ok)throw new Error(`HTTP ${x.status} ${x.statusText}`);const E=await x.json();if(!E?.page?.status)throw new Error("Unexpected response shape (missing page.status).");c({kind:"success",data:E,fetchedAtMs:Date.now()})}catch(x){const E=x instanceof DOMException&&x.name==="AbortError"?"Request timed out.":x instanceof Error?x.message:"Failed to load status.";c(S=>({kind:"error",message:E,fetchedAtMs:S.kind==="success"?S.fetchedAtMs:void 0}))}finally{clearTimeout(b)}},[i]);if(u.useEffect(()=>{if(!i||(N(),e<=0))return;const l=setInterval(()=>{N()},e);return()=>clearInterval(l)},[i,e,N]),!s)return t.jsxs(ee,{className:O("border-destructive/40 bg-destructive/5",n),children:[t.jsxs(te,{children:[t.jsxs(se,{className:"flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex h-2 w-2 rounded-full bg-destructive","aria-hidden":"true"}),r]}),t.jsx(ae,{children:"Configuration required"})]}),t.jsx(ne,{className:"space-y-2 text-sm",children:t.jsxs("div",{className:"rounded-md border border-destructive/20 bg-background/50 p-3",children:[t.jsx("div",{className:"font-semibold",children:"Missing `process.env.instatus`"}),t.jsxs("div",{className:"mt-1 text-muted-foreground",children:["Set your Instatus subdomain (e.g. ",t.jsx("span",{className:"font-mono",children:'"acme"'}),") so this component can fetch:",t.jsx("div",{className:"mt-1 font-mono text-xs text-foreground/90",children:"https://acme.instatus.com/summary.json"})]})]})})]});const v=a.kind==="success"||a.kind==="error"?a.fetchedAtMs:void 0,f=a.kind==="loading"||a.kind==="idle",T=a.kind==="success"?a.data:void 0,R=T?.page?.status??"UNKNOWN",h=T?.activeIncidents??[],j=T?.activeMaintenances??[],d=h.length>0||j.length>0;return t.jsxs(ee,{className:O(n),children:[t.jsxs(te,{className:"space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsxs(se,{className:"flex items-center gap-2",children:[t.jsx("span",{className:O("inline-flex h-2.5 w-2.5 rounded-full",fe(R)),"aria-hidden":"true"}),r,t.jsx(J,{variant:ge(R),className:"ml-2",children:he(R)})]}),t.jsxs(ae,{className:"mt-1",children:["Source:"," ",t.jsxs("a",{href:`https://${s}.instatus.com`,className:"underline underline-offset-4",target:"_blank",rel:"noreferrer",children:[s,".instatus.com"]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(I,{variant:"outline",size:"sm",onClick:N,disabled:a.kind==="loading",children:[t.jsx(_,{name:"RotateCcw",className:O("mr-2 h-4 w-4",a.kind==="loading"&&"animate-spin")}),"Refresh"]}),t.jsx(I,{asChild:!0,variant:"outline",size:"sm",children:t.jsxs("a",{href:i,target:"_blank",rel:"noreferrer",children:[t.jsx(_,{name:"ExternalLink",className:"mr-2 h-4 w-4"}),"JSON"]})})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-muted-foreground",children:[t.jsxs("div",{className:"tabular-nums",children:[v?`Updated ${ve(m,v)}`:"Not updated yet",v?` • ${new Date(v).toLocaleTimeString()}`:""]}),a.kind==="error"?t.jsxs("div",{className:"text-destructive",children:["Couldn’t refresh: ",a.message]}):null]})]}),t.jsxs(ne,{className:"space-y-4",children:[f?t.jsxs("div",{className:"space-y-2",children:[t.jsx(W,{className:"w-2/3"}),t.jsx(W,{className:"w-1/2"}),t.jsx(W,{className:"w-4/5"})]}):null,!f&&a.kind==="success"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:O("rounded-md border p-3 text-sm",d?"bg-muted/10":"bg-emerald-500/5"),children:[t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:t.jsx("div",{className:"min-w-0",children:t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("div",{className:"font-medium truncate",children:a.data.page.name})})})}),t.jsx("div",{className:"mt-1",children:d?t.jsx("div",{className:"text-muted-foreground",children:t.jsxs("div",{className:"flex items-center gap-2",children:[h.length>0&&t.jsxs("span",{className:"tabular-nums font-mono",children:[h.length," incident",h.length>1?"s":""]}),h.length>0&&j.length>0&&t.jsx("span",{children:"•"}),j.length>0&&t.jsxs("span",{className:"tabular-nums font-mono",children:[j.length," maintenance",j.length>1?"s":""]}),t.jsx("span",{className:"ml-2 text-xs",children:"There are active incidents and/or maintenance items."})]})}):t.jsx("div",{className:"text-muted-foreground",children:"No incidents or maintenance are currently reported."})})]}),j.length>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm font-semibold",children:"Active maintenance"}),t.jsx(J,{variant:"secondary",children:j.length})]}),t.jsx("div",{className:"space-y-2",children:j.map(l=>{const b=ie(l.start);return t.jsx("div",{className:"rounded-md border bg-background/40 p-3",children:t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"truncate font-medium",children:l.name}),t.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Start: ",le(b)," • Status:"," ",t.jsx("span",{className:"font-mono",children:String(l.status)}),l.duration?` • Duration: ${l.duration}m`:""]})]}),l.url?t.jsx(I,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:t.jsx("a",{href:l.url,target:"_blank",rel:"noreferrer",children:"Details"})}):null]})},`${l.url??l.name}-${l.start}`)})})]}):null,h.length>0&&j.length>0?t.jsx("hr",{className:"my-2 border-t border-gray-200 w-full"}):null,h.length>0?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-sm font-semibold",children:"Active incidents"}),t.jsx(J,{variant:"secondary",children:h.length})]}),t.jsx("div",{className:"space-y-2",children:h.map(l=>{const b=ie(l.started);return t.jsx("div",{className:"rounded-md border bg-background/40 p-3",children:t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:"truncate font-medium",children:l.name}),l.impact?t.jsx(J,{variant:pe(l.impact),className:"font-mono text-[11px]",children:String(l.impact)}):null,t.jsx(J,{variant:"outline",className:"font-mono text-[11px]",children:String(l.status)})]}),t.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Started: ",le(b)]})]}),l.url?t.jsx(I,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:t.jsx("a",{href:l.url,target:"_blank",rel:"noreferrer",children:"Details"})}):null]})},`${l.url??l.name}-${l.started}`)})})]}):null]}):null,!f&&a.kind==="error"?t.jsxs("div",{className:"rounded-md border border-destructive/30 bg-destructive/5 p-3 text-sm",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsx("div",{className:"font-semibold",children:"Couldn’t load status"}),t.jsx(I,{variant:"outline",size:"sm",onClick:N,className:"h-7 px-2 text-xs",children:"Try again"})]}),t.jsxs("div",{className:"mt-1 text-muted-foreground",children:[a.message,t.jsx("div",{className:"mt-2 font-mono text-xs text-foreground/80 break-all",children:i})]})]}):null]})]})}const M={EMPTY:0,SUCCESS:1,ERROR:2,INTERRUPTED:3},be=Object.freeze({}),Ne=[],we=[],Re=1024,X=25,Z=1e4,ye=["ERROR","STUCK","INTERRUPTED","STALE","NEVER","OK"];function B(n){return n===void 0||n<0?"—":n<1e3?`${n}ms`:n<6e4?`${(n/1e3).toFixed(2)}s`:n<36e5?`${(n/6e4).toFixed(1)}m`:`${(n/36e5).toFixed(1)}h`}function Q(n,r){return n?!r||r<=0?"never":`${B(Math.max(0,n-r))} ago`:"—"}function re(n){switch(n){case M.SUCCESS:return"SUCCESS";case M.ERROR:return"ERROR";case M.INTERRUPTED:return"INTERRUPTED";case M.EMPTY:default:return"NEVER"}}function Ee(n){switch(n){case M.SUCCESS:return"bg-green-500/10 text-green-700 dark:text-green-300 ring-1 ring-green-500/20";case M.ERROR:return"bg-red-500/10 text-red-700 dark:text-red-300 ring-1 ring-red-500/20";case M.INTERRUPTED:return"bg-orange-500/10 text-orange-700 dark:text-orange-300 ring-1 ring-orange-500/20";case M.EMPTY:default:return"bg-muted text-muted-foreground ring-1 ring-border"}}function Se(n){switch(n){case M.SUCCESS:return"bg-green-500/70";case M.ERROR:return"bg-red-500/70";case M.INTERRUPTED:return"bg-orange-500/70";case M.EMPTY:default:return"bg-muted-foreground/30"}}function ke(n,r){if(n.totalRuns<=0||n.lastOutcome===M.EMPTY)return{health:"NEVER",sev:4};const e=Math.max(1,n.intervalMs);if(r&&n.running&&n.currentRunStartMs>0){const s=r-n.currentRunStartMs,i=Math.max(e*5,6e4);if(s>i)return{health:"STUCK",reason:`running for ${B(s)}`,sev:0}}if(n.lastOutcome===M.ERROR)return{health:"ERROR",reason:n.lastErrorMessage??void 0,sev:1};if(n.lastOutcome===M.INTERRUPTED)return{health:"INTERRUPTED",reason:"interrupted",sev:2};if(r&&n.lastRunEndMs>0){const s=r-n.lastRunEndMs,i=Math.max(e*3,6e4);if(s>i)return{health:"STALE",reason:`last end ${B(s)} ago`,sev:3}}return{health:"OK",sev:10}}function ce(n){switch(n){case"OK":return"bg-green-500/10 text-green-700 dark:text-green-300 ring-1 ring-green-500/20";case"STALE":return"bg-yellow-500/10 text-yellow-700 dark:text-yellow-300 ring-1 ring-yellow-500/20";case"INTERRUPTED":return"bg-orange-500/10 text-orange-700 dark:text-orange-300 ring-1 ring-orange-500/20";case"ERROR":return"bg-red-500/10 text-red-700 dark:text-red-300 ring-1 ring-red-500/20";case"STUCK":return"bg-purple-500/10 text-purple-700 dark:text-purple-300 ring-1 ring-purple-500/20";default:return"bg-muted text-muted-foreground ring-1 ring-border"}}function Te(n){switch(n){case"ERROR":return"border-l-red-500/60 bg-red-500/5 hover:bg-red-500/10";case"STUCK":return"border-l-purple-500/60 bg-purple-500/5 hover:bg-purple-500/10";case"INTERRUPTED":return"border-l-orange-500/60 bg-orange-500/5 hover:bg-orange-500/10";case"STALE":return"border-l-yellow-500/60 bg-yellow-500/5 hover:bg-yellow-500/10";case"NEVER":return"border-l-muted bg-muted/10 hover:bg-muted/20";default:return"border-l-transparent hover:bg-muted/30"}}function Ce(n){const r=z.c(3),[e,s]=u.useState(void 0);let i,a;return r[0]!==n?(i=()=>{const c=()=>s(Date.now());c();const m=setInterval(c,n);return()=>clearInterval(m)},a=[n],r[0]=n,r[1]=i,r[2]=a):(i=r[1],a=r[2]),u.useEffect(i,a),e}function Me(n,r){const e=z.c(6),[s,i]=u.useState(void 0);let a,c;if(e[0]===Symbol.for("react.memo_cache_sentinel")?(a=()=>{const f=()=>i(Date.now());f();const T=setInterval(f,200);return()=>clearInterval(T)},c=[],e[0]=a,e[1]=c):(a=e[0],c=e[1]),u.useEffect(a,c),!r||!s||n<=0){let f;return e[2]===Symbol.for("react.memo_cache_sentinel")?(f={progress:0,remainingMs:void 0},e[2]=f):f=e[2],f}const m=Math.max(0,Math.min(n,s-r)),g=m/n,N=n-m;let v;return e[3]!==g||e[4]!==N?(v={progress:g,remainingMs:N},e[3]=g,e[4]=N,e[5]=v):v=e[5],v}const Ae=u.memo(function(r){const e=z.c(12),{tick:s,refreshMs:i,active:a,loading:c}=r,m=a===void 0?!0:a,g=c===void 0?!1:c,{progress:N,remainingMs:v}=Me(i,s),f=!m,T=g?"loading...":v===void 0?f?s?"—":"paused":"—":`${Math.max(0,Math.ceil(v/1e3))}s`,R=f?"bg-red-500/70":"bg-primary/60";let h;e[0]!==R?(h=O("h-full transition-[width] duration-150",R),e[0]=R,e[1]=h):h=e[1];const j=`${Math.round(N*100)}%`;let d;e[2]!==j?(d={width:j},e[2]=j,e[3]=d):d=e[3];let l;e[4]!==h||e[5]!==d?(l=t.jsx("div",{className:"h-1.5 flex-1 overflow-hidden rounded bg-muted",children:t.jsx("div",{className:h,style:d})}),e[4]=h,e[5]=d,e[6]=l):l=e[6];let b;e[7]!==T?(b=t.jsx("span",{className:"tabular-nums",children:T}),e[7]=T,e[8]=b):b=e[8];let x;return e[9]!==l||e[10]!==b?(x=t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[l,b]}),e[9]=l,e[10]=b,e[11]=x):x=e[11],x}),Oe=u.memo(function(r){const e=z.c(7),{code:s}=r;let i;e[0]!==s?(i=O("inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium leading-none tabular-nums",Ee(s)),e[0]=s,e[1]=i):i=e[1];let a;e[2]!==s?(a=re(s),e[2]=s,e[3]=a):a=e[3];let c;return e[4]!==i||e[5]!==a?(c=t.jsx("span",{className:i,children:a}),e[4]=i,e[5]=a,e[6]=c):c=e[6],c}),De=u.memo(function(r){const e=z.c(9),{health:s,count:i}=r;let a;e[0]!==s?(a=O("inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold leading-none tabular-nums",ce(s)),e[0]=s,e[1]=a):a=e[1];const c=`${s}: ${i}`;let m;e[2]!==i?(m=t.jsx("span",{className:"text-[11px] font-medium opacity-80",children:i}),e[2]=i,e[3]=m):m=e[3];let g;return e[4]!==s||e[5]!==a||e[6]!==c||e[7]!==m?(g=t.jsxs("span",{className:a,title:c,children:[s,m]}),e[4]=s,e[5]=a,e[6]=c,e[7]=m,e[8]=g):g=e[8],g}),Ue=u.memo(function({text:r,label:e="Copy"}){const s=u.useCallback(i=>{i.preventDefault(),i.stopPropagation();const a=r??"";a&&(async()=>{try{if(typeof navigator<"u"&&navigator.clipboard?.writeText){await navigator.clipboard.writeText(a);return}}catch{}try{typeof window<"u"&&window.prompt("Copy to clipboard:",a)}catch{}})()},[r]);return t.jsxs(I,{variant:"outline",size:"sm",onClick:s,className:"h-7 px-2 text-[11px]",children:[t.jsx(_,{name:"Copy",className:"mr-1 h-3.5 w-3.5"}),e]})}),$e=u.memo(function(r){const e=z.c(20),{startTimesMs:s,durationsMs:i,outcomeCodes:a,from:c,to:m}=r,g=Math.max(0,m-c);let N,v=0;for(let y=c;y<m;y++)v=Math.max(v,Number(i[y]??0));N=v;const f=N;if(g<=0)return null;const T=f||1;let R;e[0]===Symbol.for("react.memo_cache_sentinel")?(R=t.jsx("div",{className:"font-medium",children:"Recent run durations"}),e[0]=R):R=e[0];let h;e[1]!==f?(h=B(f),e[1]=f,e[2]=h):h=e[2];let j;e[3]!==h?(j=t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[R,t.jsxs("div",{className:"tabular-nums",children:["max ",h]})]}),e[3]=h,e[4]=j):j=e[4];let d;e[5]!==g?(d=Array.from({length:g}),e[5]=g,e[6]=d):d=e[6];let l;e[7]!==T||e[8]!==i||e[9]!==c||e[10]!==a||e[11]!==s||e[12]!==d?(l=t.jsx("div",{className:"flex h-12 items-end gap-0.5 rounded-md border bg-background/40 p-1",children:d.map((y,P)=>{const A=c+P,D=Number(s[A]??0),C=Math.max(0,Number(i[A]??0)),w=Number(a[A]??M.EMPTY),$=Math.max(6,Math.round(C/T*100)),L=`${D?new Date(D).toLocaleString():"—"} • ${B(C)} • ${re(w)}`;return t.jsx("div",{className:O("flex-1 rounded-sm",Se(w)),style:{height:`${$}%`},title:L},D||A)})}),e[7]=T,e[8]=i,e[9]=c,e[10]=a,e[11]=s,e[12]=d,e[13]=l):l=e[13];let b;e[14]===Symbol.for("react.memo_cache_sentinel")?(b=t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"h-2 w-2 rounded-sm bg-green-500/70"}),"success"]}),e[14]=b):b=e[14];let x;e[15]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"h-2 w-2 rounded-sm bg-red-500/70"}),"error"]}),e[15]=x):x=e[15];let E;e[16]===Symbol.for("react.memo_cache_sentinel")?(E=t.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-muted-foreground",children:[b,x,t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx("span",{className:"h-2 w-2 rounded-sm bg-orange-500/70"}),"interrupted"]})]}),e[16]=E):E=e[16];let S;return e[17]!==j||e[18]!==l?(S=t.jsxs("div",{className:"space-y-1.5",children:[j,l,E]}),e[17]=j,e[18]=l,e[19]=S):S=e[19],S}),Ie=u.memo(function(r){const e=z.c(8),{id:s,now:i}=r;let a;const c=String(s);let m;e[0]!==c?(m={id:c},e[0]=c,e[1]=m):m=e[1],a=m;const g=a;let N;e[2]!==s||e[3]!==i?(N=T=>{const{data:R,reload:h,isRefetching:j}=T;if(!R.found||!R.summary)return t.jsx("div",{className:"text-sm text-muted-foreground",children:"Task not found."});const d=R.summary,l=R.errors??we,b=R.history,x=b?.startTimesMs??[],E=b?.durationsMs??[],S=b?.outcomeCodes??[],y=x.length,P=Math.max(0,y-X),A=Math.max(0,y-Re),D=[];for(let w=y-1;w>=P;w--){const $=x[w],L=E[w],F=Number(S[w]??M.EMPTY);D.push(t.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto_auto] items-center gap-x-3 gap-y-1 text-xs tabular-nums",children:[t.jsx("div",{className:"truncate text-muted-foreground",children:$?new Date($).toLocaleString():"—"}),t.jsx("div",{className:"text-right",children:B(L)}),t.jsx("div",{className:"flex justify-end",children:t.jsx(Oe,{code:F})})]},$??w))}const C=d.totalRuns>0?Math.round(d.totalSuccess/d.totalRuns*100):0;return t.jsxs("div",{className:"space-y-4 text-sm",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsxs("div",{className:"text-xs text-muted-foreground",children:["details for ",t.jsxs("span",{className:"font-mono",children:["#",s]})]}),t.jsxs(I,{variant:"outline",size:"sm",onClick:h,disabled:!h||!!j,className:"h-7 px-2 text-[11px]",children:[t.jsx(_,{name:"RotateCcw",className:O("mr-1 h-3.5 w-3.5",j&&"animate-spin")}),"Reload details"]})]}),t.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[t.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Counts"}),t.jsxs("div",{className:"mt-1 space-y-0.5 text-xs tabular-nums",children:[t.jsxs("div",{children:["runs: ",d.totalRuns]}),t.jsxs("div",{children:["success: ",d.totalSuccess]}),t.jsxs("div",{children:["errors: ",d.totalErrors]}),t.jsxs("div",{children:["interrupts: ",d.totalInterrupts]}),t.jsxs("div",{className:"text-muted-foreground",children:["success rate: ",C,"%"]})]}),t.jsx("div",{className:"mt-2 h-1.5 overflow-hidden rounded bg-muted",children:t.jsx("div",{className:"h-full bg-green-500/60",style:{width:`${Math.max(0,Math.min(100,C))}%`},"aria-hidden":"true"})})]}),t.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Last activity"}),t.jsxs("div",{className:"mt-1 space-y-0.5 text-xs tabular-nums",children:[t.jsxs("div",{children:["last end: ",Q(i,d.lastRunEndMs)]}),t.jsxs("div",{children:["duration: ",B(d.lastRunDurationMs)]}),t.jsxs("div",{children:["last outcome: ",re(d.lastOutcome)]})]})]}),t.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"History window"}),t.jsxs("div",{className:"mt-1 space-y-0.5 text-xs",children:[t.jsxs("div",{className:"text-muted-foreground",children:["since: ",R.sinceMs?new Date(R.sinceMs).toLocaleString():"—"]}),t.jsxs("div",{className:"text-muted-foreground",children:["showing: last ",Math.min(X,y)]})]})]})]}),y>0?t.jsx($e,{startTimesMs:x,durationsMs:E,outcomeCodes:S,from:A,to:y}):null,t.jsxs("div",{children:[t.jsx("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Recent distinct errors"}),l.length===0?t.jsx("div",{className:"text-sm text-muted-foreground",children:"No recorded errors."}):t.jsx("div",{className:"space-y-2",children:l.map(w=>t.jsxs("details",{className:"rounded-md border bg-background/40 p-2",children:[t.jsxs("summary",{className:"cursor-pointer select-none text-sm",children:[t.jsx("span",{className:"font-mono",children:w.throwableClass}),w.message?t.jsxs("span",{className:"text-muted-foreground",children:[" — ",w.message]}):null,t.jsxs("span",{className:"text-muted-foreground",children:[" (x",w.count,")"]})]}),t.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between gap-2",children:[t.jsxs("div",{className:"text-[11px] text-muted-foreground tabular-nums",children:["first: ",Q(i,w.firstSeenAtMs)," • last: ",Q(i,w.lastSeenAtMs)]}),t.jsx(Ue,{text:w.stackTrace??"",label:"Copy stack"})]}),t.jsx("pre",{className:"mt-2 max-h-64 overflow-auto whitespace-pre-wrap wrap-break-word text-xs",children:w.stackTrace})]},`${w.fingerprint}-${w.firstSeenAtMs}`))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:["Recent runs (last ",Math.min(X,y),")"]}),y===0?t.jsx("div",{className:"text-sm text-muted-foreground",children:"No history."}):t.jsx("div",{className:"space-y-1",children:D})]})]})},e[2]=s,e[3]=i,e[4]=N):N=e[4];const v=N;let f;return e[5]!==g||e[6]!==v?(f=t.jsx("div",{className:"mt-2 rounded-md border bg-muted/20 px-3 py-2.5",children:t.jsx(oe,{endpoint:me,args:g,children:v})}),e[5]=g,e[6]=v,e[7]=f):f=e[7],f}),Pe=u.memo(function(r){const e=z.c(68),{task:s,health:i,now:a,open:c,onToggleOpen:m}=r,g=`task-details-${s.id}`,N=`task-row-${s.id}`;let v;e[0]!==m||e[1]!==s.id?(v=()=>{m(s.id)},e[0]=m,e[1]=s.id,e[2]=v):v=e[2];const f=v,T=(s.lastOutcome===M.ERROR||s.lastOutcome===M.INTERRUPTED)&&!!(s.lastErrorClass||s.lastErrorMessage);let R;e[3]!==a||e[4]!==s.currentRunStartMs||e[5]!==s.running?(R=s.running&&a&&s.currentRunStartMs>0?B(Math.max(0,a-s.currentRunStartMs)):void 0,e[3]=a,e[4]=s.currentRunStartMs,e[5]=s.running,e[6]=R):R=e[6];const h=R,j=T?`${s.lastErrorClass}${s.lastErrorMessage?`: ${s.lastErrorMessage}`:""}`:i.reason;let d;e[7]!==i.health||e[8]!==c?(d=O("border-l-4 transition-colors",Te(i.health),c&&"ring-1 ring-inset ring-border"),e[7]=i.health,e[8]=c,e[9]=d):d=e[9];let l;e[10]===Symbol.for("react.memo_cache_sentinel")?(l=O("flex w-full items-start gap-3 px-3 py-2 text-left","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),e[10]=l):l=e[10];const b=c&&"rotate-180";let x;e[11]!==b?(x=O("h-5 w-5 transition-transform duration-200",b),e[11]=b,e[12]=x):x=e[12];let E;e[13]!==x?(E=t.jsx("div",{className:"mt-0.5 flex h-9 w-9 shrink-0 items-center justify-center rounded-md border bg-background/50",children:t.jsx(_,{name:"ChevronDown",className:x})}),e[13]=x,e[14]=E):E=e[14];let S;e[15]!==i.health?(S=O("inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold leading-none tabular-nums",ce(i.health)),e[15]=i.health,e[16]=S):S=e[16];let y;e[17]!==i.health||e[18]!==S?(y=t.jsx("span",{className:S,children:i.health}),e[17]=i.health,e[18]=S,e[19]=y):y=e[19];let P;e[20]!==s.name?(P=t.jsx("div",{className:"min-w-0 truncate text-sm font-semibold",title:s.name,children:s.name}),e[20]=s.name,e[21]=P):P=e[21];let A;e[22]!==s.id?(A=t.jsxs("div",{className:"text-xs text-muted-foreground tabular-nums",children:["#",s.id]}),e[22]=s.id,e[23]=A):A=e[23];let D;e[24]!==h||e[25]!==s.running?(D=s.running?t.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-500/10 px-2 py-0.5 text-[11px] font-medium text-blue-700 ring-1 ring-blue-500/20 dark:text-blue-300",children:["RUNNING",h?` • ${h}`:""]}):null,e[24]=h,e[25]=s.running,e[26]=D):D=e[26];let C;e[27]!==s.consecutiveFailures?(C=s.consecutiveFailures>0?t.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-500/10 px-2 py-0.5 text-[11px] font-medium text-red-700 ring-1 ring-red-500/20 dark:text-red-300",children:["fails ",s.consecutiveFailures]}):null,e[27]=s.consecutiveFailures,e[28]=C):C=e[28];let w;e[29]!==P||e[30]!==A||e[31]!==D||e[32]!==C||e[33]!==y?(w=t.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1",children:[y,P,A,D,C]}),e[29]=P,e[30]=A,e[31]=D,e[32]=C,e[33]=y,e[34]=w):w=e[34];let $;e[35]!==s.intervalMs?($=B(s.intervalMs),e[35]=s.intervalMs,e[36]=$):$=e[36];let L;e[37]!==a||e[38]!==s.lastRunEndMs?(L=Q(a,s.lastRunEndMs),e[37]=a,e[38]=s.lastRunEndMs,e[39]=L):L=e[39];let F;e[40]!==s.lastRunDurationMs?(F=B(s.lastRunDurationMs),e[40]=s.lastRunDurationMs,e[41]=F):F=e[41];let K;e[42]!==$||e[43]!==L||e[44]!==F?(K=t.jsxs("div",{className:"mt-1 text-xs text-muted-foreground tabular-nums",children:["every ",$," • last end ",L," • dur"," ",F]}),e[42]=$,e[43]=L,e[44]=F,e[45]=K):K=e[45];let G;e[46]!==j?(G=j?t.jsx("div",{className:"mt-1 truncate text-xs text-muted-foreground",title:j,children:j}):null,e[46]=j,e[47]=G):G=e[47];let Y;e[48]!==w||e[49]!==K||e[50]!==G?(Y=t.jsxs("div",{className:"min-w-0 flex-1",children:[w,K,G]}),e[48]=w,e[49]=K,e[50]=G,e[51]=Y):Y=e[51];let H;e[52]!==c||e[53]!==g||e[54]!==Y||e[55]!==E||e[56]!==f?(H=t.jsxs("button",{type:"button",onClick:f,"aria-expanded":c,"aria-controls":g,className:l,children:[E,Y]}),e[52]=c,e[53]=g,e[54]=Y,e[55]=E,e[56]=f,e[57]=H):H=e[57];let o;e[58]!==a||e[59]!==c||e[60]!==g||e[61]!==s.id?(o=c?t.jsx("div",{id:g,className:"px-3 pb-2",children:t.jsx(Ie,{id:s.id,now:a})}):null,e[58]=a,e[59]=c,e[60]=g,e[61]=s.id,e[62]=o):o=e[62];let p;return e[63]!==N||e[64]!==H||e[65]!==o||e[66]!==d?(p=t.jsxs("div",{id:N,className:d,children:[H,o]}),e[63]=N,e[64]=H,e[65]=o,e[66]=d,e[67]=p):p=e[67],p}),Le=u.memo(function({data:r,onlyUnhealthy:e,onToggleOnlyUnhealthy:s,reload:i,isRefetching:a}){const c=Ce(Z),m=r.values??Ne,[g,N]=de(),v=g.get("openTask"),[f,T]=u.useState(""),R=u.useDeferredValue(f),[h,j]=u.useState(!1),[d,l]=u.useState(!0),[b,x]=u.useState(void 0),[E,S]=u.useState(()=>new Set),y=u.useRef(null);u.useEffect(()=>{if(!d||!i)return;let o=!1,p;return(async()=>{for(;!o;){try{await i()}finally{o||x(Date.now())}await new Promise(U=>{p=setTimeout(()=>U(),Z)})}})(),()=>{o=!0,p&&clearTimeout(p)}},[d,i]),u.useEffect(()=>{d&&x(Date.now())},[d]),u.useEffect(()=>{if(!v)return;const o=Number(v);if(!Number.isFinite(o)||!m.some(U=>U.id===o)||(S(U=>{if(U.has(o))return U;const V=new Set(U);return V.add(o),V}),y.current===o))return;y.current=o;const k=window.requestAnimationFrame(()=>{document.getElementById(`task-row-${o}`)?.scrollIntoView({block:"start",behavior:"smooth"})});return()=>window.cancelAnimationFrame(k)},[v,m]);const P=u.useCallback(()=>{i&&i(),x(Date.now())},[i]),A=u.useMemo(()=>{const o=b,p=m.map(k=>({task:k,health:ke(k,o)}));return p.sort((k,U)=>k.health.sev-U.health.sev||k.task.name.localeCompare(U.task.name)),p},[m,b]),D=u.useMemo(()=>{const o={OK:0,ERROR:0,INTERRUPTED:0,STALE:0,STUCK:0,NEVER:0};for(const p of A)o[p.health.health]+=1;return o},[A]),C=u.useMemo(()=>{const o=R.trim().toLowerCase();let p=A;return e&&(p=p.filter(k=>k.health.health!=="OK")),h&&(p=p.filter(k=>k.task.running)),o&&(p=p.filter(k=>{const U=String(k.task.id).includes(o)||`#${k.task.id}`.includes(o),V=k.task.name.toLowerCase().includes(o),q=k.health.health.toLowerCase().includes(o);return U||V||q})),p},[A,R,e,h]),w=u.useCallback(()=>{l(o=>{const p=!o;return x(p?Date.now():void 0),p})},[]),$=u.useCallback(()=>{j(o=>!o)},[]),L=u.useCallback(o=>{T(o.target.value)},[]),F=u.useCallback(()=>{T("")},[]),K=u.useCallback(o=>{S(p=>{const k=new Set(p),U=!k.has(o);return U?k.add(o):k.delete(o),N(V=>{const q=new URLSearchParams(V);return U?q.set("openTask",String(o)):q.get("openTask")===String(o)&&q.delete("openTask"),q},{replace:!0,preventScrollReset:!0}),k})},[N]),G=u.useCallback(()=>{S(new Set),N(o=>{const p=new URLSearchParams(o);return p.delete("openTask"),p},{replace:!0,preventScrollReset:!0})},[N]),Y=u.useCallback(()=>{S(()=>new Set(C.map(o=>o.task.id)))},[C]),H=E.size;return t.jsxs(ee,{className:"space-y-3",children:[t.jsxs(te,{className:"space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx(se,{className:"flex items-center gap-2 p-2",children:"Task Health"}),t.jsx("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:ye.map(o=>t.jsx(De,{health:o,count:D[o]},o))})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs(I,{variant:"outline",size:"sm",onClick:P,disabled:!i||!!a,title:"Reload tasks now",children:[t.jsx(_,{name:"RotateCcw",className:O("mr-2 h-4 w-4",a&&"animate-spin")}),"Reload"]}),t.jsxs(I,{variant:"outline",size:"sm",onClick:w,"aria-pressed":d,title:"Toggle auto-refresh",children:[t.jsx(_,{name:d?"Pause":"Play",className:"mr-2 h-4 w-4"}),"Auto ",d?"on":"off"]})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(I,{variant:"outline",size:"sm",onClick:s,"aria-pressed":e,children:e?"Show all":"Only unhealthy"}),t.jsx(I,{variant:"outline",size:"sm",onClick:$,"aria-pressed":h,children:h?"All tasks":"Running only"}),t.jsxs(I,{variant:"outline",size:"sm",onClick:Y,disabled:C.length===0,children:[t.jsx(_,{name:"ChevronDown",className:"mr-2 h-4 w-4"}),"Expand shown"]}),t.jsxs(I,{variant:"outline",size:"sm",onClick:G,disabled:H===0,children:[t.jsx(_,{name:"ChevronUp",className:"mr-2 h-4 w-4"}),"Collapse all"]})]}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["showing ",t.jsx("span",{className:"tabular-nums",children:C.length})," /"," ",t.jsx("span",{className:"tabular-nums",children:m.length}),H>0?t.jsxs(t.Fragment,{children:[" ","• expanded ",t.jsx("span",{className:"tabular-nums",children:H})]}):null]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("label",{className:"sr-only",htmlFor:"task-search",children:"Search tasks"}),t.jsx("div",{className:"flex w-full max-w-md items-center gap-2",children:t.jsxs("div",{className:"relative flex-1",children:[t.jsx(_,{name:"Search",className:"pointer-events-none absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx("input",{id:"task-search",value:f,onChange:L,placeholder:"Search by name or #id…",className:O("h-9 w-full rounded-md border bg-background px-8 text-sm","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background")}),f?t.jsx("button",{type:"button",onClick:F,className:O("absolute right-2 top-2.5 inline-flex h-4 w-4 items-center justify-center rounded","text-muted-foreground hover:text-foreground","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),"aria-label":"Clear search",title:"Clear",children:t.jsx(_,{name:"X",className:"h-4 w-4"})}):null]})}),t.jsxs("div",{className:"ml-auto hidden text-xs text-muted-foreground md:block",children:["last tick: ",b?new Date(b).toLocaleTimeString():d?"—":"paused"]})]}),t.jsx(Ae,{tick:b,refreshMs:Z,active:d&&!a,loading:a})]}),t.jsx(ne,{className:"space-y-3",children:t.jsx("div",{className:"divide-y overflow-hidden rounded-md border bg-card/40",children:C.length===0?t.jsxs("div",{className:"px-3 py-6 text-sm text-muted-foreground",children:["No tasks to show",f?" (try clearing your search)":"","."]}):C.map(({task:o,health:p})=>t.jsx(Pe,{task:o,health:p,now:c,open:E.has(o.id),onToggleOpen:K},o.id))})})]})});function qe(){const n=z.c(5),[r,e]=u.useState(!1);let s;n[0]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{e(_e)},n[0]=s):s=n[0];const i=s;let a;n[1]!==r?(a=g=>{const{data:N,reload:v,isRefetching:f}=g;return t.jsxs(t.Fragment,{children:[t.jsx(je,{}),t.jsx(Le,{data:N,onlyUnhealthy:r,onToggleOnlyUnhealthy:i,reload:v,isRefetching:f})]})},n[1]=r,n[2]=a):a=n[2];const c=a;let m;return n[3]!==c?(m=t.jsx(oe,{endpoint:ue,args:be,children:c}),n[3]=c,n[4]=m):m=n[4],m}function _e(n){return!n}export{qe as default};
