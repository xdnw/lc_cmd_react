import{r as e,j as s,d as t}from"./index-Bs_rCQt5.js";import{a as n,B as a}from"./button-BKq8Oatj.js";import{E as r}from"./bulkwrapper-Cq7hxof8.js";import{L as l,a8 as i,a9 as d}from"./loading-BvX06E4j.js";import{C as c,a as o,b as u,d as m,c as x,B as h}from"./badge-BokiBvIr.js";import"./useSuspenseQuery-C1sZuhyO.js";function g(e){const s=String(e||"").toUpperCase();return"UP"===s?"Operational":"HASISSUES"===s?"Degraded performance":"UNDERMAINTENANCE"===s?"Maintenance":"PARTIALOUTAGE"===s?"Partial outage":"MAJOROUTAGE"===s?"Major outage":s||"Unknown"}function f(e){const s=String(e||"").toUpperCase();return"UP"===s?"bg-emerald-500":"HASISSUES"===s?"bg-yellow-500":"UNDERMAINTENANCE"===s?"bg-blue-500":"PARTIALOUTAGE"===s?"bg-orange-500":"MAJOROUTAGE"===s?"bg-red-500":"bg-muted-foreground"}function p(e){const s=String(e||"").toUpperCase();return"UP"===s?"secondary":"UNDERMAINTENANCE"===s||"HASISSUES"===s||"PARTIALOUTAGE"===s?"default":"MAJOROUTAGE"===s?"destructive":"outline"}function j(e){const s=String(e||"").toUpperCase();return s.includes("MAJOR")||s.includes("OUTAGE")||s.includes("CRITICAL")?"destructive":s.includes("PARTIAL")?"default":s.includes("MINOR")?"secondary":"outline"}function v(e){if(!e)return;const s=new Date(e);return Number.isFinite(s.getTime())?s:void 0}function b(e){return e?e.toLocaleString():"—"}function N(e,s){if(!s)return"—";const t=Math.max(0,e-s);return t<1e3?"just now":t<6e4?`${Math.floor(t/1e3)}s ago`:t<36e5?`${Math.floor(t/6e4)}m ago`:`${Math.floor(t/36e5)}h ago`}function w({className:e}){return s.jsx("div",{className:n("h-4 w-full animate-pulse rounded bg-muted",e)})}function k({className:t,title:r="Service status",refreshMs:i=6e4}){var d;const k="locutus".trim()||void 0,y=e.useMemo((()=>{if(k)return`https://${k}.instatus.com/summary.json`}),[k]),[R,E]=e.useState((()=>({kind:"idle"}))),[M,S]=e.useState((()=>Date.now()));e.useEffect((()=>{const e=setInterval((()=>S(Date.now())),1e3);return()=>clearInterval(e)}),[]);const C=e.useCallback((async()=>{var e;if(!y)return;E((e=>({kind:"loading"})));const s=new AbortController,t=setTimeout((()=>s.abort()),12e3);try{const t=await fetch(y,{method:"GET",headers:{Accept:"application/json"},signal:s.signal,cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status} ${t.statusText}`);const n=await t.json();if(!(null==(e=null==n?void 0:n.page)?void 0:e.status))throw new Error("Unexpected response shape (missing page.status).");E({kind:"success",data:n,fetchedAtMs:Date.now()})}catch(n){const e=n instanceof DOMException&&"AbortError"===n.name?"Request timed out.":n instanceof Error?n.message:"Failed to load status.";E((s=>({kind:"error",message:e,fetchedAtMs:"success"===s.kind?s.fetchedAtMs:void 0})))}finally{clearTimeout(t)}}),[y]);if(e.useEffect((()=>{if(!y)return;if(C(),i<=0)return;const e=setInterval((()=>{C()}),i);return()=>clearInterval(e)}),[y,i,C]),!k)return s.jsxs(c,{className:n("border-destructive/40 bg-destructive/5",t),children:[s.jsxs(o,{children:[s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx("span",{className:"inline-flex h-2 w-2 rounded-full bg-destructive","aria-hidden":"true"}),r]}),s.jsx(m,{children:"Configuration required"})]}),s.jsx(x,{className:"space-y-2 text-sm",children:s.jsxs("div",{className:"rounded-md border border-destructive/20 bg-background/50 p-3",children:[s.jsx("div",{className:"font-semibold",children:"Missing `process.env.instatus`"}),s.jsxs("div",{className:"mt-1 text-muted-foreground",children:["Set your Instatus subdomain (e.g. ",s.jsx("span",{className:"font-mono",children:'"acme"'}),") so this component can fetch:",s.jsx("div",{className:"mt-1 font-mono text-xs text-foreground/90",children:"https://acme.instatus.com/summary.json"})]})]})})]});const T="success"===R.kind||"error"===R.kind?R.fetchedAtMs:void 0,A="loading"===R.kind||"idle"===R.kind,U="success"===R.kind?R.data:void 0,$=(null==(d=null==U?void 0:U.page)?void 0:d.status)??"UNKNOWN",O=(null==U?void 0:U.activeIncidents)??[],D=(null==U?void 0:U.activeMaintenances)??[],I=O.length>0||D.length>0;return s.jsxs(c,{className:n(t),children:[s.jsxs(o,{className:"space-y-2",children:[s.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsxs(u,{className:"flex items-center gap-2",children:[s.jsx("span",{className:n("inline-flex h-2.5 w-2.5 rounded-full",f($)),"aria-hidden":"true"}),r,s.jsx(h,{variant:p($),className:"ml-2",children:g($)})]}),s.jsxs(m,{className:"mt-1",children:["Source:"," ",s.jsxs("a",{href:`https://${k}.instatus.com`,className:"underline underline-offset-4",target:"_blank",rel:"noreferrer",children:[k,".instatus.com"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(a,{variant:"outline",size:"sm",onClick:C,disabled:"loading"===R.kind,children:[s.jsx(l,{name:"RotateCcw",className:n("mr-2 h-4 w-4","loading"===R.kind&&"animate-spin")}),"Refresh"]}),s.jsx(a,{asChild:!0,variant:"outline",size:"sm",children:s.jsxs("a",{href:y,target:"_blank",rel:"noreferrer",children:[s.jsx(l,{name:"ExternalLink",className:"mr-2 h-4 w-4"}),"JSON"]})})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-muted-foreground",children:[s.jsxs("div",{className:"tabular-nums",children:[T?`Updated ${N(M,T)}`:"Not updated yet",T?` • ${new Date(T).toLocaleTimeString()}`:""]}),"error"===R.kind?s.jsxs("div",{className:"text-destructive",children:["Couldn’t refresh: ",R.message]}):null]})]}),s.jsxs(x,{className:"space-y-4",children:[A?s.jsxs("div",{className:"space-y-2",children:[s.jsx(w,{className:"w-2/3"}),s.jsx(w,{className:"w-1/2"}),s.jsx(w,{className:"w-4/5"})]}):null,A||"success"!==R.kind?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n("rounded-md border p-3 text-sm",I?"bg-muted/10":"bg-emerald-500/5"),children:[s.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:s.jsx("div",{className:"min-w-0",children:s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("div",{className:"font-medium truncate",children:R.data.page.name})})})}),s.jsx("div",{className:"mt-1",children:I?s.jsx("div",{className:"text-muted-foreground",children:s.jsxs("div",{className:"flex items-center gap-2",children:[O.length>0&&s.jsxs("span",{className:"tabular-nums font-mono",children:[O.length," incident",O.length>1?"s":""]}),O.length>0&&D.length>0&&s.jsx("span",{children:"•"}),D.length>0&&s.jsxs("span",{className:"tabular-nums font-mono",children:[D.length," maintenance",D.length>1?"s":""]}),s.jsx("span",{className:"ml-2 text-xs",children:"There are active incidents and/or maintenance items."})]})}):s.jsx("div",{className:"text-muted-foreground",children:"No incidents or maintenance are currently reported."})})]}),D.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-semibold",children:"Active maintenance"}),s.jsx(h,{variant:"secondary",children:D.length})]}),s.jsx("div",{className:"space-y-2",children:D.map((e=>{const t=v(e.start);return s.jsx("div",{className:"rounded-md border bg-background/40 p-3",children:s.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"truncate font-medium",children:e.name}),s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Start: ",b(t)," • Status:"," ",s.jsx("span",{className:"font-mono",children:String(e.status)}),e.duration?` • Duration: ${e.duration}m`:""]})]}),e.url?s.jsx(a,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:s.jsx("a",{href:e.url,target:"_blank",rel:"noreferrer",children:"Details"})}):null]})},`${e.url??e.name}-${e.start}`)}))})]}):null,O.length>0&&D.length>0?s.jsx("hr",{className:"my-2 border-t border-gray-200 w-full"}):null,O.length>0?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-sm font-semibold",children:"Active incidents"}),s.jsx(h,{variant:"secondary",children:O.length})]}),s.jsx("div",{className:"space-y-2",children:O.map((e=>{const t=v(e.started);return s.jsx("div",{className:"rounded-md border bg-background/40 p-3",children:s.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("div",{className:"truncate font-medium",children:e.name}),e.impact?s.jsx(h,{variant:j(e.impact),className:"font-mono text-[11px]",children:String(e.impact)}):null,s.jsx(h,{variant:"outline",className:"font-mono text-[11px]",children:String(e.status)})]}),s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Started: ",b(t)]})]}),e.url?s.jsx(a,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:s.jsx("a",{href:e.url,target:"_blank",rel:"noreferrer",children:"Details"})}):null]})},`${e.url??e.name}-${e.started}`)}))})]}):null]}),A||"error"!==R.kind?null:s.jsxs("div",{className:"rounded-md border border-destructive/30 bg-destructive/5 p-3 text-sm",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsx("div",{className:"font-semibold",children:"Couldn’t load status"}),s.jsx(a,{variant:"outline",size:"sm",onClick:C,className:"h-7 px-2 text-xs",children:"Try again"})]}),s.jsxs("div",{className:"mt-1 text-muted-foreground",children:[R.message,s.jsx("div",{className:"mt-2 font-mono text-xs text-foreground/80 break-all",children:y})]})]})]})]})}const y=0,R=1,E=2,M=3,S=Object.freeze({}),C=[],T=[],A=1e4,U=["ERROR","STUCK","INTERRUPTED","STALE","NEVER","OK"];function $(e){return void 0===e||e<0?"—":e<1e3?`${e}ms`:e<6e4?`${(e/1e3).toFixed(2)}s`:e<36e5?`${(e/6e4).toFixed(1)}m`:`${(e/36e5).toFixed(1)}h`}function O(e,s){return e?!s||s<=0?"never":`${$(Math.max(0,e-s))} ago`:"—"}function D(e){switch(e){case R:return"SUCCESS";case E:return"ERROR";case M:return"INTERRUPTED";default:return"NEVER"}}function I(e){switch(e){case R:return"bg-green-500/10 text-green-700 dark:text-green-300 ring-1 ring-green-500/20";case E:return"bg-red-500/10 text-red-700 dark:text-red-300 ring-1 ring-red-500/20";case M:return"bg-orange-500/10 text-orange-700 dark:text-orange-300 ring-1 ring-orange-500/20";default:return"bg-muted text-muted-foreground ring-1 ring-border"}}function L(e){switch(e){case R:return"bg-green-500/70";case E:return"bg-red-500/70";case M:return"bg-orange-500/70";default:return"bg-muted-foreground/30"}}function P(e,s){if(e.totalRuns<=0||e.lastOutcome===y)return{health:"NEVER",sev:4};const t=Math.max(1,e.intervalMs);if(s&&e.running&&e.currentRunStartMs>0){const n=s-e.currentRunStartMs;if(n>Math.max(5*t,6e4))return{health:"STUCK",reason:`running for ${$(n)}`,sev:0}}if(e.lastOutcome===E)return{health:"ERROR",reason:e.lastErrorMessage??void 0,sev:1};if(e.lastOutcome===M)return{health:"INTERRUPTED",reason:"interrupted",sev:2};if(s&&e.lastRunEndMs>0){const n=s-e.lastRunEndMs;if(n>Math.max(3*t,6e4))return{health:"STALE",reason:`last end ${$(n)} ago`,sev:3}}return{health:"OK",sev:10}}function F(e){switch(e){case"OK":return"bg-green-500/10 text-green-700 dark:text-green-300 ring-1 ring-green-500/20";case"STALE":return"bg-yellow-500/10 text-yellow-700 dark:text-yellow-300 ring-1 ring-yellow-500/20";case"INTERRUPTED":return"bg-orange-500/10 text-orange-700 dark:text-orange-300 ring-1 ring-orange-500/20";case"ERROR":return"bg-red-500/10 text-red-700 dark:text-red-300 ring-1 ring-red-500/20";case"STUCK":return"bg-purple-500/10 text-purple-700 dark:text-purple-300 ring-1 ring-purple-500/20";default:return"bg-muted text-muted-foreground ring-1 ring-border"}}function z(e){switch(e){case"ERROR":return"border-l-red-500/60 bg-red-500/5 hover:bg-red-500/10";case"STUCK":return"border-l-purple-500/60 bg-purple-500/5 hover:bg-purple-500/10";case"INTERRUPTED":return"border-l-orange-500/60 bg-orange-500/5 hover:bg-orange-500/10";case"STALE":return"border-l-yellow-500/60 bg-yellow-500/5 hover:bg-yellow-500/10";case"NEVER":return"border-l-muted bg-muted/10 hover:bg-muted/20";default:return"border-l-transparent hover:bg-muted/30"}}const K=e.memo((function({tick:t,refreshMs:a,active:r=!0,loading:l=!1}){const{progress:i,remainingMs:d}=function(s,t){const[n,a]=e.useState(void 0);if(e.useEffect((()=>{const e=()=>a(Date.now());e();const s=setInterval(e,200);return()=>clearInterval(s)}),[]),!t||!n||s<=0)return{progress:0,remainingMs:void 0};const r=Math.max(0,Math.min(s,n-t));return{progress:r/s,remainingMs:s-r}}(a,t),c=!r,o=l?"loading...":void 0===d?c?t?"—":"paused":"—":`${Math.max(0,Math.ceil(d/1e3))}s`,u=c?"bg-red-500/70":"bg-primary/60";return s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx("div",{className:"h-1.5 flex-1 overflow-hidden rounded bg-muted",children:s.jsx("div",{className:n("h-full transition-[width] duration-150",u),style:{width:`${Math.round(100*i)}%`}})}),s.jsx("span",{className:"tabular-nums",children:o})]})})),G=e.memo((function({code:e}){return s.jsx("span",{className:n("inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium leading-none tabular-nums",I(e)),children:D(e)})})),B=e.memo((function({health:e,count:t}){return s.jsxs("span",{className:n("inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold leading-none tabular-nums",F(e)),title:`${e}: ${t}`,children:[e,s.jsx("span",{className:"text-[11px] font-medium opacity-80",children:t})]})})),V=e.memo((function({text:t,label:n="Copy"}){const r=e.useCallback((e=>{e.preventDefault(),e.stopPropagation();const s=t??"";s&&(async()=>{var e;try{if("undefined"!=typeof navigator&&(null==(e=navigator.clipboard)?void 0:e.writeText))return void(await navigator.clipboard.writeText(s))}catch{}try{"undefined"!=typeof window&&window.prompt("Copy to clipboard:",s)}catch{}})()}),[t]);return s.jsxs(a,{variant:"outline",size:"sm",onClick:r,className:"h-7 px-2 text-[11px]",children:[s.jsx(l,{name:"Copy",className:"mr-1 h-3.5 w-3.5"}),n]})})),H=e.memo((function({startTimesMs:t,durationsMs:a,outcomeCodes:r,from:l,to:i}){const d=Math.max(0,i-l),c=e.useMemo((()=>{let e=0;for(let s=l;s<i;s++)e=Math.max(e,Number(a[s]??0));return e}),[a,l,i]);if(d<=0)return null;const o=c||1;return s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[s.jsx("div",{className:"font-medium",children:"Recent run durations"}),s.jsxs("div",{className:"tabular-nums",children:["max ",$(c)]})]}),s.jsx("div",{className:"flex h-12 items-end gap-0.5 rounded-md border bg-background/40 p-1",children:Array.from({length:d}).map(((e,i)=>{const d=l+i,c=Number(t[d]??0),u=Math.max(0,Number(a[d]??0)),m=Number(r[d]??y),x=Math.max(6,Math.round(u/o*100)),h=`${c?new Date(c).toLocaleString():"—"} • ${$(u)} • ${D(m)}`;return s.jsx("div",{className:n("flex-1 rounded-sm",L(m)),style:{height:`${x}%`},title:h},c||d)}))}),s.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-muted-foreground",children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx("span",{className:"h-2 w-2 rounded-sm bg-green-500/70"}),"success"]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx("span",{className:"h-2 w-2 rounded-sm bg-red-500/70"}),"error"]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx("span",{className:"h-2 w-2 rounded-sm bg-orange-500/70"}),"interrupted"]})]})]})})),_=e.memo((function({id:t,now:i}){const c=e.useMemo((()=>({id:String(t)})),[t]),o=e.useCallback((({data:e,reload:r,isRefetching:d})=>{if(!e.found||!e.summary)return s.jsx("div",{className:"text-sm text-muted-foreground",children:"Task not found."});const c=e.summary,o=e.errors??T,u=e.history,m=(null==u?void 0:u.startTimesMs)??[],x=(null==u?void 0:u.durationsMs)??[],h=(null==u?void 0:u.outcomeCodes)??[],g=m.length,f=Math.max(0,g-25),p=Math.max(0,g-1024),j=[];for(let t=g-1;t>=f;t--){const e=m[t],n=x[t],a=Number(h[t]??y);j.push(s.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto_auto] items-center gap-x-3 gap-y-1 text-xs tabular-nums",children:[s.jsx("div",{className:"truncate text-muted-foreground",children:e?new Date(e).toLocaleString():"—"}),s.jsx("div",{className:"text-right",children:$(n)}),s.jsx("div",{className:"flex justify-end",children:s.jsx(G,{code:a})})]},e??t))}const v=c.totalRuns>0?Math.round(c.totalSuccess/c.totalRuns*100):0;return s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsxs("div",{className:"text-xs text-muted-foreground",children:["details for ",s.jsxs("span",{className:"font-mono",children:["#",t]})]}),s.jsxs(a,{variant:"outline",size:"sm",onClick:r,disabled:!r||Boolean(d),className:"h-7 px-2 text-[11px]",children:[s.jsx(l,{name:"RotateCcw",className:n("mr-1 h-3.5 w-3.5",d&&"animate-spin")}),"Reload details"]})]}),s.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[s.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[s.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Counts"}),s.jsxs("div",{className:"mt-1 space-y-0.5 text-xs tabular-nums",children:[s.jsxs("div",{children:["runs: ",c.totalRuns]}),s.jsxs("div",{children:["success: ",c.totalSuccess]}),s.jsxs("div",{children:["errors: ",c.totalErrors]}),s.jsxs("div",{children:["interrupts: ",c.totalInterrupts]}),s.jsxs("div",{className:"text-muted-foreground",children:["success rate: ",v,"%"]})]}),s.jsx("div",{className:"mt-2 h-1.5 overflow-hidden rounded bg-muted",children:s.jsx("div",{className:"h-full bg-green-500/60",style:{width:`${Math.max(0,Math.min(100,v))}%`},"aria-hidden":"true"})})]}),s.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[s.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Last activity"}),s.jsxs("div",{className:"mt-1 space-y-0.5 text-xs tabular-nums",children:[s.jsxs("div",{children:["last end: ",O(i,c.lastRunEndMs)]}),s.jsxs("div",{children:["duration: ",$(c.lastRunDurationMs)]}),s.jsxs("div",{children:["last outcome: ",D(c.lastOutcome)]})]})]}),s.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[s.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"History window"}),s.jsxs("div",{className:"mt-1 space-y-0.5 text-xs",children:[s.jsxs("div",{className:"text-muted-foreground",children:["since: ",e.sinceMs?new Date(e.sinceMs).toLocaleString():"—"]}),s.jsxs("div",{className:"text-muted-foreground",children:["showing: last ",Math.min(25,g)]})]})]})]}),g>0?s.jsx(H,{startTimesMs:m,durationsMs:x,outcomeCodes:h,from:p,to:g}):null,s.jsxs("div",{children:[s.jsx("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Recent distinct errors"}),0===o.length?s.jsx("div",{className:"text-sm text-muted-foreground",children:"No recorded errors."}):s.jsx("div",{className:"space-y-2",children:o.map((e=>s.jsxs("details",{className:"rounded-md border bg-background/40 p-2",children:[s.jsxs("summary",{className:"cursor-pointer select-none text-sm",children:[s.jsx("span",{className:"font-mono",children:e.throwableClass}),e.message?s.jsxs("span",{className:"text-muted-foreground",children:[" — ",e.message]}):null,s.jsxs("span",{className:"text-muted-foreground",children:[" (x",e.count,")"]})]}),s.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between gap-2",children:[s.jsxs("div",{className:"text-[11px] text-muted-foreground tabular-nums",children:["first: ",O(i,e.firstSeenAtMs)," • last: ",O(i,e.lastSeenAtMs)]}),s.jsx(V,{text:e.stackTrace??"",label:"Copy stack"})]}),s.jsx("pre",{className:"mt-2 max-h-64 overflow-auto whitespace-pre-wrap break-words text-xs",children:e.stackTrace})]},`${e.fingerprint}-${e.firstSeenAtMs}`)))})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:["Recent runs (last ",Math.min(25,g),")"]}),0===g?s.jsx("div",{className:"text-sm text-muted-foreground",children:"No history."}):s.jsx("div",{className:"space-y-1",children:j})]})]})}),[t,i]);return s.jsx("div",{className:"mt-2 rounded-md border bg-muted/20 px-3 py-2.5",children:s.jsx(r,{endpoint:d,args:c,children:o})})})),J=e.memo((function({task:t,health:a,now:r,open:i,onToggleOpen:d}){const c=`task-details-${t.id}`,o=`task-row-${t.id}`,u=e.useCallback((()=>{d(t.id)}),[d,t.id]),m=(t.lastOutcome===E||t.lastOutcome===M)&&Boolean(t.lastErrorClass||t.lastErrorMessage),x=t.running&&r&&t.currentRunStartMs>0?$(Math.max(0,r-t.currentRunStartMs)):void 0,h=m?`${t.lastErrorClass}${t.lastErrorMessage?`: ${t.lastErrorMessage}`:""}`:a.reason;return s.jsxs("div",{id:o,className:n("border-l-4 transition-colors",z(a.health),i&&"ring-1 ring-inset ring-border"),children:[s.jsxs("button",{type:"button",onClick:u,"aria-expanded":i,"aria-controls":c,className:n("flex w-full items-start gap-3 px-3 py-2 text-left","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),children:[s.jsx("div",{className:"mt-0.5 flex h-9 w-9 shrink-0 items-center justify-center rounded-md border bg-background/50",children:s.jsx(l,{name:"ChevronDown",className:n("h-5 w-5 transition-transform duration-200",i&&"rotate-180")})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1",children:[s.jsx("span",{className:n("inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold leading-none tabular-nums",F(a.health)),children:a.health}),s.jsx("div",{className:"min-w-0 truncate text-sm font-semibold",title:t.name,children:t.name}),s.jsxs("div",{className:"text-xs text-muted-foreground tabular-nums",children:["#",t.id]}),t.running?s.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-500/10 px-2 py-0.5 text-[11px] font-medium text-blue-700 ring-1 ring-blue-500/20 dark:text-blue-300",children:["RUNNING",x?` • ${x}`:""]}):null,t.consecutiveFailures>0?s.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-500/10 px-2 py-0.5 text-[11px] font-medium text-red-700 ring-1 ring-red-500/20 dark:text-red-300",children:["fails ",t.consecutiveFailures]}):null]}),s.jsxs("div",{className:"mt-1 text-xs text-muted-foreground tabular-nums",children:["every ",$(t.intervalMs)," • last end ",O(r,t.lastRunEndMs)," • dur"," ",$(t.lastRunDurationMs)]}),h?s.jsx("div",{className:"mt-1 truncate text-xs text-muted-foreground",title:h,children:h}):null]})]}),i?s.jsx("div",{id:c,className:"px-3 pb-2",children:s.jsx(_,{id:t.id,now:r})}):null]})})),q=e.memo((function({data:r,onlyUnhealthy:i,onToggleOnlyUnhealthy:d,reload:m,isRefetching:h}){const g=function(s){const[t,n]=e.useState(void 0);return e.useEffect((()=>{const e=()=>n(Date.now());e();const t=setInterval(e,s);return()=>clearInterval(t)}),[s]),t}(A),f=r.values??C,[p,j]=t(),v=p.get("openTask"),[b,N]=e.useState(""),w=e.useDeferredValue(b),[k,y]=e.useState(!1),[R,E]=e.useState(!0),[M,S]=e.useState(void 0),[T,$]=e.useState((()=>new Set)),O=e.useRef(null);e.useEffect((()=>{if(!R||!m)return;let e,s=!1;return(async()=>{for(;!s;){try{await m()}finally{s||S(Date.now())}await new Promise((s=>{e=setTimeout((()=>s()),A)}))}})(),()=>{s=!0,e&&clearTimeout(e)}}),[R,m]),e.useEffect((()=>{R&&S(Date.now())}),[]),e.useEffect((()=>{if(!v)return;const e=Number(v);if(!Number.isFinite(e))return;if(!f.some((s=>s.id===e)))return;if($((s=>{if(s.has(e))return s;const t=new Set(s);return t.add(e),t})),O.current===e)return;O.current=e;const s=window.requestAnimationFrame((()=>{var s;null==(s=document.getElementById(`task-row-${e}`))||s.scrollIntoView({block:"start",behavior:"smooth"})}));return()=>window.cancelAnimationFrame(s)}),[v,f]);const D=e.useCallback((()=>{m&&m(),S(Date.now())}),[m]),I=e.useMemo((()=>{const e=M,s=f.map((s=>({task:s,health:P(s,e)})));return s.sort(((e,s)=>e.health.sev-s.health.sev||e.task.name.localeCompare(s.task.name))),s}),[f,M]),L=e.useMemo((()=>{const e={OK:0,ERROR:0,INTERRUPTED:0,STALE:0,STUCK:0,NEVER:0};for(const s of I)e[s.health.health]+=1;return e}),[I]),F=e.useMemo((()=>{const e=w.trim().toLowerCase();let s=I;return i&&(s=s.filter((e=>"OK"!==e.health.health))),k&&(s=s.filter((e=>e.task.running))),e&&(s=s.filter((s=>{const t=String(s.task.id).includes(e)||`#${s.task.id}`.includes(e),n=s.task.name.toLowerCase().includes(e),a=s.health.health.toLowerCase().includes(e);return t||n||a}))),s}),[I,w,i,k]),z=e.useCallback((()=>{E((e=>{const s=!e;return S(s?Date.now():void 0),s}))}),[]),G=e.useCallback((()=>{y((e=>!e))}),[]),V=e.useCallback((e=>{N(e.target.value)}),[]),H=e.useCallback((()=>{N("")}),[]),_=e.useCallback((e=>{$((s=>{const t=new Set(s),n=!t.has(e);return n?t.add(e):t.delete(e),j((s=>{const t=new URLSearchParams(s);return n?t.set("openTask",String(e)):t.get("openTask")===String(e)&&t.delete("openTask"),t}),{replace:!0,preventScrollReset:!0}),t}))}),[j]),q=e.useCallback((()=>{$(new Set),j((e=>{const s=new URLSearchParams(e);return s.delete("openTask"),s}),{replace:!0,preventScrollReset:!0})}),[j]),Q=e.useCallback((()=>{$((()=>new Set(F.map((e=>e.task.id)))))}),[F]),W=T.size;return s.jsxs(c,{className:"space-y-3",children:[s.jsxs(o,{className:"space-y-2",children:[s.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[s.jsxs("div",{children:[s.jsx(u,{className:"flex items-center gap-2 p-2",children:"Task Health"}),s.jsx("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:U.map((e=>s.jsx(B,{health:e,count:L[e]},e)))})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs(a,{variant:"outline",size:"sm",onClick:D,disabled:!m||Boolean(h),title:"Reload tasks now",children:[s.jsx(l,{name:"RotateCcw",className:n("mr-2 h-4 w-4",h&&"animate-spin")}),"Reload"]}),s.jsxs(a,{variant:"outline",size:"sm",onClick:z,"aria-pressed":R,title:"Toggle auto-refresh",children:[s.jsx(l,{name:R?"Pause":"Play",className:"mr-2 h-4 w-4"}),"Auto ",R?"on":"off"]})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx(a,{variant:"outline",size:"sm",onClick:d,"aria-pressed":i,children:i?"Show all":"Only unhealthy"}),s.jsx(a,{variant:"outline",size:"sm",onClick:G,"aria-pressed":k,children:k?"All tasks":"Running only"}),s.jsxs(a,{variant:"outline",size:"sm",onClick:Q,disabled:0===F.length,children:[s.jsx(l,{name:"ChevronDown",className:"mr-2 h-4 w-4"}),"Expand shown"]}),s.jsxs(a,{variant:"outline",size:"sm",onClick:q,disabled:0===W,children:[s.jsx(l,{name:"ChevronUp",className:"mr-2 h-4 w-4"}),"Collapse all"]})]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["showing ",s.jsx("span",{className:"tabular-nums",children:F.length})," /"," ",s.jsx("span",{className:"tabular-nums",children:f.length}),W>0?s.jsxs(s.Fragment,{children:[" ","• expanded ",s.jsx("span",{className:"tabular-nums",children:W})]}):null]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("label",{className:"sr-only",htmlFor:"task-search",children:"Search tasks"}),s.jsx("div",{className:"flex w-full max-w-md items-center gap-2",children:s.jsxs("div",{className:"relative flex-1",children:[s.jsx(l,{name:"Search",className:"pointer-events-none absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),s.jsx("input",{id:"task-search",value:b,onChange:V,placeholder:"Search by name or #id…",className:n("h-9 w-full rounded-md border bg-background px-8 text-sm","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background")}),b?s.jsx("button",{type:"button",onClick:H,className:n("absolute right-2 top-2.5 inline-flex h-4 w-4 items-center justify-center rounded","text-muted-foreground hover:text-foreground","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),"aria-label":"Clear search",title:"Clear",children:s.jsx(l,{name:"X",className:"h-4 w-4"})}):null]})}),s.jsxs("div",{className:"ml-auto hidden text-xs text-muted-foreground md:block",children:["last tick: ",M?new Date(M).toLocaleTimeString():R?"—":"paused"]})]}),s.jsx(K,{tick:M,refreshMs:A,active:R&&!h,loading:h})]}),s.jsx(x,{className:"space-y-3",children:s.jsx("div",{className:"divide-y overflow-hidden rounded-md border bg-card/40",children:0===F.length?s.jsxs("div",{className:"px-3 py-6 text-sm text-muted-foreground",children:["No tasks to show",b?" (try clearing your search)":"","."]}):F.map((({task:e,health:t})=>s.jsx(J,{task:e,health:t,now:g,open:T.has(e.id),onToggleOpen:_},e.id)))})})]})}));function Q(){const[t,n]=e.useState(!1),a=e.useCallback((()=>{n((e=>!e))}),[]),l=e.useCallback((({data:e,reload:n,isRefetching:r})=>s.jsxs(s.Fragment,{children:[s.jsx(k,{}),s.jsx(q,{data:e,onlyUnhealthy:t,onToggleOnlyUnhealthy:a,reload:n,isRefetching:r})]})),[t,a]);return s.jsx(r,{endpoint:i,args:S,children:l})}export{Q as default};
