import{j as e,r as s,d as t}from"./index-C3E2-SUH.js";import{a as n,B as r}from"./button-DCZsNPnk.js";import{E as a}from"./bulkwrapper-CffFvLGh.js";import{L as i,a7 as l,a8 as d}from"./queries-BuM6HYrb.js";import{C as c,a as o,b as u,d as m,c as x}from"./card-CumT0SDG.js";import"./useSuspenseQuery-DiLOpIi1.js";import"./loading-CI11-4Uh.js";function h({variant:s="default",className:t,children:r}){let a="bg-slate-100 text-slate-800";return"secondary"===s?a="bg-gray-100 text-gray-800":"destructive"===s?a="bg-red-50 text-red-700":"outline"===s&&(a="border border-gray-200 bg-transparent text-gray-700"),e.jsx("span",{className:n("inline-flex items-center rounded px-2 py-0.5 text-xs font-medium",a,t),children:r})}function g(e){const s=String(e||"").toUpperCase();return"UP"===s?"Operational":"HASISSUES"===s?"Degraded performance":"UNDERMAINTENANCE"===s?"Maintenance":"PARTIALOUTAGE"===s?"Partial outage":"MAJOROUTAGE"===s?"Major outage":s||"Unknown"}function f(e){const s=String(e||"").toUpperCase();return"UP"===s?"bg-emerald-500":"HASISSUES"===s?"bg-yellow-500":"UNDERMAINTENANCE"===s?"bg-blue-500":"PARTIALOUTAGE"===s?"bg-orange-500":"MAJOROUTAGE"===s?"bg-red-500":"bg-muted-foreground"}function p(e){const s=String(e||"").toUpperCase();return"UP"===s?"secondary":"UNDERMAINTENANCE"===s||"HASISSUES"===s||"PARTIALOUTAGE"===s?"default":"MAJOROUTAGE"===s?"destructive":"outline"}function j(e){const s=String(e||"").toUpperCase();return s.includes("MAJOR")||s.includes("OUTAGE")||s.includes("CRITICAL")?"destructive":s.includes("PARTIAL")?"default":s.includes("MINOR")?"secondary":"outline"}function v(e){if(!e)return;const s=new Date(e);return Number.isFinite(s.getTime())?s:void 0}function b(e){return e?e.toLocaleString():"—"}function N(e,s){if(!s)return"—";const t=Math.max(0,e-s);return t<1e3?"just now":t<6e4?`${Math.floor(t/1e3)}s ago`:t<36e5?`${Math.floor(t/6e4)}m ago`:`${Math.floor(t/36e5)}h ago`}function w({className:s}){return e.jsx("div",{className:n("h-4 w-full animate-pulse rounded bg-muted",s)})}function y({className:t,title:a="Service status",refreshMs:l=6e4}){var d;const y="locutus".trim()||void 0,k=s.useMemo((()=>{if(y)return`https://${y}.instatus.com/summary.json`}),[y]),[R,E]=s.useState((()=>({kind:"idle"}))),[M,S]=s.useState((()=>Date.now()));s.useEffect((()=>{const e=setInterval((()=>S(Date.now())),1e3);return()=>clearInterval(e)}),[]);const C=s.useCallback((async()=>{var e;if(!k)return;E((e=>({kind:"loading"})));const s=new AbortController,t=setTimeout((()=>s.abort()),12e3);try{const t=await fetch(k,{method:"GET",headers:{Accept:"application/json"},signal:s.signal,cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status} ${t.statusText}`);const n=await t.json();if(!(null==(e=null==n?void 0:n.page)?void 0:e.status))throw new Error("Unexpected response shape (missing page.status).");E({kind:"success",data:n,fetchedAtMs:Date.now()})}catch(n){const e=n instanceof DOMException&&"AbortError"===n.name?"Request timed out.":n instanceof Error?n.message:"Failed to load status.";E((s=>({kind:"error",message:e,fetchedAtMs:"success"===s.kind?s.fetchedAtMs:void 0})))}finally{clearTimeout(t)}}),[k]);if(s.useEffect((()=>{if(!k)return;if(C(),l<=0)return;const e=setInterval((()=>{C()}),l);return()=>clearInterval(e)}),[k,l,C]),!y)return e.jsxs(c,{className:n("border-destructive/40 bg-destructive/5",t),children:[e.jsxs(o,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-2 w-2 rounded-full bg-destructive","aria-hidden":"true"}),a]}),e.jsx(m,{children:"Configuration required"})]}),e.jsx(x,{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"rounded-md border border-destructive/20 bg-background/50 p-3",children:[e.jsx("div",{className:"font-semibold",children:"Missing `process.env.instatus`"}),e.jsxs("div",{className:"mt-1 text-muted-foreground",children:["Set your Instatus subdomain (e.g. ",e.jsx("span",{className:"font-mono",children:'"acme"'}),") so this component can fetch:",e.jsx("div",{className:"mt-1 font-mono text-xs text-foreground/90",children:"https://acme.instatus.com/summary.json"})]})]})})]});const T="success"===R.kind||"error"===R.kind?R.fetchedAtMs:void 0,A="loading"===R.kind||"idle"===R.kind,U="success"===R.kind?R.data:void 0,$=(null==(d=null==U?void 0:U.page)?void 0:d.status)??"UNKNOWN",O=(null==U?void 0:U.activeIncidents)??[],D=(null==U?void 0:U.activeMaintenances)??[],I=O.length>0||D.length>0;return e.jsxs(c,{className:n(t),children:[e.jsxs(o,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx("span",{className:n("inline-flex h-2.5 w-2.5 rounded-full",f($)),"aria-hidden":"true"}),a,e.jsx(h,{variant:p($),className:"ml-2",children:g($)})]}),e.jsxs(m,{className:"mt-1",children:["Source:"," ",e.jsxs("a",{href:`https://${y}.instatus.com`,className:"underline underline-offset-4",target:"_blank",rel:"noreferrer",children:[y,".instatus.com"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:C,disabled:"loading"===R.kind,children:[e.jsx(i,{name:"RotateCcw",className:n("mr-2 h-4 w-4","loading"===R.kind&&"animate-spin")}),"Refresh"]}),e.jsx(r,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs("a",{href:k,target:"_blank",rel:"noreferrer",children:[e.jsx(i,{name:"ExternalLink",className:"mr-2 h-4 w-4"}),"JSON"]})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"tabular-nums",children:[T?`Updated ${N(M,T)}`:"Not updated yet",T?` • ${new Date(T).toLocaleTimeString()}`:""]}),"error"===R.kind?e.jsxs("div",{className:"text-destructive",children:["Couldn’t refresh: ",R.message]}):null]})]}),e.jsxs(x,{className:"space-y-4",children:[A?e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"w-2/3"}),e.jsx(w,{className:"w-1/2"}),e.jsx(w,{className:"w-4/5"})]}):null,A||"success"!==R.kind?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n("rounded-md border p-3 text-sm",I?"bg-muted/10":"bg-emerald-500/5"),children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-2",children:e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"font-medium truncate",children:R.data.page.name})})})}),e.jsx("div",{className:"mt-1",children:I?e.jsx("div",{className:"text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[O.length>0&&e.jsxs("span",{className:"tabular-nums font-mono",children:[O.length," incident",O.length>1?"s":""]}),O.length>0&&D.length>0&&e.jsx("span",{children:"•"}),D.length>0&&e.jsxs("span",{className:"tabular-nums font-mono",children:[D.length," maintenance",D.length>1?"s":""]}),e.jsx("span",{className:"ml-2 text-xs",children:"There are active incidents and/or maintenance items."})]})}):e.jsx("div",{className:"text-muted-foreground",children:"No incidents or maintenance are currently reported."})})]}),D.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Active maintenance"}),e.jsx(h,{variant:"secondary",children:D.length})]}),e.jsx("div",{className:"space-y-2",children:D.map((s=>{const t=v(s.start);return e.jsx("div",{className:"rounded-md border bg-background/40 p-3",children:e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate font-medium",children:s.name}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Start: ",b(t)," • Status:"," ",e.jsx("span",{className:"font-mono",children:String(s.status)}),s.duration?` • Duration: ${s.duration}m`:""]})]}),s.url?e.jsx(r,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:"Details"})}):null]})},`${s.url??s.name}-${s.start}`)}))})]}):null,O.length>0&&D.length>0?e.jsx("hr",{className:"my-2 border-t border-gray-200 w-full"}):null,O.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Active incidents"}),e.jsx(h,{variant:"secondary",children:O.length})]}),e.jsx("div",{className:"space-y-2",children:O.map((s=>{const t=v(s.started);return e.jsx("div",{className:"rounded-md border bg-background/40 p-3",children:e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"truncate font-medium",children:s.name}),s.impact?e.jsx(h,{variant:j(s.impact),className:"font-mono text-[11px]",children:String(s.impact)}):null,e.jsx(h,{variant:"outline",className:"font-mono text-[11px]",children:String(s.status)})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Started: ",b(t)]})]}),s.url?e.jsx(r,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs",children:e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:"Details"})}):null]})},`${s.url??s.name}-${s.started}`)}))})]}):null]}),A||"error"!==R.kind?null:e.jsxs("div",{className:"rounded-md border border-destructive/30 bg-destructive/5 p-3 text-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"font-semibold",children:"Couldn’t load status"}),e.jsx(r,{variant:"outline",size:"sm",onClick:C,className:"h-7 px-2 text-xs",children:"Try again"})]}),e.jsxs("div",{className:"mt-1 text-muted-foreground",children:[R.message,e.jsx("div",{className:"mt-2 font-mono text-xs text-foreground/80 break-all",children:k})]})]})]})]})}const k=0,R=1,E=2,M=3,S=Object.freeze({}),C=[],T=[],A=1e4,U=["ERROR","STUCK","INTERRUPTED","STALE","NEVER","OK"];function $(e){return void 0===e||e<0?"—":e<1e3?`${e}ms`:e<6e4?`${(e/1e3).toFixed(2)}s`:e<36e5?`${(e/6e4).toFixed(1)}m`:`${(e/36e5).toFixed(1)}h`}function O(e,s){return e?!s||s<=0?"never":`${$(Math.max(0,e-s))} ago`:"—"}function D(e){switch(e){case R:return"SUCCESS";case E:return"ERROR";case M:return"INTERRUPTED";default:return"NEVER"}}function I(e){switch(e){case R:return"bg-green-500/10 text-green-700 dark:text-green-300 ring-1 ring-green-500/20";case E:return"bg-red-500/10 text-red-700 dark:text-red-300 ring-1 ring-red-500/20";case M:return"bg-orange-500/10 text-orange-700 dark:text-orange-300 ring-1 ring-orange-500/20";default:return"bg-muted text-muted-foreground ring-1 ring-border"}}function L(e){switch(e){case R:return"bg-green-500/70";case E:return"bg-red-500/70";case M:return"bg-orange-500/70";default:return"bg-muted-foreground/30"}}function P(e,s){if(e.totalRuns<=0||e.lastOutcome===k)return{health:"NEVER",sev:4};const t=Math.max(1,e.intervalMs);if(s&&e.running&&e.currentRunStartMs>0){const n=s-e.currentRunStartMs;if(n>Math.max(5*t,6e4))return{health:"STUCK",reason:`running for ${$(n)}`,sev:0}}if(e.lastOutcome===E)return{health:"ERROR",reason:e.lastErrorMessage??void 0,sev:1};if(e.lastOutcome===M)return{health:"INTERRUPTED",reason:"interrupted",sev:2};if(s&&e.lastRunEndMs>0){const n=s-e.lastRunEndMs;if(n>Math.max(3*t,6e4))return{health:"STALE",reason:`last end ${$(n)} ago`,sev:3}}return{health:"OK",sev:10}}function F(e){switch(e){case"OK":return"bg-green-500/10 text-green-700 dark:text-green-300 ring-1 ring-green-500/20";case"STALE":return"bg-yellow-500/10 text-yellow-700 dark:text-yellow-300 ring-1 ring-yellow-500/20";case"INTERRUPTED":return"bg-orange-500/10 text-orange-700 dark:text-orange-300 ring-1 ring-orange-500/20";case"ERROR":return"bg-red-500/10 text-red-700 dark:text-red-300 ring-1 ring-red-500/20";case"STUCK":return"bg-purple-500/10 text-purple-700 dark:text-purple-300 ring-1 ring-purple-500/20";default:return"bg-muted text-muted-foreground ring-1 ring-border"}}function z(e){switch(e){case"ERROR":return"border-l-red-500/60 bg-red-500/5 hover:bg-red-500/10";case"STUCK":return"border-l-purple-500/60 bg-purple-500/5 hover:bg-purple-500/10";case"INTERRUPTED":return"border-l-orange-500/60 bg-orange-500/5 hover:bg-orange-500/10";case"STALE":return"border-l-yellow-500/60 bg-yellow-500/5 hover:bg-yellow-500/10";case"NEVER":return"border-l-muted bg-muted/10 hover:bg-muted/20";default:return"border-l-transparent hover:bg-muted/30"}}const K=s.memo((function({tick:t,refreshMs:r,active:a=!0,loading:i=!1}){const{progress:l,remainingMs:d}=function(e,t){const[n,r]=s.useState(void 0);if(s.useEffect((()=>{const e=()=>r(Date.now());e();const s=setInterval(e,200);return()=>clearInterval(s)}),[]),!t||!n||e<=0)return{progress:0,remainingMs:void 0};const a=Math.max(0,Math.min(e,n-t));return{progress:a/e,remainingMs:e-a}}(r,t),c=!a,o=i?"loading...":void 0===d?c?t?"—":"paused":"—":`${Math.max(0,Math.ceil(d/1e3))}s`,u=c?"bg-red-500/70":"bg-primary/60";return e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("div",{className:"h-1.5 flex-1 overflow-hidden rounded bg-muted",children:e.jsx("div",{className:n("h-full transition-[width] duration-150",u),style:{width:`${Math.round(100*l)}%`}})}),e.jsx("span",{className:"tabular-nums",children:o})]})})),G=s.memo((function({code:s}){return e.jsx("span",{className:n("inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium leading-none tabular-nums",I(s)),children:D(s)})})),H=s.memo((function({health:s,count:t}){return e.jsxs("span",{className:n("inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold leading-none tabular-nums",F(s)),title:`${s}: ${t}`,children:[s,e.jsx("span",{className:"text-[11px] font-medium opacity-80",children:t})]})})),V=s.memo((function({text:t,label:n="Copy"}){const a=s.useCallback((e=>{e.preventDefault(),e.stopPropagation();const s=t??"";s&&(async()=>{var e;try{if("undefined"!=typeof navigator&&(null==(e=navigator.clipboard)?void 0:e.writeText))return void(await navigator.clipboard.writeText(s))}catch{}try{"undefined"!=typeof window&&window.prompt("Copy to clipboard:",s)}catch{}})()}),[t]);return e.jsxs(r,{variant:"outline",size:"sm",onClick:a,className:"h-7 px-2 text-[11px]",children:[e.jsx(i,{name:"Copy",className:"mr-1 h-3.5 w-3.5"}),n]})})),B=s.memo((function({startTimesMs:t,durationsMs:r,outcomeCodes:a,from:i,to:l}){const d=Math.max(0,l-i),c=s.useMemo((()=>{let e=0;for(let s=i;s<l;s++)e=Math.max(e,Number(r[s]??0));return e}),[r,i,l]);if(d<=0)return null;const o=c||1;return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"font-medium",children:"Recent run durations"}),e.jsxs("div",{className:"tabular-nums",children:["max ",$(c)]})]}),e.jsx("div",{className:"flex h-12 items-end gap-0.5 rounded-md border bg-background/40 p-1",children:Array.from({length:d}).map(((s,l)=>{const d=i+l,c=Number(t[d]??0),u=Math.max(0,Number(r[d]??0)),m=Number(a[d]??k),x=Math.max(6,Math.round(u/o*100)),h=`${c?new Date(c).toLocaleString():"—"} • ${$(u)} • ${D(m)}`;return e.jsx("div",{className:n("flex-1 rounded-sm",L(m)),style:{height:`${x}%`},title:h},c||d)}))}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-sm bg-green-500/70"}),"success"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-sm bg-red-500/70"}),"error"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-sm bg-orange-500/70"}),"interrupted"]})]})]})})),_=s.memo((function({id:t,now:l}){const c=s.useMemo((()=>({id:String(t)})),[t]),o=s.useCallback((({data:s,reload:a,isRefetching:d})=>{if(!s.found||!s.summary)return e.jsx("div",{className:"text-sm text-muted-foreground",children:"Task not found."});const c=s.summary,o=s.errors??T,u=s.history,m=(null==u?void 0:u.startTimesMs)??[],x=(null==u?void 0:u.durationsMs)??[],h=(null==u?void 0:u.outcomeCodes)??[],g=m.length,f=Math.max(0,g-25),p=Math.max(0,g-1024),j=[];for(let t=g-1;t>=f;t--){const s=m[t],n=x[t],r=Number(h[t]??k);j.push(e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto_auto] items-center gap-x-3 gap-y-1 text-xs tabular-nums",children:[e.jsx("div",{className:"truncate text-muted-foreground",children:s?new Date(s).toLocaleString():"—"}),e.jsx("div",{className:"text-right",children:$(n)}),e.jsx("div",{className:"flex justify-end",children:e.jsx(G,{code:r})})]},s??t))}const v=c.totalRuns>0?Math.round(c.totalSuccess/c.totalRuns*100):0;return e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["details for ",e.jsxs("span",{className:"font-mono",children:["#",t]})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:a,disabled:!a||Boolean(d),className:"h-7 px-2 text-[11px]",children:[e.jsx(i,{name:"RotateCcw",className:n("mr-1 h-3.5 w-3.5",d&&"animate-spin")}),"Reload details"]})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Counts"}),e.jsxs("div",{className:"mt-1 space-y-0.5 text-xs tabular-nums",children:[e.jsxs("div",{children:["runs: ",c.totalRuns]}),e.jsxs("div",{children:["success: ",c.totalSuccess]}),e.jsxs("div",{children:["errors: ",c.totalErrors]}),e.jsxs("div",{children:["interrupts: ",c.totalInterrupts]}),e.jsxs("div",{className:"text-muted-foreground",children:["success rate: ",v,"%"]})]}),e.jsx("div",{className:"mt-2 h-1.5 overflow-hidden rounded bg-muted",children:e.jsx("div",{className:"h-full bg-green-500/60",style:{width:`${Math.max(0,Math.min(100,v))}%`},"aria-hidden":"true"})})]}),e.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Last activity"}),e.jsxs("div",{className:"mt-1 space-y-0.5 text-xs tabular-nums",children:[e.jsxs("div",{children:["last end: ",O(l,c.lastRunEndMs)]}),e.jsxs("div",{children:["duration: ",$(c.lastRunDurationMs)]}),e.jsxs("div",{children:["last outcome: ",D(c.lastOutcome)]})]})]}),e.jsxs("div",{className:"rounded-md border bg-background/40 p-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"History window"}),e.jsxs("div",{className:"mt-1 space-y-0.5 text-xs",children:[e.jsxs("div",{className:"text-muted-foreground",children:["since: ",s.sinceMs?new Date(s.sinceMs).toLocaleString():"—"]}),e.jsxs("div",{className:"text-muted-foreground",children:["showing: last ",Math.min(25,g)]})]})]})]}),g>0?e.jsx(B,{startTimesMs:m,durationsMs:x,outcomeCodes:h,from:p,to:g}):null,e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Recent distinct errors"}),0===o.length?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No recorded errors."}):e.jsx("div",{className:"space-y-2",children:o.map((s=>e.jsxs("details",{className:"rounded-md border bg-background/40 p-2",children:[e.jsxs("summary",{className:"cursor-pointer select-none text-sm",children:[e.jsx("span",{className:"font-mono",children:s.throwableClass}),s.message?e.jsxs("span",{className:"text-muted-foreground",children:[" — ",s.message]}):null,e.jsxs("span",{className:"text-muted-foreground",children:[" (x",s.count,")"]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-[11px] text-muted-foreground tabular-nums",children:["first: ",O(l,s.firstSeenAtMs)," • last: ",O(l,s.lastSeenAtMs)]}),e.jsx(V,{text:s.stackTrace??"",label:"Copy stack"})]}),e.jsx("pre",{className:"mt-2 max-h-64 overflow-auto whitespace-pre-wrap break-words text-xs",children:s.stackTrace})]},`${s.fingerprint}-${s.firstSeenAtMs}`)))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:["Recent runs (last ",Math.min(25,g),")"]}),0===g?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No history."}):e.jsx("div",{className:"space-y-1",children:j})]})]})}),[t,l]);return e.jsx("div",{className:"mt-2 rounded-md border bg-muted/20 px-3 py-2.5",children:e.jsx(a,{endpoint:d,args:c,children:o})})})),J=s.memo((function({task:t,health:r,now:a,open:l,onToggleOpen:d}){const c=`task-details-${t.id}`,o=`task-row-${t.id}`,u=s.useCallback((()=>{d(t.id)}),[d,t.id]),m=(t.lastOutcome===E||t.lastOutcome===M)&&Boolean(t.lastErrorClass||t.lastErrorMessage),x=t.running&&a&&t.currentRunStartMs>0?$(Math.max(0,a-t.currentRunStartMs)):void 0,h=m?`${t.lastErrorClass}${t.lastErrorMessage?`: ${t.lastErrorMessage}`:""}`:r.reason;return e.jsxs("div",{id:o,className:n("border-l-4 transition-colors",z(r.health),l&&"ring-1 ring-inset ring-border"),children:[e.jsxs("button",{type:"button",onClick:u,"aria-expanded":l,"aria-controls":c,className:n("flex w-full items-start gap-3 px-3 py-2 text-left","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),children:[e.jsx("div",{className:"mt-0.5 flex h-9 w-9 shrink-0 items-center justify-center rounded-md border bg-background/50",children:e.jsx(i,{name:"ChevronDown",className:n("h-5 w-5 transition-transform duration-200",l&&"rotate-180")})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1",children:[e.jsx("span",{className:n("inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold leading-none tabular-nums",F(r.health)),children:r.health}),e.jsx("div",{className:"min-w-0 truncate text-sm font-semibold",title:t.name,children:t.name}),e.jsxs("div",{className:"text-xs text-muted-foreground tabular-nums",children:["#",t.id]}),t.running?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-500/10 px-2 py-0.5 text-[11px] font-medium text-blue-700 ring-1 ring-blue-500/20 dark:text-blue-300",children:["RUNNING",x?` • ${x}`:""]}):null,t.consecutiveFailures>0?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-500/10 px-2 py-0.5 text-[11px] font-medium text-red-700 ring-1 ring-red-500/20 dark:text-red-300",children:["fails ",t.consecutiveFailures]}):null]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground tabular-nums",children:["every ",$(t.intervalMs)," • last end ",O(a,t.lastRunEndMs)," • dur"," ",$(t.lastRunDurationMs)]}),h?e.jsx("div",{className:"mt-1 truncate text-xs text-muted-foreground",title:h,children:h}):null]})]}),l?e.jsx("div",{id:c,className:"px-3 pb-2",children:e.jsx(_,{id:t.id,now:a})}):null]})})),q=s.memo((function({data:a,onlyUnhealthy:l,onToggleOnlyUnhealthy:d,reload:m,isRefetching:h}){const g=function(e){const[t,n]=s.useState(void 0);return s.useEffect((()=>{const s=()=>n(Date.now());s();const t=setInterval(s,e);return()=>clearInterval(t)}),[e]),t}(A),f=a.values??C,[p,j]=t(),v=p.get("openTask"),[b,N]=s.useState(""),w=s.useDeferredValue(b),[y,k]=s.useState(!1),[R,E]=s.useState(!0),[M,S]=s.useState(void 0),[T,$]=s.useState((()=>new Set)),O=s.useRef(null);s.useEffect((()=>{if(!R||!m)return;let e,s=!1;return(async()=>{for(;!s;){try{await m()}finally{s||S(Date.now())}await new Promise((s=>{e=setTimeout((()=>s()),A)}))}})(),()=>{s=!0,e&&clearTimeout(e)}}),[R,m]),s.useEffect((()=>{R&&S(Date.now())}),[]),s.useEffect((()=>{if(!v)return;const e=Number(v);if(!Number.isFinite(e))return;if(!f.some((s=>s.id===e)))return;if($((s=>{if(s.has(e))return s;const t=new Set(s);return t.add(e),t})),O.current===e)return;O.current=e;const s=window.requestAnimationFrame((()=>{var s;null==(s=document.getElementById(`task-row-${e}`))||s.scrollIntoView({block:"start",behavior:"smooth"})}));return()=>window.cancelAnimationFrame(s)}),[v,f]);const D=s.useCallback((()=>{m&&m(),S(Date.now())}),[m]),I=s.useMemo((()=>{const e=M,s=f.map((s=>({task:s,health:P(s,e)})));return s.sort(((e,s)=>e.health.sev-s.health.sev||e.task.name.localeCompare(s.task.name))),s}),[f,M]),L=s.useMemo((()=>{const e={OK:0,ERROR:0,INTERRUPTED:0,STALE:0,STUCK:0,NEVER:0};for(const s of I)e[s.health.health]+=1;return e}),[I]),F=s.useMemo((()=>{const e=w.trim().toLowerCase();let s=I;return l&&(s=s.filter((e=>"OK"!==e.health.health))),y&&(s=s.filter((e=>e.task.running))),e&&(s=s.filter((s=>{const t=String(s.task.id).includes(e)||`#${s.task.id}`.includes(e),n=s.task.name.toLowerCase().includes(e),r=s.health.health.toLowerCase().includes(e);return t||n||r}))),s}),[I,w,l,y]),z=s.useCallback((()=>{E((e=>{const s=!e;return S(s?Date.now():void 0),s}))}),[]),G=s.useCallback((()=>{k((e=>!e))}),[]),V=s.useCallback((e=>{N(e.target.value)}),[]),B=s.useCallback((()=>{N("")}),[]),_=s.useCallback((e=>{$((s=>{const t=new Set(s),n=!t.has(e);return n?t.add(e):t.delete(e),j((s=>{const t=new URLSearchParams(s);return n?t.set("openTask",String(e)):t.get("openTask")===String(e)&&t.delete("openTask"),t}),{replace:!0,preventScrollReset:!0}),t}))}),[j]),q=s.useCallback((()=>{$(new Set),j((e=>{const s=new URLSearchParams(e);return s.delete("openTask"),s}),{replace:!0,preventScrollReset:!0})}),[j]),Q=s.useCallback((()=>{$((()=>new Set(F.map((e=>e.task.id)))))}),[F]),W=T.size;return e.jsxs(c,{className:"space-y-3",children:[e.jsxs(o,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(u,{className:"flex items-center gap-2 p-2",children:"Task Health"}),e.jsx("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:U.map((s=>e.jsx(H,{health:s,count:L[s]},s)))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:D,disabled:!m||Boolean(h),title:"Reload tasks now",children:[e.jsx(i,{name:"RotateCcw",className:n("mr-2 h-4 w-4",h&&"animate-spin")}),"Reload"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:z,"aria-pressed":R,title:"Toggle auto-refresh",children:[e.jsx(i,{name:R?"Pause":"Play",className:"mr-2 h-4 w-4"}),"Auto ",R?"on":"off"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:d,"aria-pressed":l,children:l?"Show all":"Only unhealthy"}),e.jsx(r,{variant:"outline",size:"sm",onClick:G,"aria-pressed":y,children:y?"All tasks":"Running only"}),e.jsxs(r,{variant:"outline",size:"sm",onClick:Q,disabled:0===F.length,children:[e.jsx(i,{name:"ChevronDown",className:"mr-2 h-4 w-4"}),"Expand shown"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:q,disabled:0===W,children:[e.jsx(i,{name:"ChevronUp",className:"mr-2 h-4 w-4"}),"Collapse all"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["showing ",e.jsx("span",{className:"tabular-nums",children:F.length})," /"," ",e.jsx("span",{className:"tabular-nums",children:f.length}),W>0?e.jsxs(e.Fragment,{children:[" ","• expanded ",e.jsx("span",{className:"tabular-nums",children:W})]}):null]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"sr-only",htmlFor:"task-search",children:"Search tasks"}),e.jsx("div",{className:"flex w-full max-w-md items-center gap-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(i,{name:"Search",className:"pointer-events-none absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{id:"task-search",value:b,onChange:V,placeholder:"Search by name or #id…",className:n("h-9 w-full rounded-md border bg-background px-8 text-sm","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background")}),b?e.jsx("button",{type:"button",onClick:B,className:n("absolute right-2 top-2.5 inline-flex h-4 w-4 items-center justify-center rounded","text-muted-foreground hover:text-foreground","outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background"),"aria-label":"Clear search",title:"Clear",children:e.jsx(i,{name:"X",className:"h-4 w-4"})}):null]})}),e.jsxs("div",{className:"ml-auto hidden text-xs text-muted-foreground md:block",children:["last tick: ",M?new Date(M).toLocaleTimeString():R?"—":"paused"]})]}),e.jsx(K,{tick:M,refreshMs:A,active:R&&!h,loading:h})]}),e.jsx(x,{className:"space-y-3",children:e.jsx("div",{className:"divide-y overflow-hidden rounded-md border bg-card/40",children:0===F.length?e.jsxs("div",{className:"px-3 py-6 text-sm text-muted-foreground",children:["No tasks to show",b?" (try clearing your search)":"","."]}):F.map((({task:s,health:t})=>e.jsx(J,{task:s,health:t,now:g,open:T.has(s.id),onToggleOpen:_},s.id)))})})]})}));function Q(){const[t,n]=s.useState(!1),r=s.useCallback((()=>{n((e=>!e))}),[]),i=s.useCallback((({data:s,reload:n,isRefetching:a})=>e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(q,{data:s,onlyUnhealthy:t,onToggleOnlyUnhealthy:r,reload:n,isRefetching:a})]})),[t,r]);return e.jsx(a,{endpoint:l,args:S,children:i})}export{Q as default};
