const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SimpleChart-B07JoOv1.js","assets/index-Ci-lVsFi.js","assets/queries-l4D1Q0nU.js","assets/command-utils-BU29VnaS.js","assets/command-meta-J_rOZp3J.js","assets/dropdown-menu-DLcaEqVB.js","assets/button-CWqPuK0O.js","assets/theme-provider-CM04Ee5i.js","assets/DialogContext-ByDpcWnk.js","assets/index-nDc9YPi0.css","assets/SanitizedHtml-BMTh0adl.js"])))=>i.map(i=>d[i]);
import{C as S,p as w,c as j,h as P,f as K,a as O,i as G,b as z,S as U,j as H}from"./command-utils-BU29VnaS.js";import{COMMANDS as M}from"./command-meta-J_rOZp3J.js";import{r as x,_ as $,j as C,L as V}from"./index-Ci-lVsFi.js";const W={DBAlliance:{selections:{All:"*","All (>0 active member)":'*,#countNations("#position>1,#vm_turns=0,#active_m<10080")>0',"Top 10":"*,#rank<=10","Top 15":"*,#rank<=15","Top 25":"*,#rank<=25","Top 50":"*,#rank<=50","Guild Alliances":"%guild_alliances%"},columns:{General:{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getcolor",alias:"Color"}).add({cmd:"countnations",args:{filter:"#position>1"},alias:"Members"}).shorten().build2d(),sort:{idx:2,dir:"desc"}},Militarization:{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"Tank%"}).add({cmd:"getmetricat",args:{metric:"AIRCRAFT_PCT"},alias:"Air%"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"1d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"2d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"5d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"10d"}).add({cmd:"getmilitarizationgraph",args:{start:"60d"},alias:"Militarization"}).shorten().build2d(),sort:{idx:3,dir:"desc"}},Revenue:{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getrevenueconverted",alias:"Total"}).addMultipleRaw(M.options.ResourceType.options.filter(e=>e!=="CREDITS").map(e=>[`{revenue.${e}}`,e])).shorten().build2d(),sort:{idx:1,dir:"desc"}},"City Growth (30d)":{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getmembershipchangesbyreason",args:{reasons:"recruited,joined",start:"30d",end:"0d"},alias:"Joined"}).add({cmd:"getmembershipchangesbyreason",args:{reasons:"left",start:"30d",end:"0d"},alias:"Left"}).add({cmd:"getnetmembersacquired",args:{start:"30d",end:"0d"},alias:"Net"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"joined",assets:"cities",start:"30d",end:"0d"},alias:"Poached City"}).add({cmd:"getmembershipchangeassetvalue",args:{reasons:"joined",assets:"cities",start:"30d",end:"0d"},alias:"Poached City $"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"recruited",assets:"cities",start:"30d",end:"0d"},alias:"Recruited City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"left",assets:"cities",start:"30d",end:"0d"},alias:"Left City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"vm_returned",assets:"cities",start:"30d",end:"0d"},alias:"VM Ended City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"vm_left",assets:"cities",start:"30d",end:"0d"},alias:"VM City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"deleted",assets:"cities",start:"30d",end:"0d"},alias:"Deleted City"}).add({cmd:"getboughtassetcount",args:{assets:"cities",start:"30d",end:"0d"},alias:"City Buy"}).add({cmd:"geteffectiveboughtassetcount",args:{assets:"cities",start:"30d",end:"0d"},alias:"City Buy (remain)"}).add({cmd:"getspendingvalue",args:{assets:"cities",start:"30d",end:"0d"},alias:"City Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"cities",start:"30d",end:"0d"},alias:"City Buy $ (remain)"}).add({cmd:"getnetasset",args:{asset:"cities",start:"30d",end:"0d"},alias:"Net City"}).add({cmd:"getnetassetvalue",args:{asset:"cities",start:"30d",end:"0d"},alias:"Net City $"}).shorten().build2d(),sort:{idx:17,dir:"desc"}},"Growth (30d)":{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"getnetmembersacquired",args:{start:"30d",end:"0d"},alias:"Net Member"}).add({cmd:"getnetasset",args:{asset:"cities",start:"30d",end:"0d"},alias:"Net City"}).add({cmd:"getnetassetvalue",args:{asset:"cities",start:"30d",end:"0d"},alias:"Net City $"}).add({cmd:"getnetassetvalue",args:{asset:"projects",start:"30d",end:"0d"},alias:"Net Project $"}).add({cmd:"getnetassetvalue",args:{asset:"land",start:"30d",end:"0d"},alias:"Net Land $"}).add({cmd:"getnetassetvalue",args:{asset:"infra",start:"30d",end:"0d"},alias:"Net Infra $"}).add({cmd:"getnetassetvalue",args:{asset:"*",start:"30d",end:"0d"},alias:"Net Asset $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"cities",start:"30d",end:"0d"},alias:"City Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"projects",start:"30d",end:"0d"},alias:"Project Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"land",start:"30d",end:"0d"},alias:"Land Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"infra",start:"30d",end:"0d"},alias:"Infra Buy-Loss $"}).add({cmd:"getcumulativerevenuevalue",args:{start:"30d",end:"0d"},alias:"Total Revenue"}).shorten().build2d(),sort:{idx:9,dir:"desc"}},"Normalized Growth (30d)":{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).addRaw(w({type:"DBAlliance",command:["geteffectiveboughtassetcount"],args:{assets:"cities",start:"30d",end:"0d"}})+"/{countmembers}","Cities/Member").add({cmd:"geteffectivespendingvalue",args:{assets:"cities,projects,land",start:"30d",end:"0d"},alias:"Invest/Member"}).addRaw(w({type:"DBAlliance",command:["geteffectivespendingvalue"],args:{assets:"cities,projects,land",start:"30d",end:"0d"}})+"/"+w({type:"DBAlliance",command:["getcumulativerevenuevalue"],args:{start:"30d",end:"0d"}}),"Invest/Revenue").shorten().build2d(),sort:{idx:2,dir:"desc"}},"Cumulative Revenue (30d)":{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getcumulativerevenuevalue",args:{start:"30d",end:"0d"},alias:"Value"}).addMultipleRaw(M.options.ResourceType.options.filter(e=>e!=="CREDITS").map(e=>[`{cumulativerevenue.${e}}`,e])).shorten().build2d(),sort:{idx:1,dir:"desc"}},"City Exponent":{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"exponentialcitystrength",alias:"city^3"}).add({cmd:"exponentialcitystrength",args:{power:"2.5"},alias:"city^2.5"}).shorten().build2d(),sort:{idx:5,dir:"desc"}}}},ResourceType:{selections:{All:"*",Raws:"raws",Manufactured:"manu",...Object.fromEntries(M.options.ResourceType.options.map(e=>[e,e]))},columns:{Price:{value:S.placeholders("ResourceType").array().add({cmd:"getname",alias:"Resource"}).add({cmd:"getlow",alias:"Low"}).add({cmd:"gethigh",alias:"High"}).add({cmd:"getmargin",alias:"Margin"}).shorten().build2d(),sort:{idx:0,dir:"asc"}}}},Conflict:{selections:{All:"*",Active:"*,#getActiveWars>0",Inactive:"*,#getActiveWars=0",Great:"*,#getCategory=GREAT",Major:"*,#getCategory=MAJOR",Skirmish:"*,#getCategory=SKIRMISH",Unverified:"*,#getCategory=UNVERIFIED",Generated:"*,#getCategory=GENERATED",Micro:"*,#getCategory=MICRO","Non-Micro":"*,#getCategory=NON_MICRO"},columns:{General:{value:S.placeholders("Conflict").array().add({cmd:"getid",alias:"ID"}).addRaw("[{name}]({url})","Name").add({cmd:"getcategory",alias:"Category"}).add({cmd:"getstartturn",alias:"Start"}).add({cmd:"getendturn",alias:"End"}).add({cmd:"getactivewars",alias:"Active Wars"}).add({cmd:"getdamageconverted",args:{isPrimary:"true"},alias:"c1_damage"}).add({cmd:"getdamageconverted",args:{isPrimary:"false"},alias:"c2_damage"}).shorten().build2d(),sort:{idx:0,dir:"desc"}}}},DBNation:{selections:{All:"*","Alliance Nations":"%guild_alliances%","Members (Non VM)":"%guild_alliances%,#position>1,#vm_turns=0","Active Applicant (1d)":"%guild_alliances%,#position=1,#vm_turns=0,#active_m<1440","Inactive Member >5d":"%guild_alliances%,#position>1,#vm_turns=0,#active_m>7200","Inactive Member >1w":"%guild_alliances%,#position>1,#vm_turns=0,#active_m>10080",Allies:"~allies,#position>1,#vm_turns=0,#active_m<10800","Allies (underutilized)":"~allies,#active_m<2880,#freeoffensiveslots>0,#tankpct>0.8,#aircraftpct>0.8,#RelativeStrength>1.3,#vm_turns=0,#isbeige=0",Enemies:"~enemies,#position>1,#vm_turns=0,#active_m<10800","Enemies (priority)":"~enemies,#cities>10,#active_m<2880,#def<3,#off>0,#vm_turns=0,#isbeige=0,#RelativeStrength>0.7,#fighting(~allies)","Spyable Enemies":"~enemies,#position>1,#vm_turns=0,#active_m<2880,#espionageFull=0","Lacking Spies":"%guild_alliances%,#position>1,#vm_turns=0,#getSpyCapLeft>0,#daysSinceLastSpyBuy>0","Member Not Verified":"%guild_alliances%,#position>1,#vm_turns=0,#verified=0","Member Not in Guild":"%guild_alliances%,#position>1,#vm_turns=0,#isInAllianceGuild=0","Member Not in Milcom Guild":"%guild_alliances%,#position>1,#vm_turns=0,#isInMilcomGuild=0","Low Tier, Not Raiding":"%guild_alliances%,#cities<10,#position>1,#vm_turns=0,#active_m<2880,#off<5,#color!=beige,#blockaded=0"},columns:{General:{value:S.placeholders("DBNation").array().add({cmd:"getmarkdownurl",alias:"Nation"}).add({cmd:"getallianceurlmarkup",alias:"AA"}).add({cmd:"getagedays",alias:"Age"}).add({cmd:"getcolor",alias:"Color"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getscore",alias:"Score"}).shorten().build2d(),sort:[{idx:1,dir:"desc"},{idx:5,dir:"desc"}]},MMR:{value:S.placeholders("DBNation").array().add({cmd:"getmarkdownurl",alias:"Nation"}).add({cmd:"getallianceurlmarkup",alias:"AA"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getavg_infra",alias:"Infra"}).add({cmd:"getscore",alias:"NS"}).add({cmd:"getoff",alias:"ðŸ—¡"}).add({cmd:"getdef",alias:"ðŸ›¡"}).add({cmd:"getsoldiers",alias:"ðŸ’‚"}).add({cmd:"gettanks",alias:"âš™"}).add({cmd:"getaircraft",alias:"âœˆ"}).add({cmd:"getships",alias:"â›µ"}).add({cmd:"getspies",alias:"ðŸ”Ž"}).add({cmd:"dayssincelastspybuy",alias:"$ðŸ”Ždays"}).add({cmd:"getspycap",alias:"ðŸ”Žcap"}).add({cmd:"getmmrbuildingdecimal",alias:"MMR[build]"}).add({cmd:"dayssincelastsoldierbuy",alias:"$ðŸ’‚days"}).add({cmd:"dayssincelasttankbuy",alias:"$âš™days"}).add({cmd:"dayssincelastaircraftbuy",alias:"$âœˆdays"}).add({cmd:"dayssincelastshipbuy",alias:"$â›µdays"}).shorten().build2d(),sort:[{idx:1,dir:"desc"},{idx:3,dir:"desc"}]}}}};function J({colorId:e,beigeTurns:t}){const n=x.useMemo(()=>Number.isInteger(e),[e]),[i,s]=x.useState(()=>n?"":String(e));x.useEffect(()=>{let r=!0;return n?($(async()=>{const{COMMANDS:d}=await import("./command-meta-J_rOZp3J.js");return{COMMANDS:d}},[]).then(({COMMANDS:d})=>{if(!r)return;const o=d.options.NationColor.options[e]??String(e);s(o)}).catch(()=>{r&&s(String(e))}),()=>{r=!1}):(s(String(e)),()=>{r=!1})},[e,n]);const a=i.replace("BEIGE","TAN");return C.jsx("div",{className:"w-5 h-5 border border-2 border-black flex items-center justify-center",style:{backgroundColor:a||"transparent"},title:i||String(e),children:t!==void 0&&t>0&&C.jsx("span",{className:"text-xs text-black",children:t})})}const q=x.lazy(()=>$(()=>import("./SimpleChart-B07JoOv1.js").then(e=>e.S),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Y=x.lazy(()=>$(()=>import("./SanitizedHtml-BMTh0adl.js"),__vite__mapDeps([10,1,9]))),T={money:{display:de},comma:{display:K},color:{display:ce},time:{display:ie},time_ms:{display:oe},diff_ms:{display:Z},normal:{display:re},text:void 0,json:{display:ae},graph:{display:ne,isHtml:!0},html:{display:se},duration_day:{display:ee},percent_100:{display:Q},percent:{display:X},duration_ms:{display:te},numeric_map:{display:le},turn_to_date:{display:P}};function Q(e){return e==null?"N/A":e.toFixed(2)+"%"}function X(e){if(e==null)return"N/A";try{return(e*100).toFixed(2)+"%"}catch{return"N/A2"}}function Z(e){return z(e,5)}function ee(e){if(e==null)return"N/A";const t=e*24*60*60;return t==0?"0s":O(t,3)}function te(e){if(e==null)return"N/A";const t=e/1e3;return t==0?"0s":O(t,3)}function se(e){return C.jsx(x.Suspense,{fallback:C.jsx("span",{children:e??""}),children:C.jsx(Y,{value:e??""})})}function ne(e){return C.jsx(x.Suspense,{fallback:C.jsx("span",{children:"Loading graph..."}),children:C.jsx(q,{graph:e,type:"LINE",theme:"light",hideLegend:!0,hideDots:!0,minHeight:"40px",maxHeight:"50px"})})}function re(e){if(!e)return e;e=e.toString();const t=e.indexOf("[");if(t!==0){if(e[0]==="="&&e.startsWith("=HYPERLINK(")){const d=e.indexOf(")",11),o=e.slice(11,d);if(d===e.length-1){const u=G(o,",");if(u.length===2)return`<a href="${u[0].trim().replace(/^"|"$/g,"")}">${u[1].trim().replace(/^"|"$/g,"")}</a>`}}return e}const n=e.indexOf("]",t);if(n<=t)return e;const i=e.indexOf("(",n);if(i!==n+1)return e;const s=e.indexOf(")",i);if(s!==e.length-1)return e;let a=e.slice(i+1,s);a.startsWith("<")&&a.endsWith(">")&&(a=a.slice(1,-1));const r=e.slice(t+1,n);return C.jsx(V,{to:a,children:r})}function ae(e){const t=Array.isArray(e)?e.map(n=>Number.isFinite(n)?Math.round(n*100)/100:n):Object.fromEntries(Object.entries(e).map(([n,i])=>[n,Number.isFinite(i)?Math.round(i*100)/100:i]));return JSON.stringify(t)}function D(e){if(e)if(e.startsWith("enum:")){const t=e.split(":")[1],n=S.data.options[t].options??[];return{display:i=>n[i],isEnum:!0,options:n}}else return T[e]??T.text}function ie(e){const t=new Date(e*1e3);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function oe(e){const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function de(e){return"$"+j(e)}function ce(e){return C.jsx(J,{colorId:e})}function le(e){return e?(typeof e=="string"&&(e=JSON.parse(e)),`{${Object.entries(e).map(([n,i])=>`${n}:${j(i)}`).join(",")}}`):"{}"}function ue(e){return(e?Array.isArray(e)?e:[e]:[]).map(n=>({columnKey:String(n.idx),direction:n.dir==="asc"?"ASC":"DESC"}))}const me=5e4;function ge(e,t,n,i){const s=performance.now();try{const a=[...n];if(!Array.isArray(t)||t.length===0)return;const r=new Map;a.forEach(c=>r.set(c.index,c));const d=fe(e,t,r),o=ve(t,a,r);if(o.perfectMatch)return;const u=I(i);let l;if(o.partialMatch){const c=k(t,d,r,i);l=[...e],be(l,c,o.matchedColumns)}else if(t.every(m=>{const y=d.get(Number(m.columnKey))||"mixed";return y==="number"||y==="string"||y==="boolean"})&&e.length>=me)l=Ae(e,t,d,u);else{const m=k(t,d,r,i);l=[...e],l.sort((y,g)=>_(y,g,m))}return Se(a,t,r),{data:l,columns:a}}finally{performance.now()-s}}function fe(e,t,n){const i=Math.min(100,e.length),s=new Map;if(e.length===0){for(const a of t){const r=Number(a.columnKey),d=n.get(r),o=d?.type||"mixed";s.set(r,o),d&&(d.type=o)}return s}for(const a of t){const r=Number(a.columnKey),d=n.get(r);let o=d?.type||null;if(!o){let l=!1,c=!1,m=!1,y=!1;for(let g=0;g<i;g++){const v=e[g];if(!v)break;const p=v[r];if(p==null)continue;const f=typeof p;if(f==="number"?l=!0:f==="string"?c=!0:f==="boolean"?m=!0:y=!0,(l?1:0)+(c?1:0)+(m?1:0)+(y?1:0)>1||y){o="mixed";break}}o||(l?o="number":c?o="string":m?o="boolean":o="mixed")}const u=o;s.set(r,u),d&&(d.type=u)}return s}function k(e,t,n,i){const s=I();return e.map(a=>{const r=Number(a.columnKey),d=t.get(r)||n.get(r)?.type||"mixed",o=a.direction==="ASC"?1:-1;switch(d){case"number":return{index:r,compare:F(o)};case"string":return{index:r,compare:B(o,s)};case"boolean":return{index:r,compare:L(o,s)};default:return{index:r,compare:pe(o,s)}}})}function I(e){return{nulls:"auto",nans:"auto",collator:void 0}}function R(e){return e==null||typeof e!="number"?4:Number.isNaN(e)?3:e===1/0?2:e===-1/0?1:0}const N=(()=>{const e=new Array(5).fill(0);return e[1]=0,e[2]=1,e[3]=2,e[4]=3,e})();function F(e,t){return(n,i)=>{const s=R(n),a=R(i),r=s===0;if(r!==(a===0))return r?-1:1;if(r){const o=n,u=i;return o<u?e===1?-1:1:o>u?e===1?1:-1:0}return s!==a?N[s]-N[a]:0}}function B(e,t){const n=t.nulls==="first"||t.nulls==="auto"&&e===-1,i=t.collator;return(s,a)=>{const r=s==null,d=a==null;if(r||d)return r&&d?0:r?n?-1:1:n?1:-1;const o=typeof s=="string"?s:String(s),u=typeof a=="string"?a:String(a),l=i?i.compare(o,u):o.localeCompare(u);return l!==0?e===1?l:-l:0}}function L(e,t){const n=t.nulls==="first"||t.nulls==="auto"&&e===-1;return(i,s)=>{const a=i==null,r=s==null;if(a||r)return a&&r?0:a?n?-1:1:n?1:-1;const d=!!i;return d===!!s?0:e===1?d?1:-1:d?-1:1}}function pe(e,t){const n=F(e),i=B(e,t),s=L(e,t),d=e===1?new Map([["number",0],["string",1],["boolean",2],["object",3]]):new Map([["object",0],["boolean",1],["string",2],["number",3]]);return(o,u)=>{const l=o==null,c=u==null;if(l||c){if(l&&c)return 0;const h=t.nulls==="first"||t.nulls==="auto"&&e===-1;return l?h?-1:1:h?1:-1}const m=typeof o,y=typeof u;if(m==="number"&&y==="number")return n(o,u);if(m==="string"&&y==="string")return i(o,u);if(m==="boolean"&&y==="boolean")return s(o,u);const g=d.get(m)??3,v=d.get(y)??3;if(g!==v)return g-v;const p=String(o),f=String(u);if(p===f)return 0;const b=t.collator?t.collator.compare(p,f):p.localeCompare(f);return e===1?b:-b}}function _(e,t,n){for(let i=0;i<n.length;i++){const s=n[i],a=s.compare(e[s.index],t[s.index]);if(a!==0)return a}return 0}function ye(e,t,n){for(let i=0;i<n.length;i++){const s=n[i];if(s.compare(e[s.index],t[s.index])!==0)return!1}return!0}function he(e,t,n,i){for(let s=t+1;s<n;s++){const a=e[s];let r=s-1;for(;r>=t&&_(e[r],a,i)>0;)e[r+1]=e[r],r--;e[r+1]=a}}function be(e,t,n){const i=t.slice(0,n),s=t.slice(n);if(s.length===0)return;let a=0;for(;a<e.length;){let r=a+1;for(;r<e.length&&ye(e[a],e[r],i);)r++;const d=r-a;if(d>1)if(d<=10)he(e,a,r,s);else{const o=e.slice(a,r);o.sort((u,l)=>_(u,l,s));for(let u=0;u<o.length;u++)e[a+u]=o[u]}a=r}}function ve(e,t,n){let i=0;for(let a=0;a<e.length;a++){const r=e[a],d=Number(r.columnKey),o=n.get(d),u=r.direction==="ASC"?"asc":"desc";if(!o?.sorted||o.sorted[0]!==u||o.sorted[1]!==a)break;i++}let s=!1;for(const a of t)if(a.sorted&&a.sorted[1]>=i){s=!0;break}return{perfectMatch:i===e.length&&!s,partialMatch:i>0,matchedColumns:i}}function Se(e,t,n){for(const i of e)i.sorted=void 0;t.forEach((i,s)=>{const a=Number(i.columnKey),r=n.get(a);r&&(r.sorted=[i.direction==="ASC"?"asc":"desc",s])})}function Ae(e,t,n,i){const s=e.length,a=t.length;if(s<=1||a===0)return e.slice();const r=[],d=i.collator;for(let c=0;c<a;c++){const m=t[c],y=Number(m.columnKey),g=m.direction==="ASC"?1:-1,v=n.get(y)||"mixed";if(v==="number"){const p=new Uint8Array(s),f=new Float64Array(s);for(let b=0;b<s;b++){const h=e[b][y],A=R(h);p[b]=A,f[b]=A===0?h:0}r.push({kind:"number",dir:g,codes:p,vals:f})}else if(v==="string"){const p=new Array(s),f=new Uint8Array(s),b=g===-1;for(let h=0;h<s;h++){const A=e[h][y];A==null?(f[h]=1,p[h]=""):(f[h]=0,p[h]=typeof A=="string"?A:String(A))}r.push({kind:"string",dir:g,strs:p,nulls:f,nullsFirst:b})}else if(v==="boolean"){const p=new Uint8Array(s),f=new Uint8Array(s),b=g===-1;for(let h=0;h<s;h++){const A=e[h][y];A==null?(f[h]=1,p[h]=0):(f[h]=0,p[h]=A===!0?1:0)}r.push({kind:"boolean",dir:g,bools:p,nulls:f,nullsFirst:b})}else{const p=k(t,n,new Map);return e.slice().sort((f,b)=>_(f,b,p))}}const o=new Array(s);for(let c=0;c<s;c++)o[c]=c;const u=(c,m)=>{for(let y=0;y<r.length;y++){const g=r[y];if(g.kind==="number"){const v=g.codes[c],p=g.codes[m],f=v===0;if(f!==(p===0))return f?-1:1;if(f){const h=g.vals[c],A=g.vals[m];if(h<A)return g.dir===1?-1:1;if(h>A)return g.dir===1?1:-1}else if(v!==p)return N[v]-N[p]}else if(g.kind==="string"){const v=g.nulls[c]===1,p=g.nulls[m]===1;if(v||p){if(v&&p)continue;return v?g.nullsFirst?-1:1:g.nullsFirst?1:-1}const f=g.strs[c],b=g.strs[m],h=d?d.compare(f,b):f.localeCompare(b);if(h!==0)return g.dir===1?h:-h}else{const v=g.nulls[c]===1,p=g.nulls[m]===1;if(v||p){if(v&&p)continue;return v?g.nullsFirst?-1:1:g.nullsFirst?1:-1}const f=g.bools[c],b=g.bools[m];if(f!==b)return g.dir===1?f-b:b-f}}return c-m};o.sort(u);const l=new Array(s);for(let c=0;c<s;c++)l[c]=e[o[c]];return l}function ke(e,t,n,i=[],s){const a=e.errors??[],r=ue(t),d=n.size>0?Array.from(n).map(([p,f])=>f??p):e.cells[0];let o=e.cells.slice(1);const u=e.renderers,l=Array.from(n.keys());let c=d.map((p,f)=>{const b=u?D(u[f]):void 0,h=b?void 0:Ne(s,l[f]);return{title:Ce(p),index:f,render:b??h}});const m=!t||Array.isArray(t)&&t.length===0||o.length<=1?void 0:ge(o,r,c);m&&(o=m.data,c=m.columns);const y=xe(o,c,i);o=y.data,c=y.columnsInfo;const g=Array.from(Array(c.length).keys());return{errors:a,columnsInfo:c,data:o,visibleColumns:g,searchSet:new Set,sort:t}}function Re(e,t){const n=S.placeholders(e).getCommands(),i=[];for(const s of n)t&&!t(s)||s.hasRequiredArgument()||i.push([s.name,s.command.desc]);return i}function Ce(e){if(e.includes("{")){for(const t of U)e.includes("{"+t)&&(e=e.replace("{"+t,"{"));return e.replace("{","").replace("}","")}else return e}function $e(e,t,n,i){const s=t.filter(u=>u.exportable!==!1),a=s.length>0?s:t,r=a.map(u=>u.title),d=e.map(u=>a.map(l=>u[l.index])),o=[r,...d];return H(o,n,i)}function Te(e){const t=e.get("type");if(t&&t in S.data.placeholders)return t}function Ee(e,t){const n={},i=t?W[t]?.selections:void 0,s=i?.All??Object.values(i??{})[0];n[""]=e.get("sel")??s??"*";const a=new Set(["type","sel","col","sort"]);for(const[r,d]of e.entries())!a.has(r)&&r&&(n[r]=d);return n}function je(e){const t=Object.fromEntries(e.getAll("col").map(n=>{const[i,s]=n.split(";");return[i,s||null]}));return Object.keys(t).length>0?new Map(Object.entries(t)):void 0}function Oe(e){const t=e.getAll("sort").map(n=>{const[i,s]=n.split(";");return{idx:parseInt(i,10),dir:s}});return t.length>0?t:void 0}function De(e,t){const n=t[""]??"",i=Object.entries(t).filter(([s])=>s!=="").map(([s,a])=>`(${s}: ${a})`).join(" ");return i?`${e}:${n} [${i}]`:`${e}:${n}`}function Ie(e){let t;return Object.keys(e).length===1?t=e[""]:Object.keys(e).length>1&&(t=JSON.stringify(e)),t}function Fe({type:e,sel:t,selAndModifiers:n,columns:i,sort:s}){const a=new URLSearchParams;if(a.set("type",e),t)a.set("sel",t);else if(n)for(const[r,d]of Object.entries(n))d?a.append(r===""?"sel":r,d):a.set("sel",d);if(i.forEach((r,d)=>{a.append("col",r?`${d};${r}`:d)}),s)if(Array.isArray(s))for(const r of s)a.append("sort",`${r.idx};${r.dir}`);else a.append("sort",`${s.idx};${s.dir}`);return a.toString()}function xe(e,t,n){if(!n.length)return{data:e,columnsInfo:t};const i=t.length>0?Math.max(...t.map(l=>l.index))+1:0,s=n.map((l,c)=>({title:l.title,index:i+c,render:l.render,sortable:l.sortable??!1,exportable:l.exportable??!1,editable:l.editable??!1,draggable:l.draggable??!1,width:l.width,hideOnMobile:l.hideOnMobile,cellClassName:l.cellClassName,headerCellClassName:l.headerCellClassName})),a=e.map((l,c)=>{const m=[...l];for(const y of n)m.push(y.value?y.value(l,c):null);return m}),r=[],d=[],o=[];s.forEach((l,c)=>{const m=n[c].position;m==="start"?r.push(l):typeof m=="number"&&Number.isFinite(m)?o.push({at:Math.max(0,Math.floor(m)),col:l}):d.push(l)});let u=[...r,...t,...d];if(o.length>0){o.sort((c,m)=>c.at-m.at);let l=0;for(const{at:c,col:m}of o){const y=Math.min(u.length,c+l);u=[...u.slice(0,y),m,...u.slice(y)],l+=1}}return{data:a,columnsInfo:u}}function Ne(e,t){if(!e||!t)return;const n=E(t),s=Object.entries(e).find(([r])=>E(r)===n);if(!s)return;const a=s[1];return typeof a=="string"?D(a):a}function E(e){return e.toLowerCase().trim().replace(/^\{/,"").replace(/\}$/,"").replace(/\(.+\)$/,"")}export{J as C,W as D,Re as a,Te as b,Ee as c,je as d,Oe as e,D as f,Fe as g,ke as h,De as i,$e as j,le as n,ge as s,Ie as t};
