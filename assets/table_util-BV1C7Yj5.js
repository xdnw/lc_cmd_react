const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SimpleChart-V9M2bt1B.js","assets/index-SOjtd1du.js","assets/queries-BzWnpVnq.js","assets/command-utils-BF18nFEX.js","assets/command-meta-Dt1HocaT.js","assets/dropdown-menu-B_MP3PX6.js","assets/button-C6_F57E5.js","assets/theme-provider-BQwJ-LrG.js","assets/DialogContext-DiRAa5qs.js","assets/index-Iv-338HP.css","assets/SanitizedHtml-uzGg2i6y.js"])))=>i.map(i=>d[i]);
import{C as S,p as R,c as I,i as H,f as q,a as L,j as J,d as Y,S as Q,k as X}from"./command-utils-BF18nFEX.js";import{COMMANDS as k}from"./command-meta-Dt1HocaT.js";import{r as N,_ as j,j as A,L as Z}from"./index-SOjtd1du.js";var ee=Object.defineProperty,te=(e,t,r)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ne=(e,t,r)=>te(e,t+"",r);function d(e){return{kind:"layout-var",name:e}}function F(e){return typeof e=="object"&&e!=null&&e.kind==="layout-var"}class ae{constructor(){ne(this,"entries",[])}add(t){return this.entries.push({kind:"command",cmd:t.cmd,args:t.args,alias:t.alias}),this}addRaw(t,r){return this.entries.push({kind:"raw",placeholder:t,alias:r}),this}getEntries(){return[...this.entries]}}function $(e,t,r,a){const n=new ae,s=a(n);return ie(e,t,{variables:r.variables,entries:s.getEntries(),sort:r.sort,shorten:r.shorten})}const P=new Map;function V(e,t){return`${e}::${t}`}function re(e,t){const r={};for(const[a,n]of Object.entries(e)){const s=t?.[a];r[a]=s!=null&&s!==""?s:n.defaultValue}return r}function se(e,t){const r={},a={};for(const n of t.entries){if(n.kind!=="command"||!n.args)continue;const s=S.placeholders(e).get([n.cmd]),i=Object.fromEntries(s.getArguments().map(l=>[l.name,l]));for(const[l,o]of Object.entries(n.args)){if(!F(o))continue;const c=i[l];if(!c)throw new Error(`Layout config error for ${e}:${n.cmd} - argument "${l}" does not exist.`);const u={variable:o.name,command:String(n.cmd),argName:l,argType:c.arg.type},m=a[o.name];if(!m){a[o.name]=u,r[o.name]={argType:c.arg.type,min:c.arg.min,max:c.arg.max,desc:c.arg.desc,choices:c.arg.choices};continue}if(m.argType!==u.argType)throw new Error(`Layout config variable "${o.name}" has conflicting argument types: ${m.command}.${m.argName} (${m.argType}) vs ${u.command}.${u.argName} (${u.argType}).`)}}for(const n of Object.keys(t.variables))if(!r[n])throw new Error(`Layout config variable "${n}" is declared but never used.`);return{variables:t.variables,variableInputs:r}}function ie(e,t,r){const a=se(e,r),n=s=>{const i=re(r.variables,s),l=S.placeholders(e).array();for(const o of r.entries){if(o.kind==="raw"){const f=typeof o.placeholder=="function"?o.placeholder(i):o.placeholder;l.addRaw(f,o.alias);continue}let c;if(o.args&&(c=Object.fromEntries(Object.entries(o.args).map(([f,p])=>{if(F(p)){const g=i[p.name];if(g==null)throw new Error(`Layout config variable "${p.name}" is missing while resolving ${e}:${t}.`);return[f,g]}return[f,p]}))),!c||Object.keys(c).length===0){l.addRaw(`{${o.cmd}}`,o.alias);continue}const u=Object.entries(c).map(([f,p])=>`${f}: ${p}`).join(" "),m=u.length>0?`{${o.cmd}(${u})}`:`{${o.cmd}}`;l.addRaw(m,o.alias)}return r.shorten!==!1&&l.shorten(),l.build2d()};return P.set(V(e,t),n),{value:n(),sort:r.sort,config:a}}function Ge(e,t){return O[e]?.columns[t]?.config}function ze(e,t,r){const a=O[e]?.columns[t];if(!a)return;const n=P.get(V(e,t));return n?{...a,value:n(r)}:a}function oe(e,t){return R({type:"DBAlliance",command:["getnations"],args:{filter:t,timestamp:e}})}function C(e,t,r){const a=r==null?`#cities>=${t}`:`#cities>=${t},#cities<=${r}`;return`${oe(e,`#ismember,${a}`).slice(0,-1)}.countnations}`}function le(e,t,r,a){const n=C(t,r,a),s=C(e,r,a);return`${n} (${n}-${s})`}const O={DBAlliance:{selections:{All:"*","All (>0 active member)":'*,#countNations("#ismember,#active_m<10080")>0',"Top 10":"*,#rank<=10","Top 15":"*,#rank<=15","Top 25":"*,#rank<=25","Top 50":"*,#rank<=50","Guild Alliances":"%guild_alliances%"},columns:{General:{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getcolor",alias:"Color"}).add({cmd:"countnations",args:{filter:"#position>1"},alias:"Members"}).shorten().build2d(),sort:{idx:2,dir:"desc"}},Militarization:{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"Tank%"}).add({cmd:"getmetricat",args:{metric:"AIRCRAFT_PCT"},alias:"Air%"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"1d"},alias:"1d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"2d"},alias:"2d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"5d"},alias:"5d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"10d"},alias:"10d"}).add({cmd:"getmilitarizationgraph",args:{start:"60d"},alias:"Militarization"}).shorten().build2d(),sort:{idx:3,dir:"desc"}},Revenue:{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getrevenueconverted",alias:"Total"}).addMultipleRaw(k.options.ResourceType.options.filter(e=>e!=="CREDITS").map(e=>[`{revenue.${e}}`,e])).shorten().build2d(),sort:{idx:1,dir:"desc"}},"City Growth (30d)":{...$("DBAlliance","City Growth (30d)",{variables:{window:{defaultValue:"30d",label:"Window",desc:"Relative time window used in all growth metrics (for example: 7d, 14d, 30d)."},end:{defaultValue:"0d",label:"End",desc:"Relative end offset for the selected window (typically 0d for now)."}},sort:{idx:17,dir:"desc"}},e=>e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getmembershipchangesbyreason",args:{reasons:"recruited,joined",start:d("window"),end:d("end")},alias:"Joined"}).add({cmd:"getmembershipchangesbyreason",args:{reasons:"left",start:d("window"),end:d("end")},alias:"Left"}).add({cmd:"getnetmembersacquired",args:{start:d("window"),end:d("end")},alias:"Net"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"joined",assets:"cities",start:d("window"),end:d("end")},alias:"Poached City"}).add({cmd:"getmembershipchangeassetvalue",args:{reasons:"joined",assets:"cities",start:d("window"),end:d("end")},alias:"Poached City $"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"recruited",assets:"cities",start:d("window"),end:d("end")},alias:"Recruited City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"left",assets:"cities",start:d("window"),end:d("end")},alias:"Left City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"vm_returned",assets:"cities",start:d("window"),end:d("end")},alias:"VM Ended City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"vm_left",assets:"cities",start:d("window"),end:d("end")},alias:"VM City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"deleted",assets:"cities",start:d("window"),end:d("end")},alias:"Deleted City"}).add({cmd:"getboughtassetcount",args:{assets:"cities",start:d("window"),end:d("end")},alias:"City Buy"}).add({cmd:"geteffectiveboughtassetcount",args:{assets:"cities",start:d("window"),end:d("end")},alias:"City Buy (remain)"}).add({cmd:"getspendingvalue",args:{assets:"cities",start:d("window"),end:d("end")},alias:"City Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"cities",start:d("window"),end:d("end")},alias:"City Buy $ (remain)"}).add({cmd:"getnetasset",args:{asset:"cities",start:d("window"),end:d("end")},alias:"Net City"}).add({cmd:"getnetassetvalue",args:{asset:"cities",start:d("window"),end:d("end")},alias:"Net City $"}))},"Growth (30d)":{...$("DBAlliance","Growth (30d)",{variables:{window:{defaultValue:"30d",label:"Window",desc:"Relative time window for alliance growth metrics."},end:{defaultValue:"0d",label:"End",desc:"Relative end offset for the selected window (typically 0d for now)."}},sort:{idx:9,dir:"desc"}},e=>e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"getnetmembersacquired",args:{start:d("window"),end:d("end")},alias:"Net Member"}).add({cmd:"getnetasset",args:{asset:"cities",start:d("window"),end:d("end")},alias:"Net City"}).add({cmd:"getnetassetvalue",args:{asset:"cities",start:d("window"),end:d("end")},alias:"Net City $"}).add({cmd:"getnetassetvalue",args:{asset:"projects",start:d("window"),end:d("end")},alias:"Net Project $"}).add({cmd:"getnetassetvalue",args:{asset:"land",start:d("window"),end:d("end")},alias:"Net Land $"}).add({cmd:"getnetassetvalue",args:{asset:"infra",start:d("window"),end:d("end")},alias:"Net Infra $"}).add({cmd:"getnetassetvalue",args:{asset:"*",start:d("window"),end:d("end")},alias:"Net Asset $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"cities",start:d("window"),end:d("end")},alias:"City Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"projects",start:d("window"),end:d("end")},alias:"Project Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"land",start:d("window"),end:d("end")},alias:"Land Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"infra",start:d("window"),end:d("end")},alias:"Infra Buy-Loss $"}).add({cmd:"getcumulativerevenuevalue",args:{start:d("window"),end:d("end")},alias:"Total Revenue"}))},"Tier Delta (30d)":{...$("DBAlliance","Tier Delta (30d)",{variables:{baseline:{defaultValue:"30d",label:"Baseline",desc:"Snapshot offset used as the comparison baseline (for example: 30d, 90d, 365d)."},current:{defaultValue:"0d",label:"Current",desc:"Snapshot offset used as the current comparison point (typically 0d)."}},sort:{idx:12,dir:"desc"}},e=>{const t=e.add({cmd:"getmarkdownurl",alias:"Alliance"}).addRaw(a=>C(a.current,0),"Active Members").addRaw(a=>C(a.baseline,0),"Active Members (prior)").addRaw(a=>`${C(a.current,0,100)}-${C(a.baseline,0)}`,"Delta").add({cmd:"getnetmembersacquired",args:{start:d("baseline"),end:d("current")},alias:"Net Members"}),r=[{label:"c1-c9",min:1,max:9},{label:"c10-c19",min:10,max:19},{label:"c20-c29",min:20,max:29},{label:"c30-c39",min:30,max:39},{label:"c40-c49",min:40,max:49},{label:"c50+",min:50}];for(const a of r)t.addRaw(n=>C(n.current,a.min,"max"in a?a.max:void 0),a.label).addRaw(n=>`${C(n.current,a.min,"max"in a?a.max:void 0)}-${C(n.baseline,a.min,"max"in a?a.max:void 0)}`,`${a.label} Delta`);return t})},"Tier Bands (30d)":{...$("DBAlliance","Tier Bands (30d)",{variables:{baseline:{defaultValue:"30d",label:"Baseline",desc:"Snapshot offset used as the comparison baseline."},current:{defaultValue:"0d",label:"Current",desc:"Snapshot offset used as the current comparison point."}},sort:{idx:8,dir:"desc"}},e=>{const t=e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getnetmembersacquired",args:{start:d("baseline"),end:d("current")},alias:"Net Members"}),r=[{label:"c1-c9",min:1,max:9},{label:"c10-c19",min:10,max:19},{label:"c20-c29",min:20,max:29},{label:"c30-c39",min:30,max:39},{label:"c40-c49",min:40,max:49},{label:"c50+",min:50}];for(const a of r)t.addRaw(n=>le(n.baseline,n.current,a.min,"max"in a?a.max:void 0),`${a.label} now (Delta)`);return t})},"Normalized Growth (30d)":{...$("DBAlliance","Normalized Growth (30d)",{variables:{window:{defaultValue:"30d",label:"Window",desc:"Relative time window for normalized growth calculations."},end:{defaultValue:"0d",label:"End",desc:"Relative end offset for the selected window (typically 0d for now)."}},sort:{idx:2,dir:"desc"}},e=>e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).addRaw(t=>R({type:"DBAlliance",command:["geteffectiveboughtassetcount"],args:{assets:"cities",start:t.window,end:t.end}})+"/{countmembers}","Cities/Member").add({cmd:"geteffectivespendingvalue",args:{assets:"cities,projects,land",start:d("window"),end:d("end")},alias:"Invest/Member"}).addRaw(t=>R({type:"DBAlliance",command:["geteffectivespendingvalue"],args:{assets:"cities,projects,land",start:t.window,end:t.end}})+"/"+R({type:"DBAlliance",command:["getcumulativerevenuevalue"],args:{start:t.window,end:t.end}}),"Invest/Revenue"))},"Cumulative Revenue (30d)":{...$("DBAlliance","Cumulative Revenue (30d)",{variables:{window:{defaultValue:"30d",label:"Window",desc:"Relative time window for cumulative revenue snapshots."},end:{defaultValue:"0d",label:"End",desc:"Relative end offset for the selected window (typically 0d for now)."}},sort:{idx:1,dir:"desc"}},e=>{const t=e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getcumulativerevenuevalue",args:{start:d("window"),end:d("end")},alias:"Value"}),r=k.options.ResourceType.options.filter(a=>a!=="CREDITS");for(const a of r)t.addRaw(n=>`{getcumulativerevenue(${n.window}).${a}}`,a);return t})},"City Exponent":{value:S.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"exponentialcitystrength",alias:"city^3"}).add({cmd:"exponentialcitystrength",args:{power:"2.5"},alias:"city^2.5"}).shorten().build2d(),sort:{idx:5,dir:"desc"}}}},ResourceType:{selections:{All:"*",Raws:"raws",Manufactured:"manu",...Object.fromEntries(k.options.ResourceType.options.map(e=>[e,e]))},columns:{Price:{value:S.placeholders("ResourceType").array().add({cmd:"getname",alias:"Resource"}).add({cmd:"getlow",alias:"Low"}).add({cmd:"gethigh",alias:"High"}).add({cmd:"getmargin",alias:"Margin"}).shorten().build2d(),sort:{idx:0,dir:"asc"}}}},Conflict:{selections:{All:"*",Active:"*,#getActiveWars>0",Inactive:"*,#getActiveWars=0",Great:"*,#getCategory=GREAT",Major:"*,#getCategory=MAJOR",Skirmish:"*,#getCategory=SKIRMISH",Unverified:"*,#getCategory=UNVERIFIED",Generated:"*,#getCategory=GENERATED",Micro:"*,#getCategory=MICRO","Non-Micro":"*,#getCategory=NON_MICRO"},columns:{General:{value:S.placeholders("Conflict").array().add({cmd:"getid",alias:"ID"}).addRaw("[{name}]({url})","Name").add({cmd:"getcategory",alias:"Category"}).add({cmd:"getstartturn",alias:"Start"}).add({cmd:"getendturn",alias:"End"}).add({cmd:"getactivewars",alias:"Active Wars"}).add({cmd:"getdamageconverted",args:{isPrimary:"true"},alias:"c1_damage"}).add({cmd:"getdamageconverted",args:{isPrimary:"false"},alias:"c2_damage"}).shorten().build2d(),sort:{idx:0,dir:"desc"}}}},DBNation:{selections:{All:"*","Alliance Nations":"%guild_alliances%","Members (Non VM)":"%guild_alliances%,#ismember","Active Applicant (1d)":"%guild_alliances%,#position=1,#vm_turns=0,#active_m<1440","Inactive Member >5d":"%guild_alliances%,#ismember,#active_m>7200","Inactive Member >1w":"%guild_alliances%,#ismember,#active_m>10080",Allies:"~allies,#ismember,#active_m<10800","Allies (underutilized)":"~allies,#active_m<2880,#freeoffensiveslots>0,#tankpct>0.8,#aircraftpct>0.8,#RelativeStrength>1.3,#vm_turns=0,#isbeige=0",Enemies:"~enemies,#ismember,#active_m<10800","Enemies (priority)":"~enemies,#cities>10,#active_m<2880,#def<3,#off>0,#vm_turns=0,#isbeige=0,#RelativeStrength>0.7,#fighting(~allies)","Spyable Enemies":"~enemies,#ismember,#active_m<2880,#espionageFull=0","Lacking Spies":"%guild_alliances%,#ismember,#getSpyCapLeft>0,#daysSinceLastSpyBuy>0","Member Not Verified":"%guild_alliances%,#ismember,#verified=0","Member Not in Guild":"%guild_alliances%,#ismember,#isInAllianceGuild=0","Member Not in Milcom Guild":"%guild_alliances%,#ismember,#isInMilcomGuild=0","Low Tier, Not Raiding":"%guild_alliances%,#cities<10,#ismember,#active_m<2880,#off<5,#color!=beige,#blockaded=0"},columns:{General:{value:S.placeholders("DBNation").array().add({cmd:"getmarkdownurl",alias:"Nation"}).add({cmd:"getallianceurlmarkup",alias:"AA"}).add({cmd:"getagedays",alias:"Age"}).add({cmd:"getcolor",alias:"Color"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getscore",alias:"Score"}).shorten().build2d(),sort:[{idx:1,dir:"desc"},{idx:5,dir:"desc"}]},MMR:{value:S.placeholders("DBNation").array().add({cmd:"getmarkdownurl",alias:"Nation"}).add({cmd:"getallianceurlmarkup",alias:"AA"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getavg_infra",alias:"Infra"}).add({cmd:"getscore",alias:"NS"}).add({cmd:"getoff",alias:"ðŸ—¡"}).add({cmd:"getdef",alias:"ðŸ›¡"}).add({cmd:"getsoldiers",alias:"ðŸ’‚"}).add({cmd:"gettanks",alias:"âš™"}).add({cmd:"getaircraft",alias:"âœˆ"}).add({cmd:"getships",alias:"â›µ"}).add({cmd:"getspies",alias:"ðŸ”Ž"}).add({cmd:"dayssincelastspybuy",alias:"$ðŸ”Ždays"}).add({cmd:"getspycap",alias:"ðŸ”Žcap"}).add({cmd:"getmmrbuildingdecimal",alias:"MMR[build]"}).add({cmd:"dayssincelastsoldierbuy",alias:"$ðŸ’‚days"}).add({cmd:"dayssincelasttankbuy",alias:"$âš™days"}).add({cmd:"dayssincelastaircraftbuy",alias:"$âœˆdays"}).add({cmd:"dayssincelastshipbuy",alias:"$â›µdays"}).shorten().build2d(),sort:[{idx:1,dir:"desc"},{idx:3,dir:"desc"}]}}}};function de({colorId:e,beigeTurns:t}){const r=N.useMemo(()=>Number.isInteger(e),[e]),[a,n]=N.useState(()=>r?"":String(e));N.useEffect(()=>{let i=!0;return r?(j(async()=>{const{COMMANDS:l}=await import("./command-meta-Dt1HocaT.js");return{COMMANDS:l}},[]).then(({COMMANDS:l})=>{if(!i)return;const o=l.options.NationColor.options[e]??String(e);n(o)}).catch(()=>{i&&n(String(e))}),()=>{i=!1}):(n(String(e)),()=>{i=!1})},[e,r]);const s=a.replace("BEIGE","TAN");return A.jsx("div",{className:"w-5 h-5 border border-2 border-black flex items-center justify-center",style:{backgroundColor:s||"transparent"},title:a||String(e),children:t!==void 0&&t>0&&A.jsx("span",{className:"text-xs text-black",children:t})})}const ce=N.lazy(()=>j(()=>import("./SimpleChart-V9M2bt1B.js").then(e=>e.S),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),ue=N.lazy(()=>j(()=>import("./SanitizedHtml-uzGg2i6y.js"),__vite__mapDeps([10,1,9]))),D={money:{display:Ae},comma:{display:q},color:{display:Ce},time:{display:xe},time_ms:{display:Se},diff_ms:{display:ge},normal:{display:we},text:void 0,json:{display:ve},graph:{display:he,isHtml:!0},html:{display:ye},duration_day:{display:pe},percent_100:{display:me},percent:{display:fe},duration_ms:{display:be},numeric_map:{display:Ne},turn_to_date:{display:H}};function me(e){return e==null?"N/A":e.toFixed(2)+"%"}function fe(e){if(e==null)return"N/A";try{return(e*100).toFixed(2)+"%"}catch{return"N/A2"}}function ge(e){return Y(e,5)}function pe(e){if(e==null)return"N/A";const t=e*24*60*60;return t==0?"0s":L(t,3)}function be(e){if(e==null)return"N/A";const t=e/1e3;return t==0?"0s":L(t,3)}function ye(e){return A.jsx(N.Suspense,{fallback:A.jsx("span",{children:e??""}),children:A.jsx(ue,{value:e??""})})}function he(e){return A.jsx(N.Suspense,{fallback:A.jsx("span",{children:"Loading graph..."}),children:A.jsx(ce,{graph:e,type:"LINE",theme:"light",hideLegend:!0,hideDots:!0,minHeight:"40px",maxHeight:"50px"})})}function we(e){if(!e)return e;e=e.toString();const t=e.indexOf("[");if(t!==0){if(e[0]==="="&&e.startsWith("=HYPERLINK(")){const l=e.indexOf(")",11),o=e.slice(11,l);if(l===e.length-1){const c=J(o,",");if(c.length===2)return`<a href="${c[0].trim().replace(/^"|"$/g,"")}">${c[1].trim().replace(/^"|"$/g,"")}</a>`}}return e}const r=e.indexOf("]",t);if(r<=t)return e;const a=e.indexOf("(",r);if(a!==r+1)return e;const n=e.indexOf(")",a);if(n!==e.length-1)return e;let s=e.slice(a+1,n);s.startsWith("<")&&s.endsWith(">")&&(s=s.slice(1,-1));const i=e.slice(t+1,r);return A.jsx(Z,{to:s,children:i})}function ve(e){const t=Array.isArray(e)?e.map(r=>Number.isFinite(r)?Math.round(r*100)/100:r):Object.fromEntries(Object.entries(e).map(([r,a])=>[r,Number.isFinite(a)?Math.round(a*100)/100:a]));return JSON.stringify(t)}function K(e){if(e)if(e.startsWith("enum:")){const t=e.split(":")[1],r=S.data.options[t].options??[];return{display:a=>r[a],isEnum:!0,options:r}}else return D[e]??D.text}function xe(e){const t=new Date(e*1e3);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function Se(e){const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function Ae(e){return"$"+I(e)}function Ce(e){return A.jsx(de,{colorId:e})}function Ne(e){return e?(typeof e=="string"&&(e=JSON.parse(e)),`{${Object.entries(e).map(([r,a])=>`${r}:${I(a)}`).join(",")}}`):"{}"}function $e(e){return(e?Array.isArray(e)?e:[e]:[]).map(r=>({columnKey:String(r.idx),direction:r.dir==="asc"?"ASC":"DESC"}))}const Re=5e4;function _e(e,t,r,a){const n=performance.now();try{const s=[...r];if(!Array.isArray(t)||t.length===0)return;const i=new Map;s.forEach(m=>i.set(m.index,m));const l=Me(e,t,i),o=Oe(t,s,i);if(o.perfectMatch)return;const c=G(a);let u;if(o.partialMatch){const m=T(t,l,i,a);u=[...e],je(u,m,o.matchedColumns)}else if(t.every(f=>{const p=l.get(Number(f.columnKey))||"mixed";return p==="number"||p==="string"||p==="boolean"})&&e.length>=Re)u=Be(e,t,l,c);else{const f=T(t,l,i,a);u=[...e],u.sort((p,g)=>M(p,g,f))}return De(s,t,i),{data:u,columns:s}}finally{performance.now()-n}}function Me(e,t,r){const a=Math.min(100,e.length),n=new Map;if(e.length===0){for(const s of t){const i=Number(s.columnKey),l=r.get(i),o=l?.type||"mixed";n.set(i,o),l&&(l.type=o)}return n}for(const s of t){const i=Number(s.columnKey),l=r.get(i);let o=l?.type||null;if(!o){let u=!1,m=!1,f=!1,p=!1;for(let g=0;g<a;g++){const v=e[g];if(!v)break;const y=v[i];if(y==null)continue;const b=typeof y;if(b==="number"?u=!0:b==="string"?m=!0:b==="boolean"?f=!0:p=!0,(u?1:0)+(m?1:0)+(f?1:0)+(p?1:0)>1||p){o="mixed";break}}o||(u?o="number":m?o="string":f?o="boolean":o="mixed")}const c=o;n.set(i,c),l&&(l.type=c)}return n}function T(e,t,r,a){const n=G();return e.map(s=>{const i=Number(s.columnKey),l=t.get(i)||r.get(i)?.type||"mixed",o=s.direction==="ASC"?1:-1;switch(l){case"number":return{index:i,compare:z(o)};case"string":return{index:i,compare:U(o,n)};case"boolean":return{index:i,compare:W(o,n)};default:return{index:i,compare:ke(o,n)}}})}function G(e){return{nulls:"auto",nans:"auto",collator:void 0}}function E(e){return e==null||typeof e!="number"?4:Number.isNaN(e)?3:e===1/0?2:e===-1/0?1:0}const _=(()=>{const e=new Array(5).fill(0);return e[1]=0,e[2]=1,e[3]=2,e[4]=3,e})();function z(e,t){return(r,a)=>{const n=E(r),s=E(a),i=n===0;if(i!==(s===0))return i?-1:1;if(i){const o=r,c=a;return o<c?e===1?-1:1:o>c?e===1?1:-1:0}return n!==s?_[n]-_[s]:0}}function U(e,t){const r=t.nulls==="first"||t.nulls==="auto"&&e===-1,a=t.collator;return(n,s)=>{const i=n==null,l=s==null;if(i||l)return i&&l?0:i?r?-1:1:r?1:-1;const o=typeof n=="string"?n:String(n),c=typeof s=="string"?s:String(s),u=a?a.compare(o,c):o.localeCompare(c);return u!==0?e===1?u:-u:0}}function W(e,t){const r=t.nulls==="first"||t.nulls==="auto"&&e===-1;return(a,n)=>{const s=a==null,i=n==null;if(s||i)return s&&i?0:s?r?-1:1:r?1:-1;const l=!!a;return l===!!n?0:e===1?l?1:-1:l?-1:1}}function ke(e,t){const r=z(e),a=U(e,t),n=W(e,t),l=e===1?new Map([["number",0],["string",1],["boolean",2],["object",3]]):new Map([["object",0],["boolean",1],["string",2],["number",3]]);return(o,c)=>{const u=o==null,m=c==null;if(u||m){if(u&&m)return 0;const h=t.nulls==="first"||t.nulls==="auto"&&e===-1;return u?h?-1:1:h?1:-1}const f=typeof o,p=typeof c;if(f==="number"&&p==="number")return r(o,c);if(f==="string"&&p==="string")return a(o,c);if(f==="boolean"&&p==="boolean")return n(o,c);const g=l.get(f)??3,v=l.get(p)??3;if(g!==v)return g-v;const y=String(o),b=String(c);if(y===b)return 0;const w=t.collator?t.collator.compare(y,b):y.localeCompare(b);return e===1?w:-w}}function M(e,t,r){for(let a=0;a<r.length;a++){const n=r[a],s=n.compare(e[n.index],t[n.index]);if(s!==0)return s}return 0}function Te(e,t,r){for(let a=0;a<r.length;a++){const n=r[a];if(n.compare(e[n.index],t[n.index])!==0)return!1}return!0}function Ee(e,t,r,a){for(let n=t+1;n<r;n++){const s=e[n];let i=n-1;for(;i>=t&&M(e[i],s,a)>0;)e[i+1]=e[i],i--;e[i+1]=s}}function je(e,t,r){const a=t.slice(0,r),n=t.slice(r);if(n.length===0)return;let s=0;for(;s<e.length;){let i=s+1;for(;i<e.length&&Te(e[s],e[i],a);)i++;const l=i-s;if(l>1)if(l<=10)Ee(e,s,i,n);else{const o=e.slice(s,i);o.sort((c,u)=>M(c,u,n));for(let c=0;c<o.length;c++)e[s+c]=o[c]}s=i}}function Oe(e,t,r){let a=0;for(let s=0;s<e.length;s++){const i=e[s],l=Number(i.columnKey),o=r.get(l),c=i.direction==="ASC"?"asc":"desc";if(!o?.sorted||o.sorted[0]!==c||o.sorted[1]!==s)break;a++}let n=!1;for(const s of t)if(s.sorted&&s.sorted[1]>=a){n=!0;break}return{perfectMatch:a===e.length&&!n,partialMatch:a>0,matchedColumns:a}}function De(e,t,r){for(const a of e)a.sorted=void 0;t.forEach((a,n)=>{const s=Number(a.columnKey),i=r.get(s);i&&(i.sorted=[a.direction==="ASC"?"asc":"desc",n])})}function Be(e,t,r,a){const n=e.length,s=t.length;if(n<=1||s===0)return e.slice();const i=[],l=a.collator;for(let m=0;m<s;m++){const f=t[m],p=Number(f.columnKey),g=f.direction==="ASC"?1:-1,v=r.get(p)||"mixed";if(v==="number"){const y=new Uint8Array(n),b=new Float64Array(n);for(let w=0;w<n;w++){const h=e[w][p],x=E(h);y[w]=x,b[w]=x===0?h:0}i.push({kind:"number",dir:g,codes:y,vals:b})}else if(v==="string"){const y=new Array(n),b=new Uint8Array(n),w=g===-1;for(let h=0;h<n;h++){const x=e[h][p];x==null?(b[h]=1,y[h]=""):(b[h]=0,y[h]=typeof x=="string"?x:String(x))}i.push({kind:"string",dir:g,strs:y,nulls:b,nullsFirst:w})}else if(v==="boolean"){const y=new Uint8Array(n),b=new Uint8Array(n),w=g===-1;for(let h=0;h<n;h++){const x=e[h][p];x==null?(b[h]=1,y[h]=0):(b[h]=0,y[h]=x===!0?1:0)}i.push({kind:"boolean",dir:g,bools:y,nulls:b,nullsFirst:w})}else{const y=T(t,r,new Map);return e.slice().sort((b,w)=>M(b,w,y))}}const o=new Array(n);for(let m=0;m<n;m++)o[m]=m;const c=(m,f)=>{for(let p=0;p<i.length;p++){const g=i[p];if(g.kind==="number"){const v=g.codes[m],y=g.codes[f],b=v===0;if(b!==(y===0))return b?-1:1;if(b){const h=g.vals[m],x=g.vals[f];if(h<x)return g.dir===1?-1:1;if(h>x)return g.dir===1?1:-1}else if(v!==y)return _[v]-_[y]}else if(g.kind==="string"){const v=g.nulls[m]===1,y=g.nulls[f]===1;if(v||y){if(v&&y)continue;return v?g.nullsFirst?-1:1:g.nullsFirst?1:-1}const b=g.strs[m],w=g.strs[f],h=l?l.compare(b,w):b.localeCompare(w);if(h!==0)return g.dir===1?h:-h}else{const v=g.nulls[m]===1,y=g.nulls[f]===1;if(v||y){if(v&&y)continue;return v?g.nullsFirst?-1:1:g.nullsFirst?1:-1}const b=g.bools[m],w=g.bools[f];if(b!==w)return g.dir===1?b-w:w-b}}return m-f};o.sort(c);const u=new Array(n);for(let m=0;m<n;m++)u[m]=e[o[m]];return u}function Ue(e,t,r,a=[],n){const s=e.errors??[],i=$e(t),l=r.size>0?Array.from(r).map(([y,b])=>b??y):e.cells[0];let o=e.cells.slice(1);const c=e.renderers,u=Array.from(r.keys());let m=l.map((y,b)=>{const w=c?K(c[b]):void 0,h=w?void 0:Fe(n,u[b]);return{title:Ie(y),index:b,render:w??h}});const f=!t||Array.isArray(t)&&t.length===0||o.length<=1?void 0:_e(o,i,m);f&&(o=f.data,m=f.columns);const p=Le(o,m,a);o=p.data,m=p.columnsInfo;const g=Array.from(Array(m.length).keys());return{errors:s,columnsInfo:m,data:o,visibleColumns:g,searchSet:new Set,sort:t}}function We(e,t){const r=S.placeholders(e).getCommands(),a=[];for(const n of r)t&&!t(n)||n.hasRequiredArgument()||a.push([n.name,n.command.desc]);return a}function Ie(e){if(e.includes("{")){for(const t of Q)e.includes("{"+t)&&(e=e.replace("{"+t,"{"));return e.replace("{","").replace("}","")}else return e}function He(e,t,r,a){const n=t.filter(c=>c.exportable!==!1),s=n.length>0?n:t,i=s.map(c=>c.title),l=e.map(c=>s.map(u=>c[u.index])),o=[i,...l];return X(o,r,a)}function qe(e){const t=e.get("type");if(t&&t in S.data.placeholders)return t}function Je(e,t){const r={},a=t?O[t]?.selections:void 0,n=a?.All??Object.values(a??{})[0];r[""]=e.get("sel")??n??"*";const s=new Set(["type","sel","col","sort"]);for(const[i,l]of e.entries())!s.has(i)&&i&&(r[i]=l);return r}function Ye(e){const t=Object.fromEntries(e.getAll("col").map(r=>{const[a,n]=r.split(";");return[a,n||null]}));return Object.keys(t).length>0?new Map(Object.entries(t)):void 0}function Qe(e){const t=e.getAll("sort").map(r=>{const[a,n]=r.split(";");return{idx:parseInt(a,10),dir:n}});return t.length>0?t:void 0}function Xe(e,t){const r=t[""]??"",a=Object.entries(t).filter(([n])=>n!=="").map(([n,s])=>`(${n}: ${s})`).join(" ");return a?`${e}:${r} [${a}]`:`${e}:${r}`}function Ze(e){let t;return Object.keys(e).length===1?t=e[""]:Object.keys(e).length>1&&(t=JSON.stringify(e)),t}function et({type:e,sel:t,selAndModifiers:r,columns:a,sort:n}){const s=new URLSearchParams;if(s.set("type",e),t)s.set("sel",t);else if(r)for(const[i,l]of Object.entries(r))l?s.append(i===""?"sel":i,l):s.set("sel",l);if(a.forEach((i,l)=>{s.append("col",i?`${l};${i}`:l)}),n)if(Array.isArray(n))for(const i of n)s.append("sort",`${i.idx};${i.dir}`);else s.append("sort",`${n.idx};${n.dir}`);return s.toString()}function Le(e,t,r){if(!r.length)return{data:e,columnsInfo:t};const a=t.length>0?Math.max(...t.map(u=>u.index))+1:0,n=r.map((u,m)=>({title:u.title,index:a+m,render:u.render,sortable:u.sortable??!1,exportable:u.exportable??!1,editable:u.editable??!1,draggable:u.draggable??!1,width:u.width,hideOnMobile:u.hideOnMobile,cellClassName:u.cellClassName,headerCellClassName:u.headerCellClassName})),s=e.map((u,m)=>{const f=[...u];for(const p of r)f.push(p.value?p.value(u,m):null);return f}),i=[],l=[],o=[];n.forEach((u,m)=>{const f=r[m].position;f==="start"?i.push(u):typeof f=="number"&&Number.isFinite(f)?o.push({at:Math.max(0,Math.floor(f)),col:u}):l.push(u)});let c=[...i,...t,...l];if(o.length>0){o.sort((m,f)=>m.at-f.at);let u=0;for(const{at:m,col:f}of o){const p=Math.min(c.length,m+u);c=[...c.slice(0,p),f,...c.slice(p)],u+=1}}return{data:s,columnsInfo:c}}function Fe(e,t){if(!e||!t)return;const r=B(t),n=Object.entries(e).find(([i])=>B(i)===r);if(!n)return;const s=n[1];return typeof s=="string"?K(s):s}function B(e){return e.toLowerCase().trim().replace(/^\{/,"").replace(/\}$/,"").replace(/\(.+\)$/,"")}export{de as C,O as D,Ge as a,We as b,qe as c,Je as d,Ye as e,Qe as f,et as g,K as h,Ue as i,Xe as j,He as k,Ne as n,ze as r,_e as s,Ze as t};
