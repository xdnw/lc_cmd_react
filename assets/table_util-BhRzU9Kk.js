const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SimpleChart-BZ5w6o67.js","assets/index-nW9DkA3u.js","assets/queries-B0bYDAFD.js","assets/command-utils-CoW9iswN.js","assets/command-meta-Dd5nXUBW.js","assets/dropdown-menu-6Z3pQS9A.js","assets/button-ujMD_D3S.js","assets/theme-provider-BEuElyuX.js","assets/DialogContext-BfwqmJEN.js","assets/MathUtil-8RZlDOhB.js","assets/index-B6-_B6wI.css","assets/SanitizedHtml-Ns7Al9X6.js"])))=>i.map(i=>d[i]);
import{C as w,c as M,i as ie,f as oe,a as H,j as ce,d as le,S as de,k as ue}from"./command-utils-CoW9iswN.js";import{r as N,_ as B,j as C,L as me}from"./index-nW9DkA3u.js";import{COMMANDS as T}from"./command-meta-Dd5nXUBW.js";function I(e){return{kind:"layout-var",name:e}}function E(e){return typeof e=="object"&&e!=null&&e.kind==="layout-var"}var fe=Object.defineProperty,ge=(e,t,n)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t,n)=>ge(e,typeof t!="symbol"?t+"":t,n);class pe{constructor(t){P(this,"placeholderType"),P(this,"entries",[]),this.placeholderType=t}add(t){return this.entries.push({kind:"command",cmd:t.cmd,args:t.args,alias:t.alias,renderer:t.renderer}),this}addRaw(t,n,a){return this.entries.push({kind:"raw",placeholder:t,alias:n,renderer:a}),this}rawVar(t){return{kind:"layout-var",name:t}}rawConcat(...t){const n=[],a=[];for(const r of t){if(typeof r=="string"||typeof r=="object"&&r.kind==="layout-var"){n.push(r);continue}n.push(...r.segments),a.push(...r.usages)}return{kind:"raw-template",segments:n,usages:a}}rawCommand(t,n){const a=[`{${t}`],r=[],s=n?Object.entries(n).filter(([,i])=>i!=null):[];return s.length>0&&(a.push("("),s.forEach(([i,o],c)=>{if(c>0&&a.push(" "),a.push(`${i}: `),E(o)){const l=o;a.push(l),r.push({variable:l.name,command:String(t),argName:i})}else a.push(o)}),a.push(")")),a.push("}"),{kind:"raw-template",segments:a,usages:r}}rawSubCommand(t,n,a,r){const o=T.placeholders[this.placeholderType].commands[String(t)].return_type;if(!o||!(o in T.placeholders))throw new Error(`Layout config error for ${this.placeholderType}:${String(t)} - return_type is missing or unknown, cannot chain sub-command.`);const c=T.placeholders[o]?.commands;if(!c||!(String(a)in c))throw new Error(`Layout config error for ${this.placeholderType}:${String(t)} - sub-command "${String(a)}" is not valid for return type ${o}.`);const l=this.rawCommand(t,n);l.segments.pop(),l.segments.push(`.${String(a)}`);const u=r?Object.entries(r).filter(([,d])=>d!=null):[];return u.length>0&&(l.segments.push("("),u.forEach(([d,m],p)=>{p>0&&l.segments.push(" "),l.segments.push(`${d}: `),l.segments.push(m)}),l.segments.push(")")),l.segments.push("}"),{kind:"raw-template",segments:l.segments,usages:l.usages}}getEntries(){return[...this.entries]}}function x(e,t,n,a){const r=new pe(e),s=a(r);return Ce(e,t,{variables:n.variables,entries:s.getEntries(),sort:n.sort,shorten:n.shorten})}const Y=new Map;let F={};function be(e){F=e}function J(e,t){return`${e}::${t}`}function he(e,t){const n={};for(const[a,r]of Object.entries(e)){const s=t?.[a];n[a]=s!=null&&s!==""?s:r.defaultValue}return n}function V(e,t,n){const a=n[e.variable];if(!a){n[e.variable]=e,t[e.variable]={argType:e.argType,min:e.min,max:e.max,desc:e.desc,choices:e.choices};return}if(a.argType!==e.argType)throw new Error(`Layout config variable "${e.variable}" has conflicting argument types: ${a.command}.${a.argName} (${a.argType}) vs ${e.command}.${e.argName} (${e.argType}).`)}function ye(e,t){const n=t.commandType??e,r=w.placeholders(n).get([t.command]).getArguments().find(s=>s.name===t.argName);if(!r)throw new Error(`Layout config error for ${n}:${t.command} - argument "${t.argName}" does not exist.`);return{variable:t.variable,command:t.command,argName:t.argName,argType:r.arg.type,min:r.arg.min,max:r.arg.max,desc:r.arg.desc,choices:r.arg.choices}}function ve(e,t){return e.segments.map(n=>{if(typeof n=="string")return n;const a=t[n.name];if(a==null)throw new Error(`Layout config variable "${n.name}" is missing while rendering raw template.`);return a}).join("")}function we(e){return e.segments.every(t=>typeof t=="string")}function Q(e,t){if(!t||Object.keys(t).length===0)return`{${e}}`;const n=Object.entries(t).map(([a,r])=>`${a}: ${r}`).join(" ");return`{${e}(${n})}`}function Se(e,t){const n={},a={};for(const r of t.entries){if(r.kind!=="command"||!r.args)continue;const s=w.placeholders(e).get([r.cmd]),i=Object.fromEntries(s.getArguments().map(o=>[o.name,o]));for(const[o,c]of Object.entries(r.args)){if(!E(c))continue;const l=i[o];if(!l)throw new Error(`Layout config error for ${e}:${r.cmd} - argument "${o}" does not exist.`);V({variable:c.name,command:String(r.cmd),argName:o,argType:l.arg.type,min:l.arg.min,max:l.arg.max,desc:l.arg.desc,choices:l.arg.choices},n,a)}}for(const r of t.entries)if(r.kind==="raw"&&typeof r.placeholder!="string"){for(const s of r.placeholder.usages){if(!t.variables[s.variable])throw new Error(`Layout config error for ${e} - raw column references unknown variable "${s.variable}".`);V(ye(e,s),n,a)}for(const s of r.placeholder.segments)if(E(s)){if(!t.variables[s.name])throw new Error(`Layout config error for ${e} - raw column references unknown variable "${s.name}".`);n[s.name]||(n[s.name]={argType:"String"})}}for(const r of Object.keys(t.variables))if(!n[r])throw new Error(`Layout config variable "${r}" is declared but never used.`);return{variables:t.variables,variableInputs:n}}function Ce(e,t,n){const a=Se(e,n),r=s=>{const i=he(n.variables,s),o=w.placeholders(e).array();for(const c of n.entries){if(c.kind==="raw"){const u=typeof c.placeholder=="string"?c.placeholder:ve(c.placeholder,i);o.addRaw(u,c.alias);continue}let l;c.args&&(l=Object.fromEntries(Object.entries(c.args).map(([u,d])=>{if(E(d)){const m=i[d.name];if(m==null)throw new Error(`Layout config variable "${d.name}" is missing while resolving ${e}:${t}.`);return[u,m]}return[u,d]}))),o.addRaw(Q(c.cmd,l),c.alias)}return n.shorten!==!1&&o.shorten(),o.build2d()};return Y.set(J(e,t),r),{value:r(),sort:n.sort,config:a,columnRenderers:Ae(n.entries,e,t)}}function Ae(e,t,n){const a={};for(const r of e)if(r.renderer){if(r.alias){a[r.alias]=r.renderer;continue}if(r.kind==="command"){let s;r.args&&(s=Object.fromEntries(Object.entries(r.args).map(([i,o])=>{if(E(o))throw new Error(`Layout config error for ${t}:${n} - renderer columns for commands with variable arguments require an alias.`);return[i,o]}))),a[Q(r.cmd,s)]=r.renderer;continue}if(typeof r.placeholder=="string"){a[r.placeholder]=r.renderer;continue}if(we(r.placeholder)){a[r.placeholder.segments.join("")]=r.renderer;continue}throw new Error(`Layout config error for ${t}:${n} - renderer columns with dynamic raw placeholders require an alias.`)}return Object.keys(a).length>0?a:void 0}function ut(e,t){return F[e]?.columns[t]?.config}function mt(e,t,n){const a=F[e]?.columns[t];if(!a)return;const r=Y.get(J(e,t));return r?{...a,value:r(n)}:a}const xe={selections:{All:"*",Active:"*,#getActiveWars>0",Inactive:"*,#getActiveWars=0",Great:"*,#getCategory=GREAT",Major:"*,#getCategory=MAJOR",Skirmish:"*,#getCategory=SKIRMISH",Unverified:"*,#getCategory=UNVERIFIED",Generated:"*,#getCategory=GENERATED",Micro:"*,#getCategory=MICRO","Non-Micro":"*,#getCategory=NON_MICRO"},columns:{General:{value:w.placeholders("Conflict").array().add({cmd:"getid",alias:"ID"}).addRaw("[{name}]({url})","Name").add({cmd:"getcategory",alias:"Category"}).add({cmd:"getstartturn",alias:"Start"}).add({cmd:"getendturn",alias:"End"}).add({cmd:"getactivewars",alias:"Active Wars"}).add({cmd:"getdamageconverted",args:{isPrimary:"true"},alias:"c1_damage"}).add({cmd:"getdamageconverted",args:{isPrimary:"false"},alias:"c2_damage"}).shorten().build2d(),sort:{idx:0,dir:"desc"}}}},X={numberWithDeltaFromBaseline:{id:"layout:number_with_delta_from_baseline",display:Te}},Z="|~|";function Ne(e){if(typeof e!="string")return;const t=e.split(Z);return t.length>=2?t:void 0}function Te(e){const t=Ne(e);if(!t)return String(e??"");const[n,a]=t,r=Number(n),s=Number(a);if(!Number.isFinite(r)||!Number.isFinite(s))return`${n} (${a})`;const i=r-s,o=`${i>0?"+":""}${M(i)}`;return`${M(r)} (${o})`}const R=Object.freeze(Object.fromEntries(Object.entries(X).map(([e,t])=>[e,t.id]))),$e=Object.freeze(Object.fromEntries(Object.values(X).map(e=>[e.id,e.display])));function $(e){return{start:{defaultValue:"30d",label:"Start",desc:e},end:{defaultValue:"0d",label:"End",desc:"Time end (default: 0d)."}}}function K(e,t){return{baseline:{defaultValue:"30d",label:"Baseline",desc:e},current:{defaultValue:"0d",label:"Current",desc:t}}}function z(e){return"max"in e?e.max:void 0}function _(){return{start:I("start"),end:I("end")}}function U(e){return{current:e.rawVar("current"),baseline:e.rawVar("baseline")}}function A(e,t,n,a){const r=n<=0&&a==null?"":a==null?`,#cities>=${n}`:`,#cities>=${n},#cities<=${a}`;return e.rawSubCommand("getnations",{filter:`#ismember${r}`,timestamp:t},"countnations")}function k(e,t,n){return e.rawConcat(t,Z,n)}const G=[{label:"c1-c9",min:1,max:9},{label:"c10-c19",min:10,max:19},{label:"c20-c29",min:20,max:29},{label:"c30-c39",min:30,max:39},{label:"c40-c49",min:40,max:49},{label:"c50+",min:50}],_e={selections:{All:"*","All (>0 active member)":'*,#countNations("#ismember,#active_m<10080")>0',"Top 10":"*,#rank<=10","Top 15":"*,#rank<=15","Top 25":"*,#rank<=25","Top 50":"*,#rank<=50","Guild Alliances":"%guild_alliances%"},columns:{General:{value:w.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getcolor",alias:"Color"}).add({cmd:"countnations",args:{filter:"#position>1"},alias:"Members"}).shorten().build2d(),sort:{idx:2,dir:"desc"}},Militarization:{value:w.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT"},alias:"Tank%"}).add({cmd:"getmetricat",args:{metric:"AIRCRAFT_PCT"},alias:"Air%"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"1d"},alias:"1d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"2d"},alias:"2d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"5d"},alias:"5d"}).add({cmd:"getmetricat",args:{metric:"TANK_PCT",date:"10d"},alias:"10d"}).add({cmd:"getmilitarizationgraph",args:{start:"60d"},alias:"Militarization"}).shorten().build2d(),sort:{idx:3,dir:"desc"}},Revenue:{value:w.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getrevenueconverted",alias:"Total"}).addMultipleRaw(T.options.ResourceType.options.filter(e=>e!=="CREDITS").map(e=>[`{revenue.${e}}`,e])).shorten().build2d(),sort:{idx:1,dir:"desc"}},"City Growth (30d)":{...x("DBAlliance","City Growth (30d)",{variables:$("Time start for all growth metrics (for example: 7d, 14d, 30d)."),sort:{idx:17,dir:"desc"}},e=>{const t=_();return e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getmembershipchangesbyreason",args:{reasons:"recruited,joined",...t},alias:"Joined"}).add({cmd:"getmembershipchangesbyreason",args:{reasons:"left",...t},alias:"Left"}).add({cmd:"getnetmembersacquired",args:t,alias:"Net"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"joined",assets:"cities",...t},alias:"Poached City"}).add({cmd:"getmembershipchangeassetvalue",args:{reasons:"joined",assets:"cities",...t},alias:"Poached City $"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"recruited",assets:"cities",...t},alias:"Recruited City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"left",assets:"cities",...t},alias:"Left City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"vm_returned",assets:"cities",...t},alias:"VM Ended City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"vm_left",assets:"cities",...t},alias:"VM City"}).add({cmd:"getmembershipchangeassetcount",args:{reasons:"deleted",assets:"cities",...t},alias:"Deleted City"}).add({cmd:"getboughtassetcount",args:{assets:"cities",...t},alias:"City Buy"}).add({cmd:"geteffectiveboughtassetcount",args:{assets:"cities",...t},alias:"City Buy (remain)"}).add({cmd:"getspendingvalue",args:{assets:"cities",...t},alias:"City Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"cities",...t},alias:"City Buy $ (remain)"}).add({cmd:"getnetasset",args:{asset:"cities",...t},alias:"Net City"}).add({cmd:"getnetassetvalue",args:{asset:"cities",...t},alias:"Net City $"})})},"Growth (30d)":{...x("DBAlliance","Growth (30d)",{variables:$("Time start for alliance growth metrics."),sort:{idx:9,dir:"desc"}},e=>{const t=_();return e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"getnetmembersacquired",args:t,alias:"Net Member"}).add({cmd:"getnetasset",args:{asset:"cities",...t},alias:"Net City"}).add({cmd:"getnetassetvalue",args:{asset:"cities",...t},alias:"Net City $"}).add({cmd:"getnetassetvalue",args:{asset:"projects",...t},alias:"Net Project $"}).add({cmd:"getnetassetvalue",args:{asset:"land",...t},alias:"Net Land $"}).add({cmd:"getnetassetvalue",args:{asset:"infra",...t},alias:"Net Infra $"}).add({cmd:"getnetassetvalue",args:{asset:"*",...t},alias:"Net Asset $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"cities",...t},alias:"City Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"projects",...t},alias:"Project Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"land",...t},alias:"Land Buy $"}).add({cmd:"geteffectivespendingvalue",args:{assets:"infra",...t},alias:"Infra Buy-Loss $"}).add({cmd:"getcumulativerevenuevalue",args:t,alias:"Total Revenue"})})},"Membership Changes (30d)":{...x("DBAlliance","Membership Changes (30d)",{variables:$("Time start for membership change unique nation counts."),sort:{idx:1,dir:"desc"}},e=>{const t=_();return e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getnetmembersacquired",args:t,alias:"Net Member"}).add({cmd:"getmembershipchangeuniquenationsbyreason",args:{reasons:"recruited",...t},alias:"RECRUITED"}).add({cmd:"getmembershipchangeuniquenationsbyreason",args:{reasons:"joined",...t},alias:"JOINED"}).add({cmd:"getmembershipchangeuniquenationsbyreason",args:{reasons:"left",...t},alias:"LEFT"}).add({cmd:"getmembershipchangeuniquenationsbyreason",args:{reasons:"deleted",...t},alias:"DELETED"}).add({cmd:"getmembershipchangeuniquenationsbyreason",args:{reasons:"vm_left",...t},alias:"VM_LEFT"}).add({cmd:"getmembershipchangeuniquenationsbyreason",args:{reasons:"vm_returned",...t},alias:"VM_RETURNED"})})},"Tier Delta (30d)":{...x("DBAlliance","Tier Delta (30d)",{variables:K("Snapshot offset used as the comparison baseline (for example: 30d, 90d, 365d).","Snapshot offset used as the current comparison point (typically 0d)."),sort:{idx:12,dir:"desc"}},e=>{const t=e.add({cmd:"getmarkdownurl",alias:"Alliance"}),{current:n,baseline:a}=U(t);t.addRaw(k(t,A(t,n,0),A(t,a,0)),"Members (+change)",R.numberWithDeltaFromBaseline);for(const r of G){const s=z(r);t.addRaw(k(t,A(t,n,r.min,s),A(t,a,r.min,s)),r.label,R.numberWithDeltaFromBaseline)}return t})},"Tier Bands (30d)":{...x("DBAlliance","Tier Bands (30d)",{variables:K("Snapshot offset used as the comparison baseline.","Snapshot offset used as the current comparison point."),sort:{idx:8,dir:"desc"}},e=>{const t=e.add({cmd:"getmarkdownurl",alias:"Alliance"}),{current:n,baseline:a}=U(t);t.addRaw(k(t,A(t,n,0),A(t,a,0)),"Members (+change)",R.numberWithDeltaFromBaseline);for(const r of G){const s=z(r);t.addRaw(k(t,A(t,n,r.min,s),A(t,a,r.min,s)),`${r.label} now (Delta)`,R.numberWithDeltaFromBaseline)}return t})},"Normalized Growth (30d)":{...x("DBAlliance","Normalized Growth (30d)",{variables:$("Time start for normalized growth calculations."),sort:{idx:2,dir:"desc"}},e=>{const t=_();return e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).addRaw(e.rawConcat(e.rawCommand("geteffectiveboughtassetcount",{assets:"cities",...t}),"/{countmembers}"),"Cities/Member").add({cmd:"geteffectivespendingvalue",args:{assets:"cities,projects,land",...t},alias:"Invest/Member"}).addRaw(e.rawConcat(e.rawCommand("geteffectivespendingvalue",{assets:"cities,projects,land",...t}),"/",e.rawCommand("getcumulativerevenuevalue",t)),"Invest/Revenue")})},"Cumulative Revenue (30d)":{...x("DBAlliance","Cumulative Revenue (30d)",{variables:$("Time start for cumulative revenue snapshots."),sort:{idx:1,dir:"desc"}},e=>{const t=_(),n=e.add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"getcumulativerevenuevalue",args:t,alias:"Value"}),a=T.options.ResourceType.options.filter(r=>r!=="CREDITS");for(const r of a)n.addRaw(n.rawConcat("{getcumulativerevenue(",n.rawVar("start"),`).${r}}`),r);return n})},"City Exponent":{value:w.placeholders("DBAlliance").array().add({cmd:"getmarkdownurl",alias:"Alliance"}).add({cmd:"countmembers",alias:"Members"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getscore",alias:"Score"}).add({cmd:"exponentialcitystrength",alias:"city^3"}).add({cmd:"exponentialcitystrength",args:{power:"2.5"},alias:"city^2.5"}).shorten().build2d(),sort:{idx:5,dir:"desc"}}}},Ee={selections:{All:"*","Alliance Nations":"%guild_alliances%","Members (Non VM)":"%guild_alliances%,#ismember","Active Applicant (1d)":"%guild_alliances%,#position=1,#vm_turns=0,#active_m<1440","Inactive Member >5d":"%guild_alliances%,#ismember,#active_m>7200","Inactive Member >1w":"%guild_alliances%,#ismember,#active_m>10080",Allies:"~allies,#ismember,#active_m<10800","Allies (underutilized)":"~allies,#active_m<2880,#freeoffensiveslots>0,#tankpct>0.8,#aircraftpct>0.8,#RelativeStrength>1.3,#vm_turns=0,#isbeige=0",Enemies:"~enemies,#ismember,#active_m<10800","Enemies (priority)":"~enemies,#cities>10,#active_m<2880,#def<3,#off>0,#vm_turns=0,#isbeige=0,#RelativeStrength>0.7,#fighting(~allies)","Spyable Enemies":"~enemies,#ismember,#active_m<2880,#espionageFull=0","Lacking Spies":"%guild_alliances%,#ismember,#getSpyCapLeft>0,#daysSinceLastSpyBuy>0","Member Not Verified":"%guild_alliances%,#ismember,#verified=0","Member Not in Guild":"%guild_alliances%,#ismember,#isInAllianceGuild=0","Member Not in Milcom Guild":"%guild_alliances%,#ismember,#isInMilcomGuild=0","Low Tier, Not Raiding":"%guild_alliances%,#cities<10,#ismember,#active_m<2880,#off<5,#color!=beige,#blockaded=0"},columns:{General:{value:w.placeholders("DBNation").array().add({cmd:"getmarkdownurl",alias:"Nation"}).add({cmd:"getallianceurlmarkup",alias:"AA"}).add({cmd:"getagedays",alias:"Age"}).add({cmd:"getcolor",alias:"Color"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getscore",alias:"Score"}).shorten().build2d(),sort:[{idx:1,dir:"desc"},{idx:5,dir:"desc"}]},MMR:{value:w.placeholders("DBNation").array().add({cmd:"getmarkdownurl",alias:"Nation"}).add({cmd:"getallianceurlmarkup",alias:"AA"}).add({cmd:"getcities",alias:"Cities"}).add({cmd:"getavg_infra",alias:"Infra"}).add({cmd:"getscore",alias:"NS"}).add({cmd:"getoff",alias:"ðŸ—¡"}).add({cmd:"getdef",alias:"ðŸ›¡"}).add({cmd:"getsoldiers",alias:"ðŸ’‚"}).add({cmd:"gettanks",alias:"âš™"}).add({cmd:"getaircraft",alias:"âœˆ"}).add({cmd:"getships",alias:"â›µ"}).add({cmd:"getspies",alias:"ðŸ”Ž"}).add({cmd:"dayssincelastspybuy",alias:"$ðŸ”Ždays"}).add({cmd:"getspycap",alias:"ðŸ”Žcap"}).add({cmd:"getmmrbuildingdecimal",alias:"MMR[build]"}).add({cmd:"dayssincelastsoldierbuy",alias:"$ðŸ’‚days"}).add({cmd:"dayssincelasttankbuy",alias:"$âš™days"}).add({cmd:"dayssincelastaircraftbuy",alias:"$âœˆdays"}).add({cmd:"dayssincelastshipbuy",alias:"$â›µdays"}).shorten().build2d(),sort:[{idx:1,dir:"desc"},{idx:3,dir:"desc"}]}}},Re={selections:{All:"*",Raws:"raws",Manufactured:"manu",...Object.fromEntries(T.options.ResourceType.options.map(e=>[e,e]))},columns:{Price:{value:w.placeholders("ResourceType").array().add({cmd:"getname",alias:"Resource"}).add({cmd:"getlow",alias:"Low"}).add({cmd:"gethigh",alias:"High"}).add({cmd:"getmargin",alias:"Margin"}).shorten().build2d(),sort:{idx:0,dir:"asc"}}}},ee={DBAlliance:_e,ResourceType:Re,Conflict:xe,DBNation:Ee};be(ee);function ke({colorId:e,beigeTurns:t}){const n=N.useMemo(()=>Number.isInteger(e),[e]),[a,r]=N.useState(()=>n?"":String(e));N.useEffect(()=>{let i=!0;return n?(B(async()=>{const{COMMANDS:o}=await import("./command-meta-Dd5nXUBW.js");return{COMMANDS:o}},[]).then(({COMMANDS:o})=>{if(!i)return;const c=o.options.NationColor.options[e]??String(e);r(c)}).catch(()=>{i&&r(String(e))}),()=>{i=!1}):(r(String(e)),()=>{i=!1})},[e,n]);const s=a.replace("BEIGE","TAN");return C.jsx("div",{className:"w-5 h-5 border border-2 border-black flex items-center justify-center",style:{backgroundColor:s||"transparent"},title:a||String(e),children:t!==void 0&&t>0&&C.jsx("span",{className:"text-xs text-black",children:t})})}const Me=N.lazy(()=>B(()=>import("./SimpleChart-BZ5w6o67.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),Oe=N.lazy(()=>B(()=>import("./SanitizedHtml-Ns7Al9X6.js"),__vite__mapDeps([11,1,10]))),W={money:{display:Ge},comma:{display:oe},color:{display:We},time:{display:ze},time_ms:{display:Ue},diff_ms:{display:Le},normal:{display:Ve},text:void 0,json:{display:Ke},graph:{display:Pe,isHtml:!0},html:{display:Ie},duration_day:{display:Be},percent_100:{display:je},percent:{display:De},duration_ms:{display:Fe},numeric_map:{display:qe},turn_to_date:{display:ie},...Object.fromEntries(Object.entries($e).map(([e,t])=>[e,{display:t}]))};function je(e){return e==null?"N/A":e.toFixed(2)+"%"}function De(e){if(e==null)return"N/A";try{return(e*100).toFixed(2)+"%"}catch{return"N/A2"}}function Le(e){return le(e,5)}function Be(e){if(e==null)return"N/A";const t=e*24*60*60;return t==0?"0s":H(t,3)}function Fe(e){if(e==null)return"N/A";const t=e/1e3;return t==0?"0s":H(t,3)}function Ie(e){return C.jsx(N.Suspense,{fallback:C.jsx("span",{children:e??""}),children:C.jsx(Oe,{value:e??""})})}function Pe(e){return C.jsx(N.Suspense,{fallback:C.jsx("span",{children:"Loading graph..."}),children:C.jsx(Me,{graph:e,type:"LINE",theme:"light",hideLegend:!0,hideDots:!0,minHeight:"40px",maxHeight:"50px"})})}function Ve(e){if(!e)return e;e=e.toString();const t=e.indexOf("[");if(t!==0){if(e[0]==="="&&e.startsWith("=HYPERLINK(")){const o=e.indexOf(")",11),c=e.slice(11,o);if(o===e.length-1){const l=ce(c,",");if(l.length===2)return`<a href="${l[0].trim().replace(/^"|"$/g,"")}">${l[1].trim().replace(/^"|"$/g,"")}</a>`}}return e}const n=e.indexOf("]",t);if(n<=t)return e;const a=e.indexOf("(",n);if(a!==n+1)return e;const r=e.indexOf(")",a);if(r!==e.length-1)return e;let s=e.slice(a+1,r);s.startsWith("<")&&s.endsWith(">")&&(s=s.slice(1,-1));const i=e.slice(t+1,n);return C.jsx(me,{to:s,children:i})}function Ke(e){const t=Array.isArray(e)?e.map(n=>Number.isFinite(n)?Math.round(n*100)/100:n):Object.fromEntries(Object.entries(e).map(([n,a])=>[n,Number.isFinite(a)?Math.round(a*100)/100:a]));return JSON.stringify(t)}function te(e){if(e)if(e.startsWith("enum:")){const t=e.split(":")[1],n=w.data.options[t].options??[];return{display:a=>n[a],isEnum:!0,options:n}}else return W[e]??W.text}function ze(e){const t=new Date(e*1e3);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function Ue(e){const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function Ge(e){return"$"+M(e)}function We(e){return C.jsx(ke,{colorId:e})}function qe(e){return e?(typeof e=="string"&&(e=JSON.parse(e)),`{${Object.entries(e).map(([n,a])=>`${n}:${M(a)}`).join(",")}}`):"{}"}function He(e){return(e?Array.isArray(e)?e:[e]:[]).map(n=>({columnKey:String(n.idx),direction:n.dir==="asc"?"ASC":"DESC"}))}const Ye=5e4;function Je(e,t,n,a){const r=performance.now();try{const s=[...n];if(!Array.isArray(t)||t.length===0)return;const i=new Map;s.forEach(d=>i.set(d.index,d));const o=Qe(e,t,i),c=rt(t,s,i);if(c.perfectMatch)return;const l=re(a);let u;if(c.partialMatch){const d=D(t,o,i,a);u=[...e],tt(u,d,c.matchedColumns)}else if(t.every(m=>{const p=o.get(Number(m.columnKey))||"mixed";return p==="number"||p==="string"||p==="boolean"})&&e.length>=Ye)u=at(e,t,o,l);else{const m=D(t,o,i,a);u=[...e],u.sort((p,f)=>j(p,f,m))}return nt(s,t,i),{data:u,columns:s}}finally{performance.now()-r}}function Qe(e,t,n){const a=Math.min(100,e.length),r=new Map;if(e.length===0){for(const s of t){const i=Number(s.columnKey),o=n.get(i),c=o?.type||"mixed";r.set(i,c),o&&(o.type=c)}return r}for(const s of t){const i=Number(s.columnKey),o=n.get(i);let c=o?.type||null;if(!c){let u=!1,d=!1,m=!1,p=!1;for(let f=0;f<a;f++){const v=e[f];if(!v)break;const b=v[i];if(b==null)continue;const g=typeof b;if(g==="number"?u=!0:g==="string"?d=!0:g==="boolean"?m=!0:p=!0,(u?1:0)+(d?1:0)+(m?1:0)+(p?1:0)>1||p){c="mixed";break}}c||(u?c="number":d?c="string":m?c="boolean":c="mixed")}const l=c;r.set(i,l),o&&(o.type=l)}return r}function D(e,t,n,a){const r=re();return e.map(s=>{const i=Number(s.columnKey),o=t.get(i)||n.get(i)?.type||"mixed",c=s.direction==="ASC"?1:-1;switch(o){case"number":return{index:i,compare:ne(c)};case"string":return{index:i,compare:ae(c,r)};case"boolean":return{index:i,compare:se(c,r)};default:return{index:i,compare:Xe(c,r)}}})}function re(e){return{nulls:"auto",nans:"auto",collator:void 0}}function L(e){return e==null||typeof e!="number"?4:Number.isNaN(e)?3:e===1/0?2:e===-1/0?1:0}const O=(()=>{const e=new Array(5).fill(0);return e[1]=0,e[2]=1,e[3]=2,e[4]=3,e})();function ne(e,t){return(n,a)=>{const r=L(n),s=L(a),i=r===0;if(i!==(s===0))return i?-1:1;if(i){const c=n,l=a;return c<l?e===1?-1:1:c>l?e===1?1:-1:0}return r!==s?O[r]-O[s]:0}}function ae(e,t){const n=t.nulls==="first"||t.nulls==="auto"&&e===-1,a=t.collator;return(r,s)=>{const i=r==null,o=s==null;if(i||o)return i&&o?0:i?n?-1:1:n?1:-1;const c=typeof r=="string"?r:String(r),l=typeof s=="string"?s:String(s),u=a?a.compare(c,l):c.localeCompare(l);return u!==0?e===1?u:-u:0}}function se(e,t){const n=t.nulls==="first"||t.nulls==="auto"&&e===-1;return(a,r)=>{const s=a==null,i=r==null;if(s||i)return s&&i?0:s?n?-1:1:n?1:-1;const o=!!a;return o===!!r?0:e===1?o?1:-1:o?-1:1}}function Xe(e,t){const n=ne(e),a=ae(e,t),r=se(e,t),o=e===1?new Map([["number",0],["string",1],["boolean",2],["object",3]]):new Map([["object",0],["boolean",1],["string",2],["number",3]]);return(c,l)=>{const u=c==null,d=l==null;if(u||d){if(u&&d)return 0;const h=t.nulls==="first"||t.nulls==="auto"&&e===-1;return u?h?-1:1:h?1:-1}const m=typeof c,p=typeof l;if(m==="number"&&p==="number")return n(c,l);if(m==="string"&&p==="string")return a(c,l);if(m==="boolean"&&p==="boolean")return r(c,l);const f=o.get(m)??3,v=o.get(p)??3;if(f!==v)return f-v;const b=String(c),g=String(l);if(b===g)return 0;const y=t.collator?t.collator.compare(b,g):b.localeCompare(g);return e===1?y:-y}}function j(e,t,n){for(let a=0;a<n.length;a++){const r=n[a],s=r.compare(e[r.index],t[r.index]);if(s!==0)return s}return 0}function Ze(e,t,n){for(let a=0;a<n.length;a++){const r=n[a];if(r.compare(e[r.index],t[r.index])!==0)return!1}return!0}function et(e,t,n,a){for(let r=t+1;r<n;r++){const s=e[r];let i=r-1;for(;i>=t&&j(e[i],s,a)>0;)e[i+1]=e[i],i--;e[i+1]=s}}function tt(e,t,n){const a=t.slice(0,n),r=t.slice(n);if(r.length===0)return;let s=0;for(;s<e.length;){let i=s+1;for(;i<e.length&&Ze(e[s],e[i],a);)i++;const o=i-s;if(o>1)if(o<=10)et(e,s,i,r);else{const c=e.slice(s,i);c.sort((l,u)=>j(l,u,r));for(let l=0;l<c.length;l++)e[s+l]=c[l]}s=i}}function rt(e,t,n){let a=0;for(let s=0;s<e.length;s++){const i=e[s],o=Number(i.columnKey),c=n.get(o),l=i.direction==="ASC"?"asc":"desc";if(!c?.sorted||c.sorted[0]!==l||c.sorted[1]!==s)break;a++}let r=!1;for(const s of t)if(s.sorted&&s.sorted[1]>=a){r=!0;break}return{perfectMatch:a===e.length&&!r,partialMatch:a>0,matchedColumns:a}}function nt(e,t,n){for(const a of e)a.sorted=void 0;t.forEach((a,r)=>{const s=Number(a.columnKey),i=n.get(s);i&&(i.sorted=[a.direction==="ASC"?"asc":"desc",r])})}function at(e,t,n,a){const r=e.length,s=t.length;if(r<=1||s===0)return e.slice();const i=[],o=a.collator;for(let d=0;d<s;d++){const m=t[d],p=Number(m.columnKey),f=m.direction==="ASC"?1:-1,v=n.get(p)||"mixed";if(v==="number"){const b=new Uint8Array(r),g=new Float64Array(r);for(let y=0;y<r;y++){const h=e[y][p],S=L(h);b[y]=S,g[y]=S===0?h:0}i.push({kind:"number",dir:f,codes:b,vals:g})}else if(v==="string"){const b=new Array(r),g=new Uint8Array(r),y=f===-1;for(let h=0;h<r;h++){const S=e[h][p];S==null?(g[h]=1,b[h]=""):(g[h]=0,b[h]=typeof S=="string"?S:String(S))}i.push({kind:"string",dir:f,strs:b,nulls:g,nullsFirst:y})}else if(v==="boolean"){const b=new Uint8Array(r),g=new Uint8Array(r),y=f===-1;for(let h=0;h<r;h++){const S=e[h][p];S==null?(g[h]=1,b[h]=0):(g[h]=0,b[h]=S===!0?1:0)}i.push({kind:"boolean",dir:f,bools:b,nulls:g,nullsFirst:y})}else{const b=D(t,n,new Map);return e.slice().sort((g,y)=>j(g,y,b))}}const c=new Array(r);for(let d=0;d<r;d++)c[d]=d;const l=(d,m)=>{for(let p=0;p<i.length;p++){const f=i[p];if(f.kind==="number"){const v=f.codes[d],b=f.codes[m],g=v===0;if(g!==(b===0))return g?-1:1;if(g){const h=f.vals[d],S=f.vals[m];if(h<S)return f.dir===1?-1:1;if(h>S)return f.dir===1?1:-1}else if(v!==b)return O[v]-O[b]}else if(f.kind==="string"){const v=f.nulls[d]===1,b=f.nulls[m]===1;if(v||b){if(v&&b)continue;return v?f.nullsFirst?-1:1:f.nullsFirst?1:-1}const g=f.strs[d],y=f.strs[m],h=o?o.compare(g,y):g.localeCompare(y);if(h!==0)return f.dir===1?h:-h}else{const v=f.nulls[d]===1,b=f.nulls[m]===1;if(v||b){if(v&&b)continue;return v?f.nullsFirst?-1:1:f.nullsFirst?1:-1}const g=f.bools[d],y=f.bools[m];if(g!==y)return f.dir===1?g-y:y-g}}return d-m};c.sort(l);const u=new Array(r);for(let d=0;d<r;d++)u[d]=e[c[d]];return u}function ft(e,t,n,a=[],r){const s=e.errors??[],i=He(t),o=n.size>0?Array.from(n).map(([b,g])=>g??b):e.cells[0];let c=e.cells.slice(1);const l=e.renderers,u=Array.from(n.keys());let d=o.map((b,g)=>{const y=ot(r,u[g],b),h=l?te(l[g]):void 0;return{title:st(b),index:g,render:y??h}});const m=!t||Array.isArray(t)&&t.length===0||c.length<=1?void 0:Je(c,i,d);m&&(c=m.data,d=m.columns);const p=it(c,d,a);c=p.data,d=p.columnsInfo;const f=Array.from(Array(d.length).keys());return{errors:s,columnsInfo:d,data:c,visibleColumns:f,searchSet:new Set,sort:t}}function gt(e,t){const n=w.placeholders(e).getCommands(),a=[];for(const r of n)t&&!t(r)||r.hasRequiredArgument()||a.push([r.name,r.command.desc]);return a}function st(e){if(e.includes("{")){for(const t of de)e.includes("{"+t)&&(e=e.replace("{"+t,"{"));return e.replace("{","").replace("}","")}else return e}function pt(e,t,n,a){const r=t.filter(l=>l.exportable!==!1),s=r.length>0?r:t,i=s.map(l=>l.title),o=e.map(l=>s.map(u=>l[u.index])),c=[i,...o];return ue(c,n,a)}function bt(e){const t=e.get("type");if(t&&t in w.data.placeholders)return t}function ht(e,t){const n={},a=t?ee[t]?.selections:void 0,r=a?.All??Object.values(a??{})[0];n[""]=e.get("sel")??r??"*";const s=new Set(["type","sel","col","sort"]);for(const[i,o]of e.entries())!s.has(i)&&i&&(n[i]=o);return n}function yt(e){const t=Object.fromEntries(e.getAll("col").map(n=>{const[a,r]=n.split(";");return[a,r||null]}));return Object.keys(t).length>0?new Map(Object.entries(t)):void 0}function vt(e){const t=e.getAll("sort").map(n=>{const[a,r]=n.split(";");return{idx:parseInt(a,10),dir:r}});return t.length>0?t:void 0}function wt(e,t){const n=t[""]??"",a=Object.entries(t).filter(([r])=>r!=="").map(([r,s])=>`(${r}: ${s})`).join(" ");return a?`${e}:${n} [${a}]`:`${e}:${n}`}function St(e){let t;return Object.keys(e).length===1?t=e[""]:Object.keys(e).length>1&&(t=JSON.stringify(e)),t}function Ct({type:e,sel:t,selAndModifiers:n,columns:a,sort:r}){const s=new URLSearchParams;if(s.set("type",e),t)s.set("sel",t);else if(n)for(const[i,o]of Object.entries(n))o?s.append(i===""?"sel":i,o):s.set("sel",o);if(a.forEach((i,o)=>{s.append("col",i?`${o};${i}`:o)}),r)if(Array.isArray(r))for(const i of r)s.append("sort",`${i.idx};${i.dir}`);else s.append("sort",`${r.idx};${r.dir}`);return s.toString()}function it(e,t,n){if(!n.length)return{data:e,columnsInfo:t};const a=t.length>0?Math.max(...t.map(u=>u.index))+1:0,r=n.map((u,d)=>({title:u.title,index:a+d,render:u.render,sortable:u.sortable??!1,exportable:u.exportable??!1,editable:u.editable??!1,draggable:u.draggable??!1,width:u.width,hideOnMobile:u.hideOnMobile,cellClassName:u.cellClassName,headerCellClassName:u.headerCellClassName})),s=e.map((u,d)=>{const m=[...u];for(const p of n)m.push(p.value?p.value(u,d):null);return m}),i=[],o=[],c=[];r.forEach((u,d)=>{const m=n[d].position;m==="start"?i.push(u):typeof m=="number"&&Number.isFinite(m)?c.push({at:Math.max(0,Math.floor(m)),col:u}):o.push(u)});let l=[...i,...t,...o];if(c.length>0){c.sort((d,m)=>d.at-m.at);let u=0;for(const{at:d,col:m}of c){const p=Math.min(l.length,d+u);l=[...l.slice(0,p),m,...l.slice(p)],u+=1}}return{data:s,columnsInfo:l}}function ot(e,t,n){if(!e)return;const a=[t,n].filter(o=>!!o).map(o=>q(o));if(a.length===0)return;const s=Object.entries(e).find(([o])=>{const c=q(o);return a.includes(c)});if(!s)return;const i=s[1];return typeof i=="string"?te(i):i}function q(e){const t=e.toLowerCase().trim();return t.startsWith("{")&&t.endsWith("}")?t.slice(1,-1).replace(/\(.+\)$/,""):t}export{ke as C,ee as D,ut as a,gt as b,bt as c,ht as d,yt as e,vt as f,Ct as g,te as h,ft as i,wt as j,pt as k,qe as n,mt as r,Je as s,St as t};
